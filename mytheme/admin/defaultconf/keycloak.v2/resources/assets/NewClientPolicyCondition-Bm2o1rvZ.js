import{jsxs as f,Fragment as K,jsx as e}from"react/jsx-runtime";import{u as U,a as _,$ as q,d as J,c as M,e as Q,b as W,f as X,C as Y,P as Z,a_ as ii,a$ as oi,b0 as ni,c4 as ei,c5 as ti,aG as ai,F as si,A as ri,h as g,eU as P,L as ci,j as di}from"./main-hZIJIVx9.js";import{useState as r}from"react";import{D as li}from"./DynamicComponents-v6e2RtHb.js";import{F as pi}from"./FormAccess-DIV7UK1Y.js";import{V as mi}from"./ViewHeader-DxK8RzXz.js";import{c as F}from"./camelCase-Cp10aWet.js";import"react-dom";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./CodeEditor-BZUGCa3z.js";import"./copy-icon-Cy7M-mD5.js";import"./GroupPickerDialog-CppD_q_3.js";import"./DataListItemRow-B1CYYhSa.js";import"./KeySelect-BUhUx10e.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-DThNyrNa.js";import"./AddRoleMappingModal-C4wZesy5.js";import"./translationFormatter-QNso5xUZ.js";import"./useLocaleSort-Cjd-LyWL.js";import"./ConfirmDialog-BClP8m2C.js";import"./filter-icon-B5V3NoWK.js";import"./capitalize-C7hSmiNl.js";import"./_baseSlice-F8doVSIJ.js";function ji(){const{adminClient:v}=U(),{t:n}=_(),{addAlert:I,addError:x}=q(),h=J(),{realm:C}=M(),[D,b]=r(!1),[d,N]=r(!1),[w,T]=r([]),[G,V]=r([]),[$,H]=r(),[p,O]=r(""),[k,S]=r([]),{policyName:c,conditionName:t}=Q(),j=W(),m=X(),A=j.componentTypes?.["org.keycloak.services.clientpolicy.condition.ClientPolicyConditionProvider"],B=a=>{m.reset({config:a.configuration||{}})};Y(()=>v.clientPolicies.listPolicies({includeGlobalPolicies:!0}),a=>{if(T(a.policies??[]),t){let i=a.policies?.find(o=>o.name===c);i===void 0&&(i=a.globalPolicies?.find(o=>o.name===c),N(i!==void 0));const l=i?.conditions?.find(o=>o.condition===t),u=A?.find(o=>o.id===t);H(l),S(u?.properties),B(l)}},[]);const E=async a=>{const i=a.config,l=()=>k.reduce((o,s)=>(o[s.name]=i[s.name],o),{}),u=w.map(o=>{if(o.name!==c)return o;let s=o.conditions??[];if(t){const L={condition:$?.condition,configuration:l()},y=s.findIndex(z=>t===z.condition);if(y===-1)return;const R=[...s.slice(0,y),L,...s.slice(y+1)];return{...o,conditions:R}}return s=s.concat({condition:G[0].condition,configuration:l()}),{...o,conditions:s}});try{await v.clientPolicies.updatePolicy({policies:u}),T(u),h(P({realm:C,policyName:c})),I(n(t?"updateClientConditionSuccess":"createClientConditionSuccess"),di.success)}catch(o){x("createClientConditionError",o)}};return f(K,{children:[e(mi,{titleKey:n(t?d?"viewCondition":"editCondition":"addCondition"),divider:!0}),f(Z,{variant:"light",children:[f(pi,{isHorizontal:!0,role:"manage-realm",isReadOnly:d,className:"pf-v5-u-mt-lg",onSubmit:m.handleSubmit(E),children:[e(ii,{label:n("conditionType"),fieldId:"conditionType",labelIcon:e(oi,{helpText:p?`${F(p.replace(/-/g," "))}Help`:"conditionsHelp",fieldLabelId:"conditionType"}),children:e(ni,{name:"conditions",defaultValue:"any-client",control:m.control,render:({field:a})=>e(ei,{placeholderText:n("selectACondition"),className:"kc-conditionType-select","data-testid":"conditionType-select",toggleId:"provider",isDisabled:!!t,onToggle:i=>b(i),onSelect:i=>{a.onChange(i),S(i.properties),O(i.id),V([{condition:i.id}]),b(!1)},selections:t||p,variant:ti.single,"aria-label":n("conditionType"),isOpen:D,children:A?.map(i=>e(ai,{selected:i.id===a.value,description:n(F(i.id.replace(/-/g," "))),value:i,children:i.id},i.id))})})}),e(si,{...m,children:e(li,{properties:k})}),!d&&f(ri,{children:[e(g,{variant:"primary",type:"submit","data-testid":"addCondition-saveBtn",isDisabled:p===""&&!t&&d,children:n(t?"save":"add")}),e(g,{variant:"link","data-testid":"addCondition-cancelBtn",onClick:()=>h(P({realm:C,policyName:c})),children:n("cancel")})]})]}),d&&e("div",{className:"kc-backToProfile",children:e(g,{component:a=>e(ci,{...a,to:P({realm:C,policyName:c})}),variant:"primary",children:n("back")})})]})]})}export{ji as default};
//# sourceMappingURL=NewClientPolicyCondition-Bm2o1rvZ.js.map

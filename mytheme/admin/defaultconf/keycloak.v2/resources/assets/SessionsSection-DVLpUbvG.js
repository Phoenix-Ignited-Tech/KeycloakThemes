import{jsxs as y,jsx as e,Fragment as O}from"react/jsx-runtime";import{u as T,a as R,$ as L,c as k,f as x,M as E,q as I,h as v,B as q,aX as U,r as V,a_ as M,b8 as P,j as d,D as F,bm as $,P as j,c4 as G,aG as A,dB as K}from"./main-hZIJIVx9.js";import{useState as S}from"react";import{u as H}from"./ConfirmDialog-BClP8m2C.js";import{V as z}from"./ViewHeader-DxK8RzXz.js";import{u as X}from"./useToggle-K3Kx99tM.js";import{S as _}from"./SessionsTable-Bpik6NQE.js";import{F as J}from"./filter-icon-B5V3NoWK.js";import"react-dom";import"./useFormatDate-wmPxp-7e.js";import"./ListItem-BJr2pMeN.js";const Q=({handleModalToggle:n,save:c})=>{const{adminClient:a}=T(),{t}=R(),{addAlert:s,addError:l}=L(),{realm:r,realmRepresentation:u,refresh:h}=k(),{register:m,handleSubmit:b}=x(),C=(o,p)=>{const i=o.successRequests?.length||0,g=o.failedRequests?.length||0;i===0&&g===0?s(t("noAdminUrlSet"),d.warning):g>0?(s(t(""+p+"Success",{successNodes:o.successRequests}),d.success),s(t(""+p+"Fail",{failedNodes:o.failedRequests}),d.danger)):s(t(""+p+"Success",{successNodes:o.successRequests}),d.success)},B=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:Date.now()/1e3}),s(t("notBeforeSuccess"),d.success)}catch(o){l("setToNowError",o)}},f=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:0}),s(t("notBeforeClearedSuccess"),d.success),h()}catch(o){l("notBeforeError",o)}},w=async()=>{const o=await a.realms.pushRevocation({realm:r});C(o,"notBeforePush"),h()};return y(E,{variant:I.small,title:t("revocation"),isOpen:!0,onClose:n,actions:[e(v,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:()=>{B(),n()},form:"revocation-modal-form",children:t("setToNow")},"set-to-now"),e(v,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:()=>{f(),n()},form:"revocation-modal-form",children:t("clear")},"clear"),e(v,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:()=>{w(),n()},form:"revocation-modal-form",children:t("push")},"push"),e(v,{id:"modal-cancel","data-testid":"cancel",variant:q.link,onClick:()=>{n()},children:t("cancel")},"cancel")],children:[e(U,{className:"kc-revocation-description-text",children:t("revocationDescription")}),e(V,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:b(c),children:e(M,{className:"kc-revocation-modal-form-group",label:t("notBefore"),name:"notBefore",fieldId:"not-before",children:e(P,{"data-testid":"not-before-input",autoFocus:!0,readOnly:!0,value:u?.notBefore===0?t("none"):new Date(u?.notBefore*1e3).toString(),type:"text",id:"not-before",...m("notBefore")})})})]})},W=({filterType:n,onChange:c})=>{const{t:a}=R(),[t,s]=X();return y(G,{"data-testid":"filter-session-type-select",isOpen:t,onToggle:s,toggleIcon:e(J,{}),onSelect:l=>{c(l),s()},selections:n,children:[e(A,{"data-testid":"all-sessions-option",value:"ALL",children:a("sessionsType.allSessions")}),e(A,{"data-testid":"regular-sso-option",value:"REGULAR",children:a("sessionsType.regularSSO")}),e(A,{"data-testid":"offline-option",value:"OFFLINE",children:a("sessionsType.offline")})]})};function le(){const{adminClient:n}=T(),{t:c}=R(),[a,t]=S(0),s=()=>t(a+1),{addError:l}=L(),{realm:r}=k(),[u,h]=S(!1),[m,b]=S("ALL"),[C,B]=S(!1),f=()=>{h(!u)},w=async(i,g,D)=>{const N=await K(n,"ui-ext/sessions",{first:`${i}`,max:`${g}`,type:m,search:D||""});return B(N.length===0),N},[o,p]=H({titleKey:"logoutAllSessions",messageKey:"logoutAllDescription",continueButtonLabel:"confirm",onConfirm:async()=>{try{await n.realms.logoutAll({realm:r}),s()}catch(i){l("logoutAllSessionsError",i)}}});return y(O,{children:[e(p,{}),e(z,{dropdownItems:[e(F,{"data-testid":"revocation",component:"button",onClick:()=>f(),children:c("revocation")},"toggle-modal"),e(F,{"data-testid":"logout-all",component:"button",isDisabled:C,onClick:o,children:c("signOutAllActiveSessions")},"delete-role")],titleKey:"titleSessions",subKey:"sessionExplain",helpUrl:$.sessionsUrl}),y(j,{variant:"light",className:"pf-v5-u-p-0",children:[u&&e(Q,{handleModalToggle:f,save:()=>{f()}}),e(_,{loader:w,isSearching:m!=="ALL",isPaginated:!0,filter:e(W,{filterType:m,onChange:i=>{b(i),s()}})},a)]})]})}export{le as default};
//# sourceMappingURL=SessionsSection-DVLpUbvG.js.map

import{jsxs as u,Fragment as R,jsx as o}from"react/jsx-runtime";import{u as X,a as _,d as q,$ as J,b as Q,f as U,C as W,P as Y,a_ as Z,a$ as k,b0 as ee,c4 as te,c5 as oe,aG as re,F as ae,A as ce,h as g,L as V,eX as h,j as se}from"./main-hZIJIVx9.js";import{useState as l}from"react";import{D as ie}from"./DynamicComponents-v6e2RtHb.js";import{F as ne}from"./FormAccess-DIV7UK1Y.js";import{V as le}from"./ViewHeader-DxK8RzXz.js";import{u as C}from"./useParams-tGf6FJmU.js";import"react-dom";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./CodeEditor-BZUGCa3z.js";import"./copy-icon-Cy7M-mD5.js";import"./GroupPickerDialog-CppD_q_3.js";import"./DataListItemRow-B1CYYhSa.js";import"./KeySelect-BUhUx10e.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-DThNyrNa.js";import"./AddRoleMappingModal-C4wZesy5.js";import"./translationFormatter-QNso5xUZ.js";import"./useLocaleSort-Cjd-LyWL.js";import"./ConfirmDialog-BClP8m2C.js";import"./filter-icon-B5V3NoWK.js";const F={config:{},executor:""};function Ne(){const{adminClient:P}=X(),{t:c}=_(),I=q(),{realm:d,profileName:i}=C(),{executorName:n}=C(),{addAlert:A,addError:G}=J(),[H,T]=l(!1),p=Q().componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[m,N]=l([]),[O,D]=l([]),[v,L]=l([]),[$,j]=l([]),f=U({defaultValues:F}),{control:B,reset:y,handleSubmit:w}=f,a=!!n,E=e=>{const r=e.find(s=>s.name===i)?.executors?.find(s=>s.executor===n);r&&y({config:r.configuration})};W(()=>P.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{L(e.globalProfiles),j(e.profiles),E(e.profiles),E(e.globalProfiles)},[]);const z=async()=>{const e=f.getValues(),t=$.map(r=>{if(r.name!==i)return r;const s=(r.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(a){const S=r.executors.find(M=>M.executor===n);S.configuration={...S.configuration,...e.config}}return a?r:{...r,executors:s}});try{await P.clientPolicies.createProfiles({profiles:t,globalProfiles:v}),A(c(a?"updateExecutorSuccess":"addExecutorSuccess"),se.success),I(h({realm:d,profileName:i}))}catch(r){G(a?"updateExecutorError":"addExecutorError",r)}},x=v.find(e=>e.name===i),b=p?.find(e=>e.id===n),K=b?.properties.map(e=>{const t=a?e.defaultValue:"";return{...e,defaultValue:t}});return u(R,{children:[o(le,{titleKey:a?n:c("addExecutor"),divider:!0}),u(Y,{variant:"light",children:[u(ne,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",isReadOnly:!!x,children:[o(Z,{label:c("executorType"),fieldId:"kc-executorType",labelIcon:m.length>0&&m[0].helpText!==""?o(k,{helpText:m[0].helpText,fieldLabelId:"executorTypeHelpText"}):a?o(k,{helpText:b?.helpText,fieldLabelId:"executorTypeHelpText"}):void 0,children:o(ee,{name:"executor",defaultValue:"",control:B,render:({field:e})=>o(te,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:t=>T(t),onSelect:t=>{y({...F,executor:t.toString()});const r=p?.filter(s=>s.id===t);N(r??[]),D(r?.[0].properties??[]),T(!1)},selections:a?n:e.value,variant:oe.single,"data-testid":"executorType-select","aria-label":c("executorType"),isOpen:H,maxHeight:580,isDisabled:a,children:p?.map(t=>o(re,{selected:t.id===e.value,value:t.id,description:t.helpText,children:t.id},t.id))})})}),o(ae,{...f,children:o(ie,{properties:a?K:O})}),!x&&u(ce,{children:[o(g,{variant:"primary",onClick:()=>w(z)(),"data-testid":"addExecutor-saveBtn",children:c(a?"save":"add")}),o(g,{variant:"link",component:e=>o(V,{...e,to:h({realm:d,profileName:i})}),"data-testid":"addExecutor-cancelBtn",children:c("cancel")})]})]}),a&&x&&o("div",{className:"kc-backToProfile",children:o(g,{component:e=>o(V,{...e,to:h({realm:d,profileName:i})}),variant:"primary",children:c("back")})})]})]})}export{Ne as default};
//# sourceMappingURL=ExecutorForm-DralMNfg.js.map

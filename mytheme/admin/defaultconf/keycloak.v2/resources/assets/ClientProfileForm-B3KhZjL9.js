import{jsx as e,jsxs as o,Fragment as x}from"react/jsx-runtime";import{u as J,a as X,d as Z,f as U,bZ as W,$ as Y,b as _,C as ee,B as te,j as T,eX as L,eV as y,aQ as ie,o as re,D as ae,P as oe,F as le,Q as se,aD as ne,A as ce,h as d,L as P,v as de,x as w,aL as F,aM as V,a$ as S,fb as me,bh as ue,fc as fe,bd as pe}from"./main-hZIJIVx9.js";import{useState as h,useMemo as xe,Fragment as Pe}from"react";import{u as he}from"./ConfirmDialog-BClP8m2C.js";import{F as Ce}from"./FormAccess-DIV7UK1Y.js";import{V as be}from"./ViewHeader-DxK8RzXz.js";import{u as ge}from"./useParams-tGf6FJmU.js";/* empty css                               */import{d as ve,D as ke,a as Te,b as ye,c as Ee}from"./DataListItemRow-B1CYYhSa.js";import{T as De}from"./trash-icon-B7fZiFY1.js";import"react-dom";import"./copy-icon-Cy7M-mD5.js";const Ie={name:"",description:"",executors:[]};function je(){const{adminClient:p}=J(),{t}=X(),C=Z(),E=U({defaultValues:Ie,mode:"onChange"}),{handleSubmit:A,setValue:b,getValues:$,formState:{isDirty:D},control:B}=E,{fields:g,remove:H}=W({name:"executors",control:B}),{addAlert:v,addError:k}=Y(),[m,G]=h(),[a,K]=h(!1),{realm:n,profileName:l}=ge(),j=_(),M=xe(()=>j.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[]),[u,Q]=h(),c=!!l,[I,q]=h(0),O=()=>q(I+1);ee(()=>p.clientPolicies.listProfiles({includeGlobalProfiles:!0}),i=>{G({globalProfiles:i.globalProfiles,profiles:i.profiles?.filter(f=>f.name!==l)});const s=i.globalProfiles?.find(f=>f.name===l),r=i.profiles?.find(f=>f.name===l);K(s!==void 0),b("name",s?.name??r?.name??""),b("description",s?.description??r?.description??""),b("executors",s?.executors??r?.executors??[])},[I]);const R=async i=>{const s=i;try{await p.clientPolicies.createProfiles({...m,profiles:[...m?.profiles||[],s]}),v(t(c?"updateClientProfileSuccess":"createClientProfileSuccess"),T.success),C(L({realm:n,profileName:i.name}))}catch(r){k(c?"updateClientProfileError":"createClientProfileError",r)}},[N,z]=he({titleKey:u?.name?t("deleteExecutorProfileConfirmTitle"):t("deleteClientProfileConfirmTitle"),messageKey:u?.name?t("deleteExecutorProfileConfirm",{executorName:u.name}):t("deleteClientProfileConfirm",{profileName:l}),continueButtonLabel:t("delete"),continueButtonVariant:te.danger,onConfirm:async()=>{if(u?.name){H(u.idx);try{await p.clientPolicies.createProfiles({...m,profiles:[...m.profiles||[],$()]}),v(t("deleteExecutorSuccess"),T.success),C(L({realm:n,profileName:l}))}catch(i){k("deleteExecutorError",i)}}else try{await p.clientPolicies.createProfiles(m),v(t("deleteClientSuccess"),T.success),C(y({realm:n,tab:"profiles"}))}catch(i){k("deleteClientError",i)}}});return m?o(x,{children:[e(z,{}),e(be,{titleKey:c?l:t("newClientProfile"),badges:[{id:"global-client-profile-badge",text:a?e(re,{color:"blue",children:t("global")}):""}],divider:!0,dropdownItems:c&&!a?[e(ae,{value:"delete",onClick:N,"data-testid":"deleteClientProfileDropdown",children:t("deleteClientProfile")},"delete")]:void 0}),e(oe,{variant:"light",children:e(le,{...E,children:o(Ce,{isHorizontal:!0,role:"view-realm",className:"pf-v5-u-mt-lg",children:[e(se,{name:"name",label:t("newClientProfileName"),helperText:t("createClientProfileNameHelperText"),readOnly:a,rules:{required:t("required")}}),e(ne,{name:"description",label:t("description"),readOnly:a}),o(ce,{children:[!a&&e(d,{variant:"primary",onClick:()=>A(R)(),"data-testid":"saveCreateProfile",isDisabled:!D,children:t("save")}),c&&!a&&e(d,{id:"reloadProfile",variant:"link","data-testid":"reloadProfile",isDisabled:!D,onClick:O,children:t("reload")}),!c&&!a&&e(d,{id:"cancelCreateProfile",variant:"link",component:i=>e(P,{...i,to:y({realm:n,tab:"profiles"})}),"data-testid":"cancelCreateProfile",children:t("cancel")})]}),c&&o(x,{children:[o(de,{children:[e(w,{children:o(F,{className:"kc-executors",component:V.h1,children:[t("executors"),e(S,{helpText:t("executorsHelpText"),fieldLabelId:"executors"})]})}),!a&&e(w,{align:{default:"alignRight"},children:e(d,{id:"addExecutor",component:i=>e(P,{...i,to:me({realm:n,profileName:l})}),variant:"link",className:"kc-addExecutor","data-testid":"addExecutor",icon:e(ue,{}),children:t("addExecutor")})})]}),g.length>0&&o(x,{children:[e(ve,{"aria-label":t("executors"),isCompact:!0,children:g.map((i,s)=>e(ke,{"aria-labelledby":"executors-list-item",id:i.executor,children:e(Te,{"data-testid":"executors-list-row",children:e(ye,{dataListCells:[o(Ee,{"data-testid":"executor-type",children:[i.configuration?e(d,{component:r=>e(P,{...r,to:fe({realm:n,profileName:l,executorName:i.executor})}),variant:"link","data-testid":"editExecutor",children:i.executor}):e("span",{className:"kc-unclickable-executor",children:i.executor}),M?.filter(r=>r.id===i.executor).map(r=>o(Pe,{children:[e(S,{helpText:r.helpText,fieldLabelId:"executorTypeTextHelpText"},r.id),!a&&e(d,{variant:"link",isInline:!0,icon:e(De,{className:"kc-executor-trash-icon","data-testid":"deleteExecutor"},`executorType-trash-icon-${r.id}`),onClick:()=>{N(),Q({idx:s,name:r.id})},"aria-label":t("remove")})]},r.id))]},"executor")]})})},i.executor))}),a&&e(d,{id:"backToClientPolicies",component:i=>e(P,{...i,to:y({realm:n,tab:"profiles"})}),variant:"primary",className:"kc-backToPolicies","data-testid":"backToClientPolicies",children:t("back")})]}),g.length===0&&o(x,{children:[e(pe,{}),e(F,{className:"kc-emptyExecutors",component:V.h2,children:t("emptyExecutors")})]})]})]})})})]}):e(ie,{})}export{je as default};
//# sourceMappingURL=ClientProfileForm-B3KhZjL9.js.map

import{jsx as e,jsxs as l,Fragment as v}from"react/jsx-runtime";import{V as Ce}from"./ViewHeader-DxK8RzXz.js";import{a as S,aA as me,aB as he,aC as be,D as z,$ as pe,f as Ue,fA as Te,aX as Q,aL as _,aM as M,bq as xe,cb as fe,cc as W,b8 as ne,h as w,f2 as Ne,b0 as Ie,cT as Se,A as De,B as Y,j as q,c4 as Fe,c5 as Ee,aG as we,d8 as ie,bY as ge,aP as E,bt as Pe,dz as Ke,fB as Ve,u as Re,c as X,d as Oe,C as Be,aQ as Le,aY as _e,aN as qe,aO as Ge,be as $e,s as je,bv as H,L as Me,cy as ze,az as ye,o as le,cx as Qe,bI as We,fC as He,fD as Ye,x as Xe,b2 as Je,b3 as Ze,bA as et,bB as tt,bm as rt,P as at,eu as oe}from"./main-hZIJIVx9.js";import{P as st}from"./PermissionTab-CKSyLWea.js";import{useState as p}from"react";import{u as ce}from"./ConfirmDialog-BClP8m2C.js";import{a as nt}from"./AddRoleMappingModal-C4wZesy5.js";import{F as it}from"./filter-icon-B5V3NoWK.js";import{D as lt}from"./DropdownPanel-Bj9SJGZl.js";import{W as Ae}from"./warning-triangle-icon-BADc4O-Q.js";import{R as ot,u as ct}from"./RoutableTabs-B1siEmtL.js";/* empty css                     */import{a as ue,b as de}from"./Tabs-DXjNMDMz.js";import"react-dom";import"./useLocaleSort-Cjd-LyWL.js";import"./Trans-CPgnEO0T.js";import"./translationFormatter-QNso5xUZ.js";import"./PageHandler-B0KkvOoM.js";import"./DynamicComponents-v6e2RtHb.js";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./CodeEditor-BZUGCa3z.js";import"./copy-icon-Cy7M-mD5.js";import"./GroupPickerDialog-CppD_q_3.js";import"./DataListItemRow-B1CYYhSa.js";import"./KeySelect-BUhUx10e.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-DThNyrNa.js";import"./useParams-tGf6FJmU.js";import"./PageList-DUHf6xan.js";const ut=({searchType:r,onSelect:a})=>{const{t:c}=S(),[m,b]=p(!1),s=i=>e(z,{onClick:()=>{a(i),b(!1)},children:c(`searchType.${i}`)},i),y=[s("default"),s("attribute")];return e(me,{className:"keycloak__users__searchtype",onOpenChange:i=>b(i),toggle:i=>e(he,{"data-testid":"user-search-toggle",ref:i,id:"toggle-id",onClick:()=>b(!m),icon:e(it,{}),children:c(`searchType.${r}`)}),isOpen:m,children:e(be,{children:y})})};function dt({activeFilters:r,setActiveFilters:a,profile:c,createAttributeSearchChips:m,searchUserWithAttributes:b}){const{t:s}=S(),{addAlert:y}=pe(),[i,x]=p(!1),D={name:"",displayName:"",value:""},{getValues:o,register:k,reset:N,formState:{errors:h},setValue:P,setError:I,clearErrors:V,control:u}=Ue({mode:"onChange",defaultValues:D}),d=()=>r.userAttribute.some(t=>t.name===o().name),C=()=>{let t=!1;return o().name.length?r.userAttribute.some(A=>A.name===o().name)?I("name",{type:"conflict",message:s("searchUserByAttributeKeyAlreadyInUseError")}):t=!0:I("name",{type:"empty",message:s("searchUserByAttributeMissingKeyError")}),t},U=()=>{let t=!1;return o().value.length?t=!0:I("value",{type:"empty",message:s("searchUserByAttributeMissingValueError")}),t},R=()=>C()&&U(),T=()=>{R()?(a({exact:o().exact,userAttribute:[...r.userAttribute,{...o()}]}),N({exact:o().exact})):(h.name?.message&&y(h.name.message,q.danger),h.value?.message&&y(h.value.message,q.danger))},K=()=>{const t=[...r.userAttribute].filter(A=>A.name!==A.name);a({exact:o().exact,userAttribute:t})},O=()=>c?e(Fe,{"data-testid":"search-attribute-name-select",variant:Ee.typeahead,onToggle:t=>x(t),selections:o().displayName,onSelect:t=>{P("displayName",t.toString()),d()?I("name",{type:"conflict"}):V("name")},isOpen:i,placeholderText:s("selectAttribute"),validated:h.name&&"error",maxHeight:300,...k("displayName",{required:!0,validate:C}),children:c.attributes?.map(t=>e(we,{value:ie(s,t.displayName,t.name),onClick:A=>{A.stopPropagation(),x(!1),P("name",t.name)},children:ie(s,t.displayName,t.name)},t.name))}):e(ne,{id:"name",placeholder:s("keyPlaceholder"),validated:h.name&&"error",onKeyDown:t=>t.key==="Enter"&&T(),...k("name",{required:!0,validate:C})});return l(Te,{className:"user-attribute-search-form","data-testid":"user-attribute-search-form",children:[e(Q,{className:"user-attribute-search-form-headline",children:e(_,{component:M.h2,children:s("selectAttributes")})}),e(xe,{isInline:!0,className:"user-attribute-search-form-alert",variant:"info",title:s("searchUserByAttributeDescription"),component:"h3"}),l(Q,{className:"user-attribute-search-form-key-value",children:[e("div",{className:"user-attribute-search-form-left",children:e(_,{component:M.h3,children:s("key")})}),e("div",{className:"user-attribute-search-form-right",children:e(_,{component:M.h3,children:s("value")})})]}),e("div",{className:"user-attribute-search-form-left",children:O()}),e("div",{className:"user-attribute-search-form-right",children:l(fe,{children:[e(W,{children:e(ne,{id:"value",placeholder:s("valuePlaceholder"),validated:h.value&&"error",onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),T())},...k("value",{required:!0,validate:U})})}),e(W,{children:e(w,{"data-testid":"user-attribute-search-add-filter-button",variant:"control",icon:e(Ne,{}),onClick:T,"aria-label":s("addToFilter")})})]})}),m(),e("div",{className:"pf-v5-u-pt-lg",children:e(Ie,{name:"exact",defaultValue:!1,control:u,render:({field:t})=>e(Se,{id:"exact","data-testid":"exact",label:s("exactSearch"),isChecked:t.value,onChange:t.onChange})})}),l(De,{className:"user-attribute-search-form-action-group",children:[e(w,{"data-testid":"search-user-attribute-btn",variant:"primary",type:"submit",isDisabled:!r.userAttribute.length,onClick:b,children:s("search")}),e(w,{variant:Y.link,onClick:()=>{N(),K()},children:s("reset")})]})]})}function mt({searchDropdownOpen:r,setSearchDropdownOpen:a,realm:c,hasSelectedRows:m,toggleDeleteDialog:b,toggleUnlockUsersDialog:s,goToCreate:y,searchType:i,setSearchType:x,searchUser:D,setSearchUser:o,activeFilters:k,setActiveFilters:N,refresh:h,profile:P,clearAllFilters:I,createAttributeSearchChips:V,searchUserWithAttributes:u}){const{t:d}=S(),[C,U]=p(!1),{hasAccess:R}=ge(),T=R("query-users"),K=()=>e(E,{children:l(fe,{children:[e(W,{children:e(ut,{searchType:i,onSelect:f=>{I(),x(f)}})}),i==="default"&&O(),i==="attribute"&&t()]})}),O=()=>e(E,{children:e(Ke,{"data-testid":"table-search-input",placeholder:d("searchForUser"),"aria-label":d("search"),value:D,onSearch:(f,B,$)=>{o($.haswords),h()},onKeyDown:f=>{if(f.key==="Enter"){const B=f.target;o(B.value),h()}},onClear:()=>{o(""),h()}})}),t=()=>l(v,{children:[e(lt,{"data-testid":"select-attributes-dropdown",buttonText:d("selectAttributes"),setSearchDropdownOpen:a,searchDropdownOpen:r,width:"15vw",children:e(dt,{activeFilters:k,setActiveFilters:N,profile:P,createAttributeSearchChips:V,searchUserWithAttributes:()=>{u(),a(!1)}})}),e(w,{icon:e(Ve,{}),variant:"control",onClick:()=>{u(),a(!1)},"aria-label":d("searchAttributes")})]}),A=c.bruteForceProtected?e(E,{children:e(me,{onOpenChange:f=>U(f),toggle:f=>e(he,{ref:f,isExpanded:C,variant:"plain",onClick:()=>U(!C),children:e(Pe,{})}),isOpen:C,shouldFocusToggleOnSelect:!0,children:l(be,{children:[e(z,{component:"button",isDisabled:m,onClick:()=>{b(),U(!1)},children:d("deleteUser")},"deleteUser"),e(z,{component:"button",onClick:()=>{s(),U(!1)},children:d("unlockAllUsers")},"unlock")]})})}):e(E,{children:e(w,{variant:Y.link,onClick:b,"data-testid":"delete-user-btn",isDisabled:m,children:d("deleteUser")})}),G=l(v,{children:[e(E,{children:e(w,{"data-testid":"add-user",onClick:y,children:d("addUser")})}),A]});return l(v,{children:[K(),T?G:null]})}const ht=r=>{const{t:a}=S(),{realm:c}=X();return l(v,{children:[l(Me,{to:ze({realm:c,id:r.id,tab:"settings"}),children:[r.username,e(bt,{user:r})]}),r.attributes?.is_temporary_admin[0]==="true"&&e(ye,{content:a("temporaryAdmin"),children:e(Ae,{className:"pf-v5-u-ml-sm",id:"temporary-admin-label"})})]})},bt=({user:r})=>{const{t:a}=S();return l(v,{children:[!r.enabled&&e(le,{color:"red",icon:e(Qe,{}),children:a("disabled")}),r.bruteForceStatus?.disabled&&e(le,{color:"orange",icon:e(Ae,{}),children:a("temporaryLocked")})]})},pt=r=>{const{t:a}=S();return l(v,{children:[!r.emailVerified&&e(ye,{content:a("notVerified"),children:e(We,{className:"keycloak__user-section__email-verified"})})," ",H()(r.email)]})};function ft(){const{adminClient:r}=Re(),{t:a}=S(),{addAlert:c,addError:m}=pe(),{realm:b,realmRepresentation:s}=X(),y=Oe(),[i,x]=p({}),[D,o]=p(""),[k,N]=p([]),[h,P]=p("default"),[I,V]=p(!1),[u,d]=p({exact:!1,userAttribute:[]}),[C,U]=p({}),[R,T]=p(""),[K,O]=p(0),t=()=>O(K+1);Be(async()=>{try{return await Promise.all([He(r),r.users.getProfile()])}catch{return[{},{}]}},([n,g])=>{x(n),U(g)},[]);const A=async(n,g,ae)=>{const F={first:n,max:g,q:R,exact:u.exact},L=ae||D||"";if(L&&(F.search=L),!Z&&!(F.search||F.q))return[];try{return await nt(r,{briefRepresentation:!0,...F})}catch(se){return i.userProfileProvidersEnabled?m("noUsersFoundErrorStorage",se):m("noUsersFoundError",se),[]}},[G,f]=ce({titleKey:"unlockAllUsers",messageKey:"unlockUsersConfirm",continueButtonLabel:"unlock",onConfirm:async()=>{try{await r.attackDetection.delAll(),t(),c(a("unlockUsersSuccess"),q.success)}catch(n){m("unlockUsersError",n)}}}),[B,$]=ce({titleKey:"deleteConfirmUsers",messageKey:a("deleteConfirmDialog",{count:k.length}),continueButtonLabel:"delete",continueButtonVariant:Y.danger,onConfirm:async()=>{try{for(const n of k)await r.users.del({id:n.id});N([]),j(),c(a("userDeletedSuccess"),q.success)}catch(n){m("userDeletedError",n)}}}),J=()=>y(Ye({realm:b}));if(!i||!s)return e(Le,{});const Z=!i.userProfileProvidersEnabled,j=()=>{d({exact:!1,userAttribute:[]}),o(""),T(""),t()},ee=n=>n.userAttribute.map(g=>`${g.name}:${g.value}`).join(" "),ve=()=>{const n=ee(u);T(n),t()},te=()=>e(Xe,{children:u.userAttribute.length>0&&e(v,{children:Object.values(u.userAttribute).map(n=>e(Je,{className:"pf-v5-u-mt-md pf-v5-u-mr-md","data-testid":"user-attribute-search-chips-group",categoryName:n.displayName.length?n.displayName:n.name,isClosable:!0,onClick:g=>{g.stopPropagation();const F={userAttribute:[...u.userAttribute].filter(L=>L.name!==n.name),exact:u.exact};d(F),T(ee(F)),t()},children:e(Ze,{isReadOnly:!0,children:n.value},n.name)},n.name))})}),re=()=>e(mt,{searchDropdownOpen:I,setSearchDropdownOpen:V,realm:s,hasSelectedRows:k.length===0,toggleDeleteDialog:B,toggleUnlockUsersDialog:G,goToCreate:J,searchType:h,setSearchType:P,searchUser:D,setSearchUser:o,activeFilters:u,setActiveFilters:d,refresh:t,profile:C,clearAllFilters:j,createAttributeSearchChips:te,searchUserWithAttributes:ve}),ke=()=>{if(u.userAttribute.length)return l("div",{className:"user-attribute-search-form-subtoolbar",children:[e(E,{children:te()}),e(E,{children:e(w,{variant:"link",onClick:()=>{j()},children:a("clearAllFilters")})})]})};return l(v,{children:[e($,{}),e(f,{}),e(_e,{isSearching:D!==""||u.userAttribute.length!==0,loader:A,isPaginated:!0,ariaLabelKey:"titleUsers",canSelectAll:!0,onSelect:n=>N([...n]),emptyState:Z?e(je,{message:a("noUsersFound"),instructions:a("emptyInstructions"),primaryActionText:a("createNewUser"),onPrimaryAction:J}):l(v,{children:[e(qe,{children:e(Ge,{children:re()})}),e($e,{"data-testid":"empty-state",variant:"lg",children:e(Q,{className:"kc-search-users-text",children:e(_,{children:a("searchForUserDescription")})})})]}),toolbarItem:re(),subToolbar:ke(),actionResolver:n=>{const g=n.data;return g.access?.manage?[{title:a("delete"),onClick:()=>{N([g]),B()}}]:[]},columns:[{name:"username",displayKey:"username",cellRenderer:ht},{name:"email",displayKey:"email",cellRenderer:pt},{name:"lastName",displayKey:"lastName",cellFormatters:[H()]},{name:"firstName",displayKey:"firstName",cellFormatters:[H()]}]},K)]})}function Qt(){const{t:r}=S(),{realm:a}=X(),{hasAccess:c}=ge(),b=et()(tt.AdminFineGrainedAuthz)&&c("manage-authorization","manage-users","manage-clients"),s=x=>ct(oe({realm:a,tab:x})),y=s("list"),i=s("permissions");return l(v,{children:[e(Ce,{titleKey:"titleUsers",subKey:"usersExplain",helpUrl:rt.usersUrl,divider:!1}),e(at,{"data-testid":"users-page",variant:"light",className:"pf-v5-u-p-0",children:l(ot,{"data-testid":"user-tabs",defaultLocation:oe({realm:a,tab:"list"}),isBox:!0,mountOnEnter:!0,children:[e(ue,{id:"list","data-testid":"listTab",title:e(de,{children:r("userList")}),...y,children:e(ft,{})}),b&&e(ue,{id:"permissions","data-testid":"permissionsTab",title:e(de,{children:r("permissions")}),...i,children:e(st,{type:"users"})})]})})]})}export{Qt as default};
//# sourceMappingURL=UsersSection-Bn8cNWoc.js.map

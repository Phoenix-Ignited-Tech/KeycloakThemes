import{jsx as t,jsxs as S,Fragment as K}from"react/jsx-runtime";import{u as k,a as L,d as N,c as U,$ as _,bl as $,C as q,B as H,j as l,bo as Q,aQ as z,D as G,P as f,bp as w,bq as J,br as W,aF as X}from"./main-hZIJIVx9.js";import{useState as T}from"react";import{c as Y,C as v,A as Z}from"./ClientScopeTypes-AzIBTaPZ.js";import{u as ee}from"./ConfirmDialog-BClP8m2C.js";import{R as te}from"./AddRoleMappingModal-C4wZesy5.js";import{R as ae,u as oe}from"./RoutableTabs-B1siEmtL.js";import{V as ie}from"./ViewHeader-DxK8RzXz.js";import{u as se}from"./useParams-tGf6FJmU.js";import{M as ne}from"./MapperList-C9Go8WyH.js";import{S as re}from"./ScopeForm-BVEOue_R.js";import{a as g,b as h}from"./Tabs-DXjNMDMz.js";import"react-dom";import"./translationFormatter-QNso5xUZ.js";import"./useLocaleSort-Cjd-LyWL.js";import"./filter-icon-B5V3NoWK.js";import"./PageHandler-B0KkvOoM.js";import"./DynamicComponents-v6e2RtHb.js";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./CodeEditor-BZUGCa3z.js";import"./copy-icon-Cy7M-mD5.js";import"./GroupPickerDialog-CppD_q_3.js";import"./DataListItemRow-B1CYYhSa.js";import"./KeySelect-BUhUx10e.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-DThNyrNa.js";import"./PageList-DUHf6xan.js";import"./utils-C-TUnOch.js";import"./SwitchControl-CuqH9Ng4.js";import"./FormAccess-DIV7UK1Y.js";function Ue(){const{adminClient:n}=k(),{t:o}=L(),C=N(),{realm:d}=U(),{id:r}=se(),{addAlert:c,addError:p}=_(),{enabled:D}=$(),[i,M]=T(),[y,R]=T(0),b=()=>R(y+1);q(async()=>{const e=await n.clientScopes.findOne({id:r});if(!e)throw new Error(o("notFound"));return{...e,type:await A(e)}},e=>{M(e)},[y,r]);async function A(e){return(await n.clientScopes.listDefaultClientScopes()).find(u=>u.name===e.name)?v.default:(await n.clientScopes.listDefaultOptionalClientScopes()).find(u=>u.name===e.name)?v.optional:Z.none}const m=e=>oe(W({realm:d,id:r,tab:e})),E=m("settings"),x=m("mappers"),I=m("scope"),P=async e=>{const a=X({...e,name:e.name?.trim().replace(/ /g,"_")});try{await n.clientScopes.update({id:r},a),await Y(n,{...a,id:r},a.type),c(o("updateSuccessClientScope"),l.success)}catch(s){p("updateErrorClientScope",s)}},[V,B]=ee({titleKey:o("deleteClientScope",{count:1,name:i?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:H.danger,onConfirm:async()=>{try{await n.clientScopes.del({id:r}),c(o("deletedSuccessClientScope"),l.success),C(Q({realm:d}))}catch(e){p("deleteErrorClientScope",e)}}}),F=async e=>{try{const a=e.filter(s=>s.client===void 0).map(s=>s.role).flat();await n.clientScopes.addRealmScopeMappings({id:r},a),await Promise.all(e.filter(s=>s.client!==void 0).map(s=>n.clientScopes.addClientScopeMappings({id:r,client:s.client.id},[s.role]))),c(o("roleMappingUpdatedSuccess"),l.success)}catch(a){p("roleMappingUpdatedError",a)}},O=async e=>{if(Array.isArray(e))try{await n.clientScopes.addMultipleProtocolMappers({id:i.id},e),b(),c(o("mappingCreatedSuccess"),l.success)}catch(a){p("mappingCreatedError",a)}else{const a=e;C(w({realm:d,id:i.id,mapperId:a.id}))}},j=async e=>{try{await n.clientScopes.delProtocolMapper({id:i.id,mapperId:e.id}),c(o("mappingDeletedSuccess"),l.success),b()}catch(a){p("mappingDeletedError",a)}return!0};return i?S(K,{children:[t(B,{}),t(ie,{titleKey:i.name,dropdownItems:[t(G,{onClick:V,children:o("delete")},"delete")],badges:[{text:i.protocol}],divider:!1}),t(f,{variant:"light",className:"pf-v5-u-p-0",children:S(ae,{isBox:!0,children:[t(g,{id:"settings","data-testid":"settings",title:t(h,{children:o("settings")}),...E,children:t(f,{variant:"light",children:t(re,{save:P,clientScope:i})})}),t(g,{id:"mappers","data-testid":"mappers",title:t(h,{children:o("mappers")}),...x,children:t(ne,{model:i,onAdd:O,onDelete:j,detailLink:e=>w({realm:d,id:i.id,mapperId:e})})}),S(g,{id:"scope","data-testid":"scopeTab",title:t(h,{children:o("scope")}),...I,children:[D&&t(f,{children:t(J,{variant:"info",isInline:!0,title:o("clientScopesRolesScope"),component:"h2"})}),t(te,{id:i.id,name:i.name,type:"clientScopes",save:F})]})]})})]}):t(z,{})}export{Ue as default};
//# sourceMappingURL=EditClientScope-34OdMV0_.js.map

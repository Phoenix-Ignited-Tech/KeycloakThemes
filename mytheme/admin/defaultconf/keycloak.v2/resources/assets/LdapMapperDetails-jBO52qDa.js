import{jsx as a,jsxs as I,Fragment as B}from"react/jsx-runtime";import{u as G,f as H,d as N,c as Q,a as U,$ as R,C as z,B as W,j as V,fk as L,aZ as Z,aQ as _,D as k,P as J,F as X,Q as v,a_ as Y,a$ as ee,b0 as ae,c4 as te,c5 as re,aG as oe,A as ne,h as M,aE as pe,aF as se}from"./main-hZIJIVx9.js";import{useState as y}from"react";import{u as ie}from"./ConfirmDialog-BClP8m2C.js";import{c as de,D as le}from"./DynamicComponents-v6e2RtHb.js";import{F as ce}from"./FormAccess-DIV7UK1Y.js";import{V as me}from"./ViewHeader-DxK8RzXz.js";import{u as ue}from"./useParams-tGf6FJmU.js";import"react-dom";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./CodeEditor-BZUGCa3z.js";import"./copy-icon-Cy7M-mD5.js";import"./GroupPickerDialog-CppD_q_3.js";import"./DataListItemRow-B1CYYhSa.js";import"./KeySelect-BUhUx10e.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-DThNyrNa.js";import"./AddRoleMappingModal-C4wZesy5.js";import"./translationFormatter-QNso5xUZ.js";import"./useLocaleSort-Cjd-LyWL.js";import"./filter-icon-B5V3NoWK.js";function Ke(){const{adminClient:l}=G(),p=H(),[i,x]=y(),[c,P]=y(),{id:f,mapperId:o}=ue(),m=N(),{realm:g}=Q(),{t:e}=U(),{addAlert:h,addError:T}=R(),[D,w]=y(!1),[C,E]=y(0),O=()=>E(C+1);z(async()=>{const r=await l.components.listSubComponents({id:f,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(o&&o!=="new"){const t=await l.components.findOne({id:o});return{components:r,fetchedMapper:t}}return{components:r}},({components:r,fetchedMapper:t})=>{if(x(t),P(r),o!=="new"&&!t)throw new Error(e("notFound"));t&&b(t)},[]);const b=r=>{pe(r,p.setValue)},K=async r=>{const t=se(r),n={...t,config:Object.entries(t.config||{}).reduce((u,[q,S])=>(u[q]=Array.isArray(S)?S:[S],u),{})};try{o==="new"?(await l.components.create(n),m(L({realm:g,id:r.parentId,tab:"mappers"}))):await l.components.update({id:o},n),b(n),h(e(o==="new"?"mappingCreatedSuccess":"mappingUpdatedSuccess"),V.success)}catch(u){T(o==="new"?"mappingCreatedError":"mappingUpdatedError",u)}},F=async r=>{try{const t=await l.userStorageProvider.mappersSync({parentId:i?.parentId||"",id:o,direction:r});h(e("syncLDAPGroupsSuccessful",{result:t.status}))}catch(t){T("syncLDAPGroupsError",t)}O()},[j,$]=ie({titleKey:"deleteMappingTitle",messageKey:"deleteMappingConfirm",continueButtonLabel:"delete",continueButtonVariant:W.danger,onConfirm:async()=>{try{await l.components.del({id:i.id}),h(e("mappingDeletedSuccess"),V.success),m(L({id:f,realm:g,tab:"mappers"}))}catch(r){T("mappingDeletedError",r)}}}),A=Z({control:p.control,name:"providerId"});if(!c)return a(_,{});const d=o==="new",s=c.find(r=>r.id===A);return I(B,{children:[a($,{}),a(me,{titleKey:i?i.name:e("createNewMapper"),dropdownItems:d?void 0:[a(k,{onClick:j,children:e("delete")},"delete"),...s?.metadata.fedToKeycloakSyncSupported?[a(k,{onClick:()=>F("fedToKeycloak"),children:e(s.metadata.fedToKeycloakSyncMessage)},"fedSync")]:[],...s?.metadata.keycloakToFedSyncSupported?[a(k,{onClick:()=>{F("keycloakToFed")},children:e(s.metadata.keycloakToFedSyncMessage)},"ldapSync")]:[]]},C),a(J,{variant:"light",isFilled:!0,children:a(X,{...p,children:I(ce,{role:"manage-realm",isHorizontal:!0,onSubmit:p.handleSubmit(()=>K(p.getValues())),children:[!d&&a(v,{name:"id",label:e("id"),isDisabled:!0}),a(v,{name:"name",label:e("name"),labelIcon:e("mapperNameHelp"),isDisabled:!d,rules:{required:e("required")}}),a("input",{type:"hidden",defaultValue:d?f:i?i.parentId:"","data-testid":"ldap-mapper-parentId",...p.register("parentId")}),a("input",{type:"hidden",defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper","data-testid":"ldap-mapper-provider-type",...p.register("providerType")}),d?a(Y,{label:e("mapperType"),labelIcon:a(ee,{helpText:s?.helpText?s.helpText:e("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:a(ae,{name:"providerId",defaultValue:"",control:p.control,"data-testid":"ldap-mapper-type-select",render:({field:r})=>a(te,{toggleId:"kc-providerId",typeAheadAriaLabel:e("mapperType"),onToggle:()=>w(!D),isOpen:D,onSelect:t=>{b({providerId:t,...Object.fromEntries(c.find(n=>n.id===t)?.properties.filter(n=>n.type==="List").map(n=>[de(n.name),n.options?.[0]])||[])}),w(!1)},selections:r.value,variant:re.typeahead,"aria-label":e("selectMapperType"),children:c.map(t=>a(oe,{value:t.id,children:t.id},t.id))})})}):a(v,{name:"providerId",label:e("mapperType"),labelIcon:s?.helpText?s.helpText:e("mapperTypeHelp"),rules:{required:e("required")},isDisabled:!d}),!!A&&a(le,{properties:s?.properties}),I(ne,{children:[a(M,{isDisabled:!p.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:e("save")}),a(M,{variant:"link",onClick:()=>m(d?-1:`/${g}/user-federation/ldap/${i.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:e("cancel")})]})]})})})]})}export{Ke as default};
//# sourceMappingURL=LdapMapperDetails-jBO52qDa.js.map

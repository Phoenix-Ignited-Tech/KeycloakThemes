import{jsxs as U,jsx as a,Fragment as W}from"react/jsx-runtime";import{_ as ne,l as F,dj as ge,bd as De,cI as Ge,dk as et,m as Oe,bF as Ee,dl as Ie,dm as ke,n as tt,dn as at,dp as nt,dq as Se,dr as st,ds as it,dt as rt,a as $,du as Z,c as se,dv as ie,dw as ot,dx as xe,L as ue,u as Q,$ as X,f as Le,C as re,P as Be,dy as Fe,cR as Te,aF as lt,j as me,M as ct,q as dt,X as ut,h as oe,B as Ke,F as mt,r as pt,bq as ht,Q as gt,bY as le,aP as Y,aA as fe,aB as be,bt as ve,aC as we,D as P,aY as Ue,dz as ft,s as $e,aQ as qe,cT as je,bv as he,cy as bt,o as vt,cx as wt,dA as yt,d as ye,w as Ct,cb as Nt,cc as Me,dB as Ae,da as ae,az as ze,dC as Gt,bA as Et,bB as It,dD as kt,dE as St,dF as xt,dG as Tt,dg as Mt,bm as At}from"./main-hZIJIVx9.js";import*as K from"react";import R,{useState as M,useEffect as He,useRef as Re}from"react";import{P as Rt}from"./PermissionTab-CKSyLWea.js";import{V as Vt}from"./ViewHeader-DxK8RzXz.js";import{u as z}from"./useToggle-K3Kx99tM.js";import{A as _t}from"./AttributeForm-BLb7UvaY.js";import{R as Dt}from"./AddRoleMappingModal-C4wZesy5.js";import{C as Ot}from"./ConfirmDialog-BClP8m2C.js";import{G as Lt}from"./GroupPickerDialog-CppD_q_3.js";import{M as Bt}from"./MembersModal-DbSHFuMg.js";import{T as Ft,a as ee,b as te}from"./Tabs-DXjNMDMz.js";import"react-dom";import"./useLocaleSort-Cjd-LyWL.js";import"./Trans-CPgnEO0T.js";import"./FormAccess-DIV7UK1Y.js";import"./copy-icon-Cy7M-mD5.js";import"./KeyValueInput-CYwzrckm.js";import"./KeySelect-BUhUx10e.js";import"./translationFormatter-QNso5xUZ.js";import"./filter-icon-B5V3NoWK.js";import"./DataListItemRow-B1CYYhSa.js";const Qe=t=>{var{className:e="",children:n,hasNoPadding:o=!1}=t,c=ne(t,["className","children","hasNoPadding"]);return K.createElement("div",Object.assign({className:F(ge.drawerBody,o&&ge.modifiers.noPadding,e)},c),n)};Qe.displayName="DrawerPanelBody";const Pe=t=>{var{className:e="",children:n,hasNoPadding:o=!1}=t,c=ne(t,["className","children","hasNoPadding"]);return K.createElement(Qe,{hasNoPadding:o},K.createElement("div",Object.assign({className:F(ge.drawerHead,e)},c),n))};Pe.displayName="DrawerHead";const G={badge:"pf-v5-c-badge",dirRtl:"pf-v5-m-dir-rtl",modifiers:{compact:"pf-m-compact",guides:"pf-m-guides",expanded:"pf-m-expanded",noBackground:"pf-m-no-background",current:"pf-m-current",read:"pf-m-read",selectable:"pf-m-selectable",truncate:"pf-m-truncate"},themeDark:"pf-v5-theme-dark",treeView:"pf-v5-c-tree-view",treeViewAction:"pf-v5-c-tree-view__action",treeViewContent:"pf-v5-c-tree-view__content",treeViewListItem:"pf-v5-c-tree-view__list-item",treeViewNode:"pf-v5-c-tree-view__node",treeViewNodeCheck:"pf-v5-c-tree-view__node-check",treeViewNodeContainer:"pf-v5-c-tree-view__node-container",treeViewNodeContent:"pf-v5-c-tree-view__node-content",treeViewNodeCount:"pf-v5-c-tree-view__node-count",treeViewNodeIcon:"pf-v5-c-tree-view__node-icon",treeViewNodeText:"pf-v5-c-tree-view__node-text",treeViewNodeTitle:"pf-v5-c-tree-view__node-title",treeViewNodeToggle:"pf-v5-c-tree-view__node-toggle",treeViewNodeToggleIcon:"pf-v5-c-tree-view__node-toggle-icon",treeViewSearch:"pf-v5-c-tree-view__search"},We=t=>{var{isNested:e=!1,isMultiSelectable:n=!1,toolbar:o,children:c,"aria-label":s,"aria-labelledby":i}=t,r=ne(t,["isNested","isMultiSelectable","toolbar","children","aria-label","aria-labelledby"]);return K.createElement(K.Fragment,null,o&&K.createElement(K.Fragment,null,o,K.createElement(De,null)),K.createElement("ul",Object.assign({className:F(`${G.treeView}__list`),role:e?"group":"tree","aria-multiselectable":e?void 0:n,"aria-label":s,"aria-labelledby":i},r),c))};We.displayName="TreeViewList";const Kt=({name:t,title:e,id:n,isExpanded:o,defaultExpanded:c=!1,children:s=null,onSelect:i,onExpand:r,onCollapse:d,onCheck:l,hasCheckbox:f=!1,checkProps:S={checked:!1},hasBadge:C=!1,customBadgeContent:x,badgeProps:h={isRead:!0},isSelectable:w=!1,isCompact:O,activeItems:L=[],itemData:u,parentItem:v,icon:T,expandedIcon:V,action:b,compareItems:B,useMemo:g})=>{const[N,p]=M(c);He(()=>{o!=null?p(o):c!=null&&p(N||c)},[o,c]);let m="button";f?m="label":w&&(m="div");const I=f||w?"button":"span",_=y=>R.createElement(I,Object.assign({className:F(G.treeViewNodeToggle),onClick:E=>{(w||f)&&(N?d&&d(E,u,v):r&&r(E,u,v),p(!N)),w&&E.stopPropagation()}},(f||w)&&{"aria-labelledby":`label-${y}`},I==="button"&&{type:"button"},{tabIndex:-1}),R.createElement("span",{className:F(G.treeViewNodeToggleIcon)},R.createElement(Oe,{"aria-hidden":"true"}))),q=S.checked===null?!1:S.checked,D=y=>R.createElement("span",{className:F(G.treeViewNodeCheck)},R.createElement("input",Object.assign({type:"checkbox",onChange:E=>l&&l(E,u,v),onClick:E=>E.stopPropagation(),ref:E=>E&&(E.indeterminate=S.checked===null)},S,{checked:q,id:y,tabIndex:-1}))),j=R.createElement("span",{className:F(G.treeViewNodeIcon)},!N&&T,N&&(V||T)),ce=()=>{const y=R.createElement(R.Fragment,null,O&&e&&R.createElement("span",{className:F(G.treeViewNodeTitle)},e),w?R.createElement("button",{tabIndex:-1,className:F(G.treeViewNodeText),type:"button"},t):R.createElement("span",{className:F(G.treeViewNodeText)},t));return O?R.createElement("span",{className:F(G.treeViewNodeContent)},y):y},k=R.createElement(R.Fragment,null,C&&s&&R.createElement("span",{className:F(G.treeViewNodeCount)},R.createElement(Ge,Object.assign({},h),x||s.props.data.length)),C&&!s&&x!==void 0&&R.createElement("span",{className:F(G.treeViewNodeCount)},R.createElement(Ge,Object.assign({},h),x))),A=(!s||w)&&L&&L.length>0&&L.some(y=>B&&y&&B(y,u));return R.createElement("li",Object.assign({id:n,className:F(G.treeViewListItem,N&&G.modifiers.expanded),"aria-expanded":N,role:"treeitem",tabIndex:-1},f&&{"aria-checked":q},!f&&{"aria-selected":A}),R.createElement("div",{className:F(G.treeViewContent)},R.createElement(et,{prefix:w?"selectable-id":"checkbox-id"},y=>R.createElement(m,Object.assign({className:F(G.treeViewNode,s&&(w||f)&&G.modifiers.selectable,A&&G.modifiers.current),onClick:E=>{f||(i&&i(E,u,v),!w&&s&&E.isDefaultPrevented()!==!0&&(N?d&&d(E,u,v):r&&r(E,u,v),p(!N)))}},f&&{htmlFor:y},(f||w&&s)&&{id:`label-${y}`},m==="button"&&{type:"button"}),R.createElement("span",{className:F(G.treeViewNodeContainer)},s&&_(y),f&&D(y),T&&j,ce(),k))),b&&R.createElement("div",{className:F(G.treeViewAction)},b)),N&&s)},Xe=R.memo(Kt,(t,e)=>{if(!e.useMemo)return!1;const n=t.activeItems&&t.activeItems.length>0&&t.activeItems.some(c=>t.compareItems&&c&&t.compareItems(c,t.itemData)),o=e.activeItems&&e.activeItems.length>0&&e.activeItems.some(c=>e.compareItems&&c&&e.compareItems(c,e.itemData));return!(n||o||t.name!==e.name||t.title!==e.title||t.id!==e.id||t.isExpanded!==e.isExpanded||t.defaultExpanded!==e.defaultExpanded||t.onSelect!==e.onSelect||t.onCheck!==e.onCheck||t.onExpand!==e.onExpand||t.onCollapse!==e.onCollapse||t.hasCheckbox!==e.hasCheckbox||t.checkProps!==e.checkProps||t.hasBadge!==e.hasBadge||t.customBadgeContent!==e.customBadgeContent||t.badgeProps!==e.badgeProps||t.isCompact!==e.isCompact||t.icon!==e.icon||t.expandedIcon!==e.expandedIcon||t.action!==e.action||t.parentItem!==e.parentItem||t.itemData!==e.itemData)});Xe.displayName="TreeViewListItem";class Ut extends K.Component{constructor(){super(...arguments),this.displayName="TreeViewRoot",this.treeRef=K.createRef(),this.handleKeys=e=>{var n,o,c,s,i,r,d;if(!this.treeRef.current.contains(e.target)||!e.target.classList.contains(G.treeViewNode))return;const l=document.activeElement,f=e.key,S=Array.from((n=this.treeRef.current)===null||n===void 0?void 0:n.getElementsByClassName(G.treeViewNode)).filter(C=>!C.classList.contains("pf-m-disabled"));if(f===Ee.Space&&(l.click(),e.preventDefault()),Ie(e,S,C=>l===C,void 0,[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(f)){const C=(c=(o=l?.firstElementChild)===null||o===void 0?void 0:o.firstElementChild)===null||c===void 0?void 0:c.classList.contains(G.treeViewNodeToggle),x=(s=l?.closest("li"))===null||s===void 0?void 0:s.classList.contains("pf-m-expanded");if(f==="ArrowLeft")if(C&&x)l.click();else{const h=(i=l?.closest("ul"))===null||i===void 0?void 0:i.parentElement;if(h?.tagName!=="DIV"){const w=h?.querySelector("button");l.tabIndex=-1,w&&(w.tabIndex=0,w.focus())}}else if(C&&!x){l.tabIndex=-1,l.click();const h=(d=(r=l?.closest("li"))===null||r===void 0?void 0:r.querySelector("ul > li"))===null||d===void 0?void 0:d.querySelector("button");h&&(h.tabIndex=0,h.focus())}e.preventDefault()}},this.handleKeysCheckbox=e=>{var n,o,c,s,i;if(!this.treeRef.current.contains(e.target))return;const r=document.activeElement,d=e.key;d===Ee.Space&&(r.click(),e.preventDefault());const l=Array.from((n=this.treeRef.current)===null||n===void 0?void 0:n.getElementsByClassName(G.treeViewNode));Ie(e,l,f=>f.contains(r),f=>f.querySelector("button,input"),[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(d)&&(d==="ArrowLeft"?r?.tagName==="INPUT"?!((o=r?.parentElement)===null||o===void 0)&&o.previousSibling&&r.parentElement.previousSibling.focus():r?.previousSibling&&(((c=r.previousElementSibling)===null||c===void 0?void 0:c.tagName)==="SPAN"?r.previousSibling.firstChild.focus():r.previousSibling.focus()):r?.tagName==="INPUT"?!((s=r.parentElement)===null||s===void 0)&&s.nextSibling&&r.parentElement.nextSibling.focus():r?.nextSibling&&(((i=r.nextElementSibling)===null||i===void 0?void 0:i.tagName)==="SPAN"?r.nextSibling.firstChild.focus():r.nextSibling.focus()),e.preventDefault())},this.variantStyleModifiers={default:"",compact:G.modifiers.compact,compactNoBackground:[G.modifiers.compact,G.modifiers.noBackground]}}componentDidMount(){var e;if(ke&&window.addEventListener("keydown",this.props.hasCheckboxes||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys),this.props.hasCheckboxes||this.props.hasSelectableNodes){const n=this.treeRef.current.getElementsByClassName(G.treeViewNodeToggle)[0];if(n&&(n.tabIndex=0),this.props.hasCheckboxes){const o=this.treeRef.current.getElementsByTagName("INPUT")[0];o&&(o.tabIndex=0)}if(this.props.hasSelectableNodes){const o=this.treeRef.current.getElementsByClassName(G.treeViewNodeText)[0];o&&(o.tabIndex=0)}}else((e=this.treeRef.current)===null||e===void 0?void 0:e.getElementsByClassName(G.treeViewNode)[0]).tabIndex=0}componentWillUnmount(){ke&&window.removeEventListener("keydown",this.props.hasCheckboxes||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys)}render(){const e=this.props,{children:n,hasCheckboxes:o,hasGuides:c,variant:s,className:i,hasSelectableNodes:r}=e,d=ne(e,["children","hasCheckboxes","hasGuides","variant","className","hasSelectableNodes"]);return K.createElement("div",Object.assign({className:F(G.treeView,c&&G.modifiers.guides,this.variantStyleModifiers[s],i),ref:this.treeRef},d),n)}}const Ce=t=>{var{data:e,isNested:n=!1,hasCheckboxes:o=!1,hasBadges:c=!1,hasGuides:s=!1,hasSelectableNodes:i=!1,variant:r="default",defaultAllExpanded:d=!1,allExpanded:l,icon:f,isMultiSelectable:S=!1,expandedIcon:C,parentItem:x,onSelect:h,onCheck:w,onExpand:O,onCollapse:L,toolbar:u,activeItems:v,compareItems:T=(m,I)=>m.id===I.id,className:V,useMemo:b,"aria-label":B,"aria-labelledby":g}=t,N=ne(t,["data","isNested","hasCheckboxes","hasBadges","hasGuides","hasSelectableNodes","variant","defaultAllExpanded","allExpanded","icon","isMultiSelectable","expandedIcon","parentItem","onSelect","onCheck","onExpand","onCollapse","toolbar","activeItems","compareItems","className","useMemo","aria-label","aria-labelledby"]);const p=K.createElement(We,{isNested:n,toolbar:u,isMultiSelectable:S,"aria-label":B,"aria-labelledby":g},e.map(m=>{var I,_;return K.createElement(Xe,Object.assign({key:((I=m.id)===null||I===void 0?void 0:I.toString())||((_=m.name)===null||_===void 0?void 0:_.toString()),name:m.name,title:m.title,id:m.id,isExpanded:l,isSelectable:i,defaultExpanded:m.defaultExpanded!==void 0?m.defaultExpanded:d,onSelect:h,onCheck:w,onExpand:O,onCollapse:L,hasCheckbox:m.hasCheckbox!==void 0?m.hasCheckbox:o,checkProps:m.checkProps,hasBadge:m.hasBadge!==void 0?m.hasBadge:c,customBadgeContent:m.customBadgeContent,badgeProps:m.badgeProps,activeItems:v,parentItem:x,itemData:m,icon:m.icon!==void 0?m.icon:f,expandedIcon:m.expandedIcon!==void 0?m.expandedIcon:C,action:m.action,compareItems:T,isCompact:r==="compact"||r==="compactNoBackground",useMemo:b},m.children&&{children:K.createElement(Ce,{data:m.children,isNested:!0,parentItem:m,hasCheckboxes:o,hasBadges:c,hasGuides:s,hasSelectableNodes:i,variant:r,allExpanded:l,defaultAllExpanded:d,onSelect:h,onCheck:w,onExpand:O,onCollapse:L,activeItems:v,icon:f,expandedIcon:C})}))}));return K.createElement(K.Fragment,null,x?p:K.createElement(Ut,Object.assign({hasSelectableNodes:i,hasCheckboxes:o,hasGuides:s,variant:r,className:V},N),p))};Ce.displayName="TreeView";const $t={name:"TreeIcon",height:512,width:384,svgPath:"M378.31 378.49L298.42 288h30.63c9.01 0 16.98-5 20.78-13.06 3.8-8.04 2.55-17.26-3.28-24.05L268.42 160h28.89c9.1 0 17.3-5.35 20.86-13.61 3.52-8.13 1.86-17.59-4.24-24.08L203.66 4.83c-6.03-6.45-17.28-6.45-23.32 0L70.06 122.31c-6.1 6.49-7.75 15.95-4.24 24.08C69.38 154.65 77.59 160 86.69 160h28.89l-78.14 90.91c-5.81 6.78-7.06 15.99-3.27 24.04C37.97 283 45.93 288 54.95 288h30.63L5.69 378.49c-6 6.79-7.36 16.09-3.56 24.26 3.75 8.05 12 13.25 21.01 13.25H160v24.45l-30.29 48.4c-5.32 10.64 2.42 23.16 14.31 23.16h95.96c11.89 0 19.63-12.52 14.31-23.16L224 440.45V416h136.86c9.01 0 17.26-5.2 21.01-13.25 3.8-8.17 2.44-17.47-3.56-24.26z",yOffset:0,xOffset:0},qt=tt($t);var Ve=at(function(t){var e=nt(t);return Se(e)&&(e=void 0),st(rt(t,1,Se,!0),it(e))});const jt=()=>{const{t}=$(),{clear:e,remove:n,subGroups:o}=Z(),{realm:c}=se(),s=ie();return He(()=>{const{pathname:i}=s;(!i.includes("/groups")||i.endsWith("/groups"))&&e()},[s]),o.length!==0?U(ot,{children:[a(xe,{children:a(ue,{to:`/${c}/groups`,children:t("groups")})},"home"),o.map((i,r)=>{const d=r===o.length-1;return U(xe,{isActive:d,children:[!d&&a(ue,{to:s.pathname.substring(0,s.pathname.indexOf(i.id)+i.id.length),onClick:()=>n(i),children:i.name}),d&&(i.id==="search"?i.name:t("groupDetails"))]},i.id)})]}):null},Ye=t=>{const e=t.substring(1).split("/");return e.length>1?e.splice(2):void 0},pe=t=>{const e=Ye(t);return e?e[e.length-1]:void 0},zt=()=>{const{adminClient:t}=Q(),{t:e}=$(),{addAlert:n,addError:o}=X(),c=Le({mode:"onChange"}),s=ie(),i=pe(s.pathname),[r,d]=M();re(()=>t.groups.findOne({id:i}),f=>{c.reset({attributes:Te(f?.attributes)}),d(f)},[i]);const l=async f=>{try{const S=lt(f).attributes;await t.groups.update({id:i},{...r,attributes:S}),d({...r,attributes:S}),n(e("groupUpdated"),me.success)}catch(S){o("groupUpdateError",S)}};return a(Be,{variant:Fe.light,children:a(_t,{form:c,save:l,fineGrainedAccess:r?.access?.manage,reset:()=>c.reset({attributes:Te(r?.attributes)})})})},Ht=({id:t,name:e})=>{const{adminClient:n}=Q(),{t:o}=$(),{addAlert:c,addError:s}=X();return a(Dt,{name:e,id:t,type:"groups",save:async r=>{try{const d=r.filter(l=>l.client===void 0).map(l=>l.role).flat();await n.groups.addRealmRoleMappings({id:t,roles:d}),await Promise.all(r.filter(l=>l.client!==void 0).map(l=>n.groups.addClientRoleMappings({id:t,clientUniqueId:l.client.id,roles:[l.role]}))),c(o("roleMappingUpdatedSuccess"),me.success)}catch(d){s("roleMappingUpdatedError",d)}}})},J=({id:t,rename:e,duplicateId:n,handleModalToggle:o,refresh:c})=>{const{adminClient:s}=Q(),{t:i}=$(),{addAlert:r,addError:d}=X(),[l,f]=M(null),S=Le({defaultValues:{name:""}}),{handleSubmit:C,formState:x}=S;re(async()=>{if(n)return s.groups.findOne({id:n})},u=>{u&&(f(u),S.reset({name:i("copyOf",{name:u.name})}))},[n]);const h=async u=>{try{const v=[],T=await s.clients.find();for(const V of T){const B=(await s.groups.listClientRoleMappings({id:u,clientUniqueId:V.id})).filter(g=>g.id&&g.name).map(g=>({id:g.id,name:g.name}));B.length>0&&v.push({clientId:V.id,roles:B})}return v}catch(v){throw d("couldNotFetchClientRoleMappings",v),v}},w=async(u,v,T=!1)=>{try{const V={...u,name:T?u.name:i("copyOf",{name:u.name}),...v?{}:{attributes:l?.attributes}};delete V.id;const b=v?await s.groups.createChildGroup({id:v},V):await s.groups.create(V),B=await s.groups.listMembers({id:u.id});for(const D of B)await s.users.addToGroup({id:D.id,groupId:b.id});const g=await s.groups.listPermissions({id:u.id});g&&await s.groups.updatePermission({id:b.id},g);const p=(await s.groups.listRealmRoleMappings({id:u.id})).map(D=>({id:D.id,name:D.name})),I=(await h(u.id))?.flatMap(D=>D.roles.map(j=>({id:j.id,name:j.name,clientUniqueId:D.clientId}))),_=[...p,...I];await O(_,b.id);const q=await s.groups.listSubGroups({parentId:u.id});for(const D of q){const j=D.attributes;await w({...D,attributes:j},b.id,!0)}return b}catch(V){throw d("couldNotDuplicateGroup",V),V}},O=async(u,v)=>{try{const T=u.filter(b=>!b.clientUniqueId&&b.name),V=u.filter(b=>b.clientUniqueId&&b.name);await s.groups.addRealmRoleMappings({id:v,roles:T.map(({id:b,name:B})=>({id:b,name:B}))}),await Promise.all(V.map(b=>b.clientUniqueId&&b.name?s.groups.addClientRoleMappings({id:v,clientUniqueId:b.clientUniqueId,roles:[{id:b.id,name:b.name}]}):Promise.resolve()))}catch(T){d("roleMappingUpdatedError",T)}},L=async u=>{u.name=u.name?.trim();try{n&&l?await w(l):t?e?await s.groups.update({id:t},{...e,name:u.name}):await s.groups.updateChildGroup({id:t},u):await s.groups.create(u),c(e?{...e,name:u.name}:void 0),o(),r(i(e?"groupUpdated":n?"groupDuplicated":"groupCreated"),me.success)}catch(v){d("couldNotCreateGroup",v)}};return a(ct,{variant:dt.small,title:i(e?"renameAGroup":n?"duplicateAGroup":"createAGroup"),isOpen:!0,onClose:o,actions:[a(ut,{formState:x,"data-testid":`${e?"rename":n?"duplicate":"create"}Group`,form:"group-form",allowInvalid:!0,allowNonDirty:!0,children:i(e?"rename":n?"duplicate":"create")},"confirm"),a(oe,{id:"modal-cancel","data-testid":"cancel",variant:Ke.link,onClick:o,children:i("cancel")},"cancel")],children:a(mt,{...S,children:U(pt,{id:"group-form",isHorizontal:!0,onSubmit:C(L),children:[n&&a(ht,{variant:"warning",component:"h2",isInline:!0,title:i("duplicateGroupWarning")}),a(gt,{name:"name",label:i("name"),rules:{required:i("required")},autoFocus:!0})]})})})},Ne=({selectedRows:t,show:e,toggleDialog:n,refresh:o})=>{const{adminClient:c}=Q(),{t:s}=$(),{addAlert:i,addError:r}=X(),d=async()=>{try{for(const l of t)await c.groups.del({id:l.id});o(),i(s("groupDeleted",{count:t.length}))}catch(l){r("groupDeleteError",l)}};return a(Ot,{titleKey:s("deleteConfirmTitle",{count:t.length}),messageKey:s("deleteConfirmGroup",{count:t.length,groupName:t[0]?.name}),continueButtonLabel:"delete",continueButtonVariant:Ke.danger,onConfirm:d,open:e,toggleDialog:n})},Qt=({toggleCreate:t,toggleDelete:e,kebabDisabled:n})=>{const{t:o}=$(),{currentGroup:c}=Z(),{hasAccess:s}=le(),i=s("manage-users")||c()?.access?.manage,[r,d]=z();return i?U(W,{children:[a(Y,{children:a(oe,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:t,children:o("createGroup")})}),a(Y,{children:a(fe,{onOpenChange:d,toggle:l=>a(be,{ref:l,isExpanded:r,onClick:d,isDisabled:n,variant:"plain","aria-label":"Actions",children:a(ve,{})}),isOpen:r,children:a(we,{children:a(P,{component:"button",onClick:()=>{e(),d()},children:o("delete")},"action")})})})]}):a("div",{})},Pt=(t,e)=>e.id?t.groups.updateRoot(e):t.groups.create(e),Wt=async(t,e,n)=>t.groups.updateChildGroup({id:n.id},e),Je=({source:t,onClose:e,refresh:n})=>{const{adminClient:o}=Q(),{t:c}=$(),{addAlert:s,addError:i}=X();return a(Lt,{type:"selectOne",filterGroups:[t],text:{title:"moveToGroup",ok:"moveHere"},onClose:e,onConfirm:async d=>{try{await(d?Wt(o,t,d[0]):Pt(o,t)),n(),s(c("moveGroupSuccess"))}catch(l){i("moveGroupError",l)}},isMove:!0})},_e=({refresh:t})=>{const{adminClient:e}=Q(),{t:n}=$(),[o,c]=M([]),[s,i]=M(),[r,d]=z(),[l,f]=M(),[S,C]=z(),[x,h]=M(),{currentGroup:w}=Z(),[O,L]=M(0),u=()=>L(O+1),[v,T]=M(),V=ie(),b=pe(V.pathname),{hasAccess:B}=le(),g=B("manage-users")||w()?.access?.manage,N=async(p,m)=>{let I;if(b){const _={search:v||"",first:p,max:m,parentId:b};I=await e.groups.listSubGroups(_)}else{const _={search:v||"",first:p||void 0,max:m||void 0};I=await e.groups.find(_)}return I};return U(W,{children:[a(Ne,{show:S,toggleDialog:C,selectedRows:o,refresh:()=>{u(),t(),c([])}}),s&&a(J,{id:s.id,rename:s,refresh:()=>{u(),t()},handleModalToggle:()=>i(void 0)}),r&&a(J,{id:o[0]?.id||b,handleModalToggle:d,refresh:()=>{c([]),u(),t()}}),l&&a(J,{id:l,duplicateId:l,refresh:()=>{u(),t()},handleModalToggle:()=>f(void 0)}),x&&a(Je,{source:x,refresh:()=>{h(void 0),u(),t()},onClose:()=>h(void 0)}),a(Ue,{onSelect:p=>c([...p]),canSelectAll:!0,loader:N,ariaLabelKey:"groups",isPaginated:!0,isSearching:!!v,toolbarItem:U(W,{children:[a(Y,{children:a(ft,{"data-testid":"group-search",placeholder:n("filterGroups"),value:v,onChange:(p,m)=>{T(m)},onSearch:u,onClear:()=>{T(""),u()}})}),a(Qt,{toggleCreate:d,toggleDelete:C,kebabDisabled:o.length===0})]}),actions:g?[{title:n("rename"),onRowClick:async p=>(i(p),!1)},{title:n("moveTo"),onRowClick:async p=>(h(p),!1)},{title:n("createChildGroup"),onRowClick:async p=>(c([p]),d(),!1)},...b?[]:[{title:n("duplicate"),onRowClick:async p=>(f(p.id),!1)}],{isSeparator:!0},{title:n("delete"),onRowClick:async p=>(c([p]),C(),!0)}]:[],columns:[{name:"name",displayKey:"groupName",cellRenderer:p=>p.access?.view?a(ue,{to:`${V.pathname}/${p.id}`,children:p.name},p.id):a("span",{children:p.name})}],emptyState:a($e,{hasIcon:!0,message:n(`noGroupsInThis${b?"SubGroup":"Realm"}`),instructions:n(`noGroupsInThis${b?"SubGroup":"Realm"}Instructions`),primaryActionText:n("createGroup"),onPrimaryAction:d})},`${b}${O}`)]})},Xt=t=>{const{realm:e}=se(),{t:n}=$();return U(ue,{to:bt({realm:e,id:t.id,tab:"settings"}),children:[t.username," ",!t.enabled&&a(vt,{color:"red",icon:a(wt,{}),children:n("disabled")})]},t.id)},Yt=()=>{const{adminClient:t}=Q(),{t:e}=$(),{addAlert:n,addError:o}=X(),c=ie(),s=pe(c.pathname),[i,r]=M(!1),{currentGroup:d}=Z(),[l,f]=M(),[S,C]=M(!1),[x,h]=M(!1),[w,O]=M([]),{hasAccess:L}=le();re(()=>t.groups.findOne({id:d().id}),f,[]);const u=L("manage-users")||l?.access.manageMembership,[v,T]=M(0),V=()=>T(new Date().getTime()),b=async(g,N=0)=>{let p=[];if(!N||!g)return p;const m={parentId:g,first:0,max:N},I=await t.groups.listSubGroups(m);return p=p.concat(I),await Promise.all(I.map(_=>b(_.id,_.subGroupCount))).then(_=>{_.forEach(q=>p=p.concat(q))}),p},B=async(g,N)=>{if(!s)return[];let p=await t.groups.listMembers({id:s,briefRepresentation:!0,first:g,max:N});if(i&&l?.subGroupCount&&l.id){const m=await b(l.id,l.subGroupCount);await Promise.all(m.map(I=>t.groups.listMembers({id:I.id,briefRepresentation:!0}))).then(I=>{I.forEach(_=>p=p.concat(_))}),p=yt(p,I=>I.username)}return p};return l?U(W,{children:[S&&a(Bt,{membersQuery:(g,N)=>t.groups.listMembers({id:s,first:g,max:N}),onAdd:async g=>{try{await Promise.all(g.map(N=>t.users.addToGroup({id:N.id,groupId:s}))),n(e("usersAdded",{count:g.length}))}catch(N){o("usersAddedError",N)}},onClose:()=>{C(!1),V()}}),a(Ue,{"data-testid":"members-table",loader:B,ariaLabelKey:"members",isPaginated:!0,canSelectAll:!0,onSelect:g=>O([...g]),toolbarItem:u&&U(W,{children:[a(Y,{children:a(oe,{"data-testid":"addMember",variant:"primary",onClick:()=>C(!0),children:e("addMember")})}),a(Y,{children:a(je,{"data-testid":"includeSubGroupsCheck",label:e("includeSubGroups"),id:"kc-include-sub-groups",isChecked:i,onChange:()=>r(!i)})}),a(Y,{children:a(fe,{onOpenChange:g=>h(g),toggle:g=>a(be,{ref:g,variant:"plain",onClick:()=>h(!x),isExpanded:x,isDisabled:w.length===0,"aria-label":"Actions",children:a(ve,{})}),shouldFocusToggleOnSelect:!0,isOpen:x,children:a(we,{children:a(P,{component:"button",onClick:async()=>{try{await Promise.all(w.map(g=>t.users.delFromGroup({id:g.id,groupId:s}))),h(!1),n(e("usersLeft",{count:w.length}))}catch(g){o("usersLeftError",g)}V()},children:e("leave")},"action")})})})]}),actions:u?[{title:e("leave"),onRowClick:async g=>{try{await t.users.delFromGroup({id:g.id,groupId:s}),n(e("usersLeft",{count:1}))}catch(N){o("usersLeftError",N)}return!0}}]:[],columns:[{name:"username",displayKey:"name",cellRenderer:Xt},{name:"email",displayKey:"email",cellFormatters:[he()]},{name:"firstName",displayKey:"firstName",cellFormatters:[he()]},{name:"lastName",displayKey:"lastName",cellFormatters:[he()]}],emptyState:a($e,{message:e("noUsersFound"),instructions:u?e("emptyInstructions"):void 0,primaryActionText:u?e("addMember"):void 0,onPrimaryAction:()=>C(!0),secondaryActions:[{text:e("includeSubGroups"),onClick:()=>r(!0)}]})},`${s}${v}${i}`)]}):a(qe,{})};function Ze(t){let e=t.length;for(const n of t)n.subGroups&&(e+=Ze(n.subGroups));return e}const Jt=({group:t,refresh:e})=>{const{t:n}=$(),[o,c]=z(),[s,i]=z(),[r,d]=z(),[l,f]=z(),[S,C]=z(),x=ye(),{realm:h}=se();return U(W,{children:[s&&a(J,{id:t.id,rename:t,refresh:()=>{x(ae({realm:h})),e()},handleModalToggle:i}),r&&a(J,{id:t.id,handleModalToggle:d,refresh:e}),l&&a(Je,{source:t,refresh:e,onClose:f}),a(Ne,{show:S,toggleDialog:C,selectedRows:[t],refresh:()=>{x(ae({realm:h})),e()}}),a(fe,{popperProps:{position:"right"},onOpenChange:c,toggle:w=>a(be,{ref:w,onClick:c,isExpanded:o,variant:"plain","aria-label":"Actions",children:a(ve,{})}),isOpen:o,children:U(we,{children:[a(P,{onClick:i,children:n("rename")},"rename"),a(P,{onClick:f,children:n("moveTo")},"move"),a(P,{onClick:d,children:n("createChildGroup")},"create"),a(De,{},"separator"),",",a(P,{onClick:C,children:n("delete")},"delete")]})})]})},de=50,Zt=()=>{const{t}=$();return U(W,{children:[a(Gt,{size:"sm"})," ",t("spinnerLoading")]})},ea=[{name:a(Zt,{})}],ta=({refresh:t,canViewDetails:e})=>{const{adminClient:n}=Q(),{t:o}=$(),{realm:c}=se(),s=ye(),{addAlert:i}=X(),{hasAccess:r}=le(),[d,l]=M(),{subGroups:f,clear:S}=Z(),[C,x]=M(""),[h,w]=M(20),[O,L]=M(0),u=Re(0),v=Re(20),[T,V]=M(0),[b,B]=M(!1),[g,N]=M(),[p,m]=M(0),[I,_]=M(0),q=()=>{_(I+1),t()},D=(k,A)=>{const y=k.subGroupCount;return{id:k.id,name:a(ze,{content:k.name,children:a("span",{children:k.name})}),access:k.access||{},children:y?C.length===0?ea:k.subGroups?.map(E=>D(E,A)):void 0,action:(r("manage-users")||k.access?.manage)&&a(Jt,{group:k,refresh:A}),defaultExpanded:f.map(E=>E.id).includes(k.id)}};re(async()=>{const k=await Ae(n,"groups",Object.assign({first:`${O}`,max:`${h+1}`,exact:`${b}`,global:`${C!==""}`},C===""?null:{search:C}));let A=[];return g&&(A=await Ae(n,`groups/${g.id}/children`,{first:`${p}`,max:`${de}`})),{groups:k,subGroups:A}},({groups:k,subGroups:A})=>{if(g){const y=j(d||[],g.id,[]);if(y.length&&A.length){const E=y.pop();E.children=[...(Ve(E.children||[]).splice(0,de),A.map(H=>D(H,q),"id")),...A.length===de?[{id:"next",name:a(oe,{variant:"plain",onClick:()=>m(p+de),children:a(Oe,{})})}]:[]]}}C||u.current!==O||v.current!==h?l(k.map(y=>D(y,q))):l(Ve(d,k.map(y=>D(y,q)),"id")),V(Ze(k)),u.current=O,v.current=h},[I,O,p,h,C,b,g]);const j=(k,A,y)=>{for(let E=0;E<k.length;E++){const H=k[E];if(H.id===A)return y.push(H),y;H.children&&(y.push(H),j(H.children,A,y),y[y.length-1].id!==A&&y.pop())}return y},ce=(k,A)=>{if(k.id==="next")return;N(k);const y=j(A,k.id,[]);f.every(({id:E})=>y.find(H=>H.id===E))||S(),e||y.at(-1)?.access?.view||f.at(-1)?.access?.view?s(ae({realm:c,id:y.map(E=>E.id).join("/")})):(i(o("noViewRights"),me.warning),s(ae({realm:c})))};return d?a(Ct,{count:T,first:O,max:h,onNextClick:L,onPreviousClick:L,onPerPageSelect:(k,A)=>{L(k),w(A)},inputGroupName:"searchForGroups",inputGroupPlaceholder:o("searchForGroups"),inputGroupOnEnter:x,toolbarItem:U(Nt,{className:"pf-v5-u-pt-sm",children:[a(Me,{children:a(je,{id:"exact","data-testid":"exact-search",name:"exact",isChecked:b,onChange:(k,A)=>B(A)})}),a(Me,{children:a("label",{htmlFor:"exact",className:"pf-v5-u-pl-sm",children:o("exactSearch")})})]}),children:d.length>0&&a(Ce,{data:d.slice(0,h),allExpanded:C.length>0,activeItems:g?[g]:void 0,hasGuides:!0,hasSelectableNodes:!0,className:"keycloak_groups_treeview",onExpand:(k,A)=>{ce(A,d)},onSelect:(k,A)=>{ce(A,d)}})}):a(qe,{})};function Ea(){const{adminClient:t}=Q(),{t:e}=$(),[n,o]=M(0),{subGroups:c,setSubGroups:s,currentGroup:i}=Z(),{realm:r}=se(),[d,l]=M(),[f,S]=z(),C=ye(),x=ie(),h=pe(x.pathname),[w,O]=z(!0),[L,u]=M(0),v=()=>u(L+1),{hasAccess:T}=le(),b=Et()(It.AdminFineGrainedAuthz)&&T("manage-authorization","manage-users","manage-clients"),B=T("manage-users")||i()?.access?.manage,g=T("manage-users"),N=T("query-groups","view-users")||T("manage-users","query-groups"),p=T("view-users")||i()?.access?.viewMembers||i()?.access?.manageMembers;return re(async()=>{const m=Ye(x.pathname);if(m&&m.length>c.length){const _=[];for(const q of m){let D;if(q!=="search"?D=await t.groups.findOne({id:q}):D={name:e("searchGroups"),id:"search"},D)_.push(D);else throw new Error(e("notFound"))}return _}return[]},m=>{m.length&&s(m)},[h]),U(W,{children:[a(Ne,{show:f,toggleDialog:S,selectedRows:[i()],refresh:()=>{C(ae({realm:r})),v()}}),d&&a(J,{id:h,rename:d,refresh:m=>{v(),s([...c.slice(0,c.length-1),m])},handleModalToggle:()=>l(void 0)}),a(Be,{variant:Fe.light,className:"pf-v5-u-p-0",children:a(kt,{isInline:!0,isExpanded:w,position:"left",children:a(St,{panelContent:a(xt,{isResizable:!0,children:a(Pe,{children:a(ta,{refresh:v,canViewDetails:N})})}),children:U(Tt,{children:[a(ze,{content:e(w?"hide":"show"),children:a(oe,{"aria-label":e(w?"hide":"show"),variant:"plain",icon:w?a(Mt,{}):a(qt,{}),onClick:O})}),a(jt,{}),a(Vt,{titleKey:h?i()?.name:"groups",subKey:h?"":"groupsDescription",helpUrl:h?"":At.groupsUrl,divider:!h,dropdownItems:h&&B?[a(P,{"data-testid":"renameGroupAction",onClick:()=>l(i()),children:e("renameGroup")},"renameGroup"),a(P,{"data-testid":"deleteGroup",onClick:S,children:e("deleteGroup")},"deleteGroup")]:void 0}),c.length>0&&U(Ft,{inset:{default:"insetNone",md:"insetSm",xl:"insetLg","2xl":"inset2xl"},activeKey:n,onSelect:(m,I)=>o(I),isBox:!0,mountOnEnter:!0,unmountOnExit:!0,children:[a(ee,{"data-testid":"groups",eventKey:0,title:a(te,{children:e("childGroups")}),children:a(_e,{refresh:v})}),p&&a(ee,{"data-testid":"members",eventKey:1,title:a(te,{children:e("members")}),children:a(Yt,{})}),a(ee,{"data-testid":"attributes",eventKey:2,title:a(te,{children:e("attributes")}),children:a(zt,{})}),g&&a(ee,{eventKey:3,"data-testid":"role-mapping-tab",title:a(te,{children:e("roleMapping")}),children:a(Ht,{id:h,name:i()?.name})}),b&&a(ee,{eventKey:4,"data-testid":"permissionsTab",title:a(te,{children:e("permissions")}),children:a(Rt,{id:h,type:"groups"})})]}),c.length===0&&a(_e,{refresh:v})]})})},L)})]})}export{Ea as default};
//# sourceMappingURL=GroupsSection-DAnY2ngQ.js.map

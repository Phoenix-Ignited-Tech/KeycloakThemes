import{jsx as e,jsxs as I,Fragment as R}from"react/jsx-runtime";import{u as H,a as N,b5 as O,C as L,aQ as V,a_ as S,a$ as w,b0 as q,c4 as E,c5 as j,aG as G,$ as K,f as $,d as Q,bY as U,bq as W,j as x,cC as P,D as Y,P as J,F as X,Q as g,A as Z,h as T,B as ee,L as ae,aF as re,cn as te,aE as se}from"./main-hZIJIVx9.js";import{useState as m}from"react";import{D as oe}from"./SwitchControl-CuqH9Ng4.js";import{u as ne}from"./ConfirmDialog-BClP8m2C.js";import{F as ie}from"./FormAccess-DIV7UK1Y.js";import{K as le}from"./KeyValueInput-CYwzrckm.js";import{M as ce}from"./MultiLineInput-DThNyrNa.js";import{V as ue}from"./ViewHeader-DxK8RzXz.js";import{u as de}from"./useParams-tGf6FJmU.js";import"react-dom";import"./copy-icon-Cy7M-mD5.js";import"./KeySelect-BUhUx10e.js";import"./useToggle-K3Kx99tM.js";const me=({clientId:i})=>{const{adminClient:a}=H(),{t:l}=N(),{control:y}=O(),[A,v]=m(!1),[u,C]=m(),[p,h]=m("");L(()=>{const n={id:i,first:0,max:20,deep:!1,name:p};return a.clients.listAllScopes(n)},C,[p]);const b=n=>n.map(r=>e(G,{value:r,children:r.name},r.id));return u?e(S,{label:l("authorizationScopes"),labelIcon:e(w,{helpText:l("clientScopesHelp"),fieldLabelId:"scopes"}),fieldId:"scopes",children:e(q,{name:"scopes",defaultValue:[],control:y,render:({field:n})=>e(E,{toggleId:"scopes",variant:j.typeaheadMulti,chipGroupProps:{numChips:3,expandedText:l("hide"),collapsedText:l("showRemaining")},onToggle:r=>v(r),isOpen:A,selections:n.value.map(r=>r.name),onFilter:r=>(h(r),b(u)),onSelect:r=>{const t=typeof r=="string"?r:r.name,s=n.value.find(c=>c.name===t)?n.value.filter(c=>c.name!==t):[...n.value,r];n.onChange(s)},onClear:()=>{h(""),n.onChange([])},typeAheadAriaLabel:l("authorizationScopes"),children:b(u)})})}):e(V,{})};function Re(){const{adminClient:i}=H(),{t:a}=N(),[l,y]=m(),[A,v]=m(),[u,C]=m(),{addAlert:p,addError:h}=K(),b=$({mode:"onChange"}),{setValue:n,handleSubmit:r}=b,{id:t,resourceId:s,realm:c}=de(),D=Q(),_=(o={})=>{se(o,n)},{hasAccess:k}=U(),F=!k("manage-authorization");L(()=>Promise.all([i.clients.findOne({id:t}),s?i.clients.getResource({id:t,resourceId:s}):Promise.resolve(void 0),s?i.clients.listPermissionsByResource({id:t,resourceId:s}):Promise.resolve(void 0)]),([o,d,f])=>{if(!o)throw new Error(a("notFound"));y(o),C(f),v(d),_(d)},[]);const z=async o=>{const d=re(o);try{if(s)await i.clients.updateResource({id:t,resourceId:s},d);else{const f=await i.clients.createResource({id:t},d);v(d),D(te({realm:c,id:t,resourceId:f._id}))}p(a((s?"update":"create")+"ResourceSuccess"),x.success)}catch(f){h("resourceSaveError",f)}},[B,M]=ne({titleKey:"deleteResource",children:I(R,{children:[a("deleteResourceConfirm"),u?.length!==0&&e(W,{variant:"warning",isInline:!0,isPlain:!0,title:a("deleteResourceWarning"),className:"pf-v5-u-pt-lg",children:e("p",{className:"pf-v5-u-pt-xs",children:u?.map(o=>e("strong",{className:"pf-v5-u-pr-md",children:o.name},o.id))})})]}),continueButtonLabel:"confirm",onConfirm:async()=>{try{await i.clients.delResource({id:t,resourceId:s}),p(a("resourceDeletedSuccess"),x.success),D(P({realm:c,clientId:t,tab:"resources"}))}catch(o){h("resourceDeletedError",o)}}});return l?I(R,{children:[e(M,{}),e(ue,{titleKey:s?A?.name:"createResource",dropdownItems:s?[e(Y,{"data-testid":"delete-resource",isDisabled:F,onClick:()=>B(),children:a("delete")},"delete")]:void 0}),e(J,{variant:"light",children:e(X,{...b,children:I(ie,{isHorizontal:!0,role:"manage-authorization",className:"keycloak__resource-details__form",onSubmit:r(z),children:[e(g,{name:s?"owner.name":"",label:a("owner"),labelIcon:a("ownerHelp"),defaultValue:l.clientId,readOnly:!0}),e(g,{name:"name",label:a("name"),labelIcon:a("resourceNameHelp"),rules:{required:a("required")}}),e(g,{name:"displayName",label:a("displayName"),labelIcon:a("displayNameHelp"),rules:{required:a("required")}}),e(g,{name:"type",label:a("type"),labelIcon:a("resourceDetailsTypeHelp")}),e(S,{label:a("uris"),fieldId:"uris",labelIcon:e(w,{helpText:a("urisHelp"),fieldLabelId:"uris"}),children:e(ce,{name:"uris",type:"url","aria-label":a("uris"),addButtonLabel:"addUri"})}),e(me,{clientId:t}),e(g,{name:"icon_uri",label:a("iconUri"),labelIcon:a("iconUriHelp"),type:"url"}),e(oe,{name:"ownerManagedAccess",label:a("ownerManagedAccess"),labelIcon:a("ownerManagedAccessHelp")}),e(S,{hasNoPaddingTop:!0,label:a("resourceAttribute"),labelIcon:e(w,{helpText:a("resourceAttributeHelp"),fieldLabelId:"resourceAttribute"}),fieldId:"resourceAttribute",children:e(le,{name:"attributes",isDisabled:F})}),e(Z,{children:I("div",{className:"pf-v5-u-mt-md",children:[e(T,{variant:ee.primary,type:"submit","data-testid":"save",children:a("save")}),e(T,{variant:"link","data-testid":"cancel",component:o=>e(ae,{...o,to:P({realm:c,clientId:t,tab:"resources"})}),children:a("cancel")})]})})]})})})]}):e(V,{})}export{Re as default};
//# sourceMappingURL=ResourceDetails-SAH5VSy9.js.map

import{jsx as e,jsxs as v,Fragment as U}from"react/jsx-runtime";import{u as M,c as Q,d as ge,a as D,$ as z,aZ as ee,b5 as _,B,eC as he,b0 as ie,D as q,d1 as pe,C as j,aQ as be,a_ as ye,a$ as ve,aH as fe,aB as re,d2 as Ce,d3 as ke,b2 as Ie,b3 as Pe,d4 as Oe,h as w,d5 as Se,aI as Me,bc as De,aG as te,f as X,aE as Le,M as oe,q as se,X as Y,F as Z,r as le,W as we,bC as ae,aF as ze,e as Te,P as E,s as W,eD as Ae,aY as de,aP as K,aR as Ee,Q as H,aA as Fe,aC as xe,L as Ve,cy as Re,A as Ue,db as Ke,cR as Be}from"./main-hZIJIVx9.js";import{F as Ne}from"./FormAccess-DIV7UK1Y.js";import{A as Ge}from"./AttributeForm-BLb7UvaY.js";import{R as He,u as qe}from"./RoutableTabs-B1siEmtL.js";import{u as ce}from"./useParams-tGf6FJmU.js";import{V as We}from"./ViewHeader-DxK8RzXz.js";import{u as $}from"./ConfirmDialog-BClP8m2C.js";import{useState as I,useRef as $e,useCallback as Qe,useEffect as _e}from"react";import{M as je}from"./ManageOrderDialog-Dl6-UDyO.js";import{u as F}from"./useToggle-K3Kx99tM.js";import{D as ne}from"./SwitchControl-CuqH9Ng4.js";import{s as Xe}from"./sortBy-Dp9zHTFo.js";import{M as Ye}from"./MembersModal-DbSHFuMg.js";import{O as Ze,c as Je}from"./OrganizationForm-kMbAvGGg.js";import{a as V,b as R}from"./Tabs-DXjNMDMz.js";import"react-dom";import"./copy-icon-Cy7M-mD5.js";import"./KeyValueInput-CYwzrckm.js";import"./KeySelect-BUhUx10e.js";import"./PageHandler-B0KkvOoM.js";import"./DynamicComponents-v6e2RtHb.js";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./CodeEditor-BZUGCa3z.js";import"./GroupPickerDialog-CppD_q_3.js";import"./DataListItemRow-B1CYYhSa.js";import"./MultiLineInput-DThNyrNa.js";import"./AddRoleMappingModal-C4wZesy5.js";import"./translationFormatter-QNso5xUZ.js";import"./useLocaleSort-Cjd-LyWL.js";import"./filter-icon-B5V3NoWK.js";import"./PageList-DUHf6xan.js";import"./Droppable-CwICnup7.js";const et=({save:t})=>{const{adminClient:a}=M(),{realm:l}=Q(),h=ge(),{t:i}=D(),{addAlert:n,addError:d}=z(),m=ee({name:"id"}),o=ee({name:"name"}),{setValue:b}=_(),[f,g]=$({titleKey:"disableConfirmOrganizationTitle",messageKey:"disableConfirmOrganization",continueButtonLabel:"disable",onConfirm:()=>{b("enabled",!1),t()}}),[y,r]=$({titleKey:"organizationDelete",messageKey:"organizationDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:B.danger,onConfirm:async()=>{try{await a.organizations.delById({id:m}),n(i("organizationDeletedSuccess")),h(he({realm:l}))}catch(s){d("organizationDeleteError",s)}}});return e(ie,{name:"enabled",render:({field:{value:s,onChange:C}})=>v(U,{children:[e(r,{}),e(g,{}),e(We,{titleKey:o||"",divider:!1,dropdownItems:[e(q,{"data-testid":"delete-client",onClick:y,children:i("delete")},"delete")],isEnabled:s,onToggle:P=>{P?(C(P),t()):f()}})]})})},tt=({name:t,label:a,helpText:l,defaultValue:h,isRequired:i,variant:n="typeahead",isDisabled:d})=>{const{adminClient:m}=M(),{t:o}=D(),{control:b,getValues:f,formState:{errors:g}}=_(),y=f(t),[r,s,C]=F(),[P,O]=I(""),p=$e(),[c,N]=I([]),[x,J]=I(""),me=Qe(pe(J,1e3),[]);j(async()=>{const u={max:20,realmOnly:!0};return x&&(u.search=x),await m.identityProviders.find(u)},N,[x]);const ue=u=>{const L=u.map(k=>e(te,{value:k,selected:y?.includes(k.alias),children:k.alias},k.alias));return L.length===0?e(te,{value:"",children:o("noResultsFound")}):L};return c?v(ye,{label:o(a),isRequired:i,labelIcon:l?e(ve,{helpText:l,fieldLabelId:a}):void 0,fieldId:t,children:[e(ie,{name:t,defaultValue:h,control:b,rules:{validate:u=>i&&u.filter(L=>L!==void 0).length===0?o("required"):void 0},render:({field:u})=>e(fe,{id:t,onOpenChange:s,toggle:L=>e(re,{"data-testid":t,ref:L,variant:"typeahead",onClick:s,isExpanded:r,isFullWidth:!0,isDisabled:d,status:g[t]?"danger":void 0,children:v(Ce,{isPlain:!0,children:[e(ke,{value:P||u.value,onClick:s,onChange:(k,A)=>{C(!0),O(A),me(A)},autoComplete:"off",innerRef:p,placeholderText:o("selectAUser"),...u.value&&{"aria-activedescendant":u.value},role:"combobox",isExpanded:r,"aria-controls":"select-create-typeahead-listbox",children:n==="typeaheadMulti"&&Array.isArray(u.value)&&e(Ie,{"aria-label":"Current selections",children:u.value.map((k,A)=>e(Pe,{onClick:S=>{S.stopPropagation(),u.onChange(u.value.filter(T=>T!==k))},children:k},A))})}),e(Oe,{children:!!x&&e(w,{variant:"plain",onClick:()=>{O(""),J(""),u.onChange([]),p?.current?.focus()},"aria-label":o("clear"),children:e(Se,{"aria-hidden":!0})})})]})}),isOpen:r,selected:u.value,onSelect:(L,k)=>{const S=k.alias;if(n!=="typeaheadMulti"){const T=u.value.includes(S);T?u.onChange([]):u.onChange([S]),O(T?"":S||""),C(!1)}else{const T=u.value.find(G=>G===S)?u.value.filter(G=>G!==S):[...u.value,S];u.onChange(T)}},"aria-label":o(t),children:e(Me,{children:ue(c)})})}),g[t]&&e(De,{message:o("required")})]}):e(be,{})},at=({orgId:t,identityProvider:a,onClose:l})=>{const{adminClient:h}=M(),{t:i}=D(),{addAlert:n,addError:d}=z(),m=X({mode:"onChange"}),{handleSubmit:o,formState:b,setValue:f}=m,{getValues:g}=_();_e(()=>Le({...a,alias:[a?.alias],hideOnLogin:a?.hideOnLogin},f),[]);const y=async r=>{try{const s=await h.identityProviders.findOne({alias:r.alias[0]});if(!s)throw new Error(i("notFound"));const{config:C}=ze(r);s.config={...s.config,...C},s.hideOnLogin=r.hideOnLogin,await h.identityProviders.update({alias:r.alias[0]},s),a||await h.organizations.linkIdp({orgId:t,alias:r.alias[0]}),n(i(a?"linkUpdatedSuccessful":"linkSuccessful")),l()}catch(s){d(a?"linkUpdatedError":"linkError",s)}};return e(oe,{variant:se.small,title:i("linkIdentityProvider"),isOpen:!0,onClose:l,actions:[e(Y,{formState:b,"data-testid":"confirm",form:"form",allowInvalid:!0,allowNonDirty:!0,children:i("save")},"confirm"),e(w,{id:"modal-cancel","data-testid":"cancel",variant:B.link,onClick:l,children:i("cancel")},"cancel")],children:e(Z,{...m,children:v(le,{id:"form",onSubmit:o(y),children:[e(tt,{name:"alias",label:i("identityProvider"),defaultValue:[],isRequired:!0,isDisabled:!!a}),e(we,{name:ae("config.kc.org.domain"),label:i("domain"),controller:{defaultValue:""},options:[{key:"",value:i("none")},...g("domains").map(r=>({key:r,value:r}))],menuAppendTo:"parent"}),e(ne,{name:"hideOnLogin",label:i("hideOnLoginPage"),labelIcon:i("hideOnLoginPageHelp"),defaultValue:!0}),e(ne,{name:ae("config.kc.org.broker.redirect.mode.email-matches"),label:i("redirectWhenEmailMatches"),labelIcon:i("redirectWhenEmailMatchesHelp"),stringify:!0})]})})})},nt=({row:t,refresh:a})=>{const{adminClient:l}=M(),{addAlert:h,addError:i}=z(),{t:n}=D(),d=async m=>{try{await l.identityProviders.update({alias:t.alias},{...t,hideOnLogin:m}),h(n("linkUpdatedSuccessful")),a()}catch(o){i("linkUpdatedError",o)}};return e(Ee,{label:n("on"),labelOff:n("off"),isChecked:t.hideOnLogin,onChange:(m,o)=>d(o)})},it=()=>{const{adminClient:t}=M(),{t:a}=D(),{id:l}=Te(),{addAlert:h,addError:i}=z(),[n,d]=I(0),m=()=>d(n+1),[o,b]=I(!1),[f,g]=I(!1),[y,r]=I(),[s,C]=F();j(async()=>t.identityProviders.find({max:1}),c=>{g(c.length===1)},[]);const P=async()=>{const c=await t.organizations.listIdentityProviders({orgId:l});return Xe(c,"alias")},[O,p]=$({titleKey:"identityProviderUnlink",messageKey:"identityProviderUnlinkConfirm",continueButtonLabel:"unLinkIdentityProvider",continueButtonVariant:B.danger,onConfirm:async()=>{try{await t.organizations.unLinkIdp({orgId:l,alias:y.alias}),r(void 0),h(a("unLinkSuccessful")),m()}catch(c){i("unLinkError",c)}}});return v(U,{children:[o&&e(je,{orgId:l,onClose:()=>{b(!1),m()}}),v(E,{variant:"light",children:[e(p,{}),s&&e(at,{orgId:l,identityProvider:y,onClose:()=>{C(),m()}}),f?e(de,{loader:P,ariaLabelKey:"identityProviders",searchPlaceholderKey:"searchProvider",toolbarItem:v(U,{children:[e(K,{children:e(w,{onClick:()=>{r(void 0),C()},children:a("linkIdentityProvider")})}),e(K,{children:e(w,{"data-testid":"manageDisplayOrder",variant:"link",onClick:()=>b(!0),children:a("manageDisplayOrder")})})]}),actions:[{title:a("edit"),onRowClick:c=>{r(c),C()}},{title:a("unLinkIdentityProvider"),onRowClick:c=>{r(c),O()}}],columns:[{name:"alias"},{name:"config['kc.org.domain']",displayKey:"domain"},{name:"providerId",displayKey:"providerDetails"},{name:"hideOnLogin",displayKey:"hideOnLoginPage",cellRenderer:c=>e(nt,{row:c,refresh:m})}],emptyState:e(W,{message:a("emptyIdentityProviderLink"),instructions:a("emptyIdentityProviderLinkInstructions"),primaryActionText:a("linkIdentityProvider"),onPrimaryAction:C})},n):e(W,{icon:Ae,message:a("noIdentityProvider"),instructions:a("noIdentityProviderInstructions")})]})]})},rt=({orgId:t,onClose:a})=>{const{adminClient:l}=M(),{addAlert:h,addError:i}=z(),{t:n}=D(),d=X(),{handleSubmit:m,formState:o}=d,b=async f=>{try{const g=new FormData;for(const y in f)g.append(y,f[y]);await l.organizations.invite({orgId:t},g),h(n("inviteSent")),a()}catch(g){i("inviteSentError",g)}};return e(oe,{variant:se.small,title:n("inviteMember"),isOpen:!0,onClose:a,actions:[e(Y,{formState:o,"data-testid":"save",form:"form",allowInvalid:!0,allowNonDirty:!0,children:n("send")},"confirm"),e(w,{id:"modal-cancel","data-testid":"cancel",variant:B.link,onClick:a,children:n("cancel")},"cancel")],children:e(Z,{...d,children:v(le,{id:"form",onSubmit:m(b),children:[e(H,{name:"email",label:n("email"),rules:{required:n("required")},autoFocus:!0}),e(H,{name:"firstName",label:n("firstName")}),e(H,{name:"lastName",label:n("lastName")})]})})})},ot=t=>{const{realm:a}=Q();return e(Ve,{to:Re({realm:a,id:t.id,tab:"settings"}),children:t.username})},st=()=>{const{t}=D(),{adminClient:a}=M(),{id:l}=ce(),{addAlert:h,addError:i}=z(),[n,d]=I(0),m=()=>d(n+1),[o,b]=F(),[f,g]=F(),[y,r]=F(),[s,C]=I([]),P=(p,c,N)=>a.organizations.listMembers({orgId:l,first:p,max:c,search:N}),O=async p=>{try{await Promise.all(p.map(c=>a.organizations.delMember({orgId:l,userId:c.id}))),h(t("organizationUsersLeft",{count:p.length}))}catch(c){i("organizationUsersLeftError",c)}m()};return v(E,{variant:"light",children:[f&&e(Ye,{membersQuery:()=>a.organizations.listMembers({orgId:l}),onAdd:async p=>{try{await Promise.all(p.map(c=>a.organizations.addMember({orgId:l,userId:c.id}))),h(t("organizationUsersAdded",{count:p.length}))}catch(c){i("organizationUsersAddedError",c)}},onClose:()=>{g(),m()}}),y&&e(rt,{orgId:l,onClose:r}),e(de,{loader:P,isPaginated:!0,ariaLabelKey:"membersList",searchPlaceholderKey:"searchMember",onSelect:p=>C([...p]),canSelectAll:!0,toolbarItem:v(U,{children:[e(K,{children:e(Fe,{onOpenChange:b,toggle:p=>e(re,{ref:p,onClick:b,isExpanded:o,variant:"primary",children:t("addMember")}),isOpen:o,children:v(xe,{children:[e(q,{onClick:()=>{g(),b()},children:t("addRealmUser")}),e(q,{onClick:()=>{r(),b()},children:t("inviteMember")})]})})}),e(K,{children:e(w,{variant:"plain",isDisabled:s.length===0,onClick:()=>O(s),children:t("removeMember")})})]}),actions:[{title:t("remove"),onRowClick:async p=>{await O([p])}}],columns:[{name:"username",cellRenderer:ot},{name:"email"},{name:"firstName"},{name:"lastName"}],emptyState:e(W,{message:t("emptyMembers"),instructions:t("emptyMembersInstructions"),secondaryActions:[{text:t("addRealmUser"),onClick:g},{text:t("inviteMember"),onClick:r}]})},n)]})};function Gt(){const{adminClient:t}=M(),{addAlert:a,addError:l}=z(),{realm:h}=Q(),{id:i}=ce(),{t:n}=D(),d=X(),m=async r=>{try{const s=Je(r);await t.organizations.updateById({id:i},s),a(n("organizationSaveSuccess"))}catch(s){l("organizationSaveError",s)}};j(()=>t.organizations.findOne({id:i}),r=>{if(!r)throw new Error(n("notFound"));d.reset({...r,domains:r.domains?.map(s=>s.name),attributes:Be(r.attributes)})},[i]);const o=r=>qe(Ke({realm:h,id:i,tab:r})),b=o("settings"),f=o("attributes"),g=o("members"),y=o("identityProviders");return e(E,{variant:"light",className:"pf-v5-u-p-0",children:v(Z,{...d,children:[e(et,{save:()=>m(d.getValues())}),v(He,{"data-testid":"organization-tabs","aria-label":n("organization"),isBox:!0,mountOnEnter:!0,children:[e(V,{id:"settings","data-testid":"settingsTab",title:e(R,{children:n("settings")}),...b,children:e(E,{children:v(Ne,{role:"anyone",onSubmit:d.handleSubmit(m),isHorizontal:!0,children:[e(Ze,{readOnly:!0}),v(Ue,{children:[e(Y,{formState:d.formState,"data-testid":"save",children:n("save")}),e(w,{onClick:()=>d.reset(),"data-testid":"reset",variant:"link",children:n("reset")})]})]})})}),e(V,{id:"attributes","data-testid":"attributeTab",title:e(R,{children:n("attributes")}),...f,children:e(E,{variant:"light",children:e(Ge,{form:d,save:m,reset:()=>d.reset({...d.getValues()}),name:"attributes"})})}),e(V,{id:"members","data-testid":"membersTab",title:e(R,{children:n("members")}),...g,children:e(st,{})}),e(V,{id:"identityProviders","data-testid":"identityProvidersTab",title:e(R,{children:n("identityProviders")}),...y,children:e(it,{})})]})]})})}export{Gt as default};
//# sourceMappingURL=DetailOrganization-COD8IXLN.js.map

import{jsxs as m,Fragment as S,jsx as r}from"react/jsx-runtime";import{a as F,Q as O,W as B,a_ as E,a$ as j,b0 as k,c4 as K,c5 as L,aG as U,u as $,f as q,$ as H,d as N,c as G,B as Q,j as P,dI as I,C as W,aQ as z,P as R,D as _,F as J,A as X,h as T,L as Y,aF as Z,dK as ee,aE as re}from"./main-hZIJIVx9.js";import{useState as C}from"react";import{u as ae}from"./ConfirmDialog-BClP8m2C.js";import{D as te}from"./DynamicComponents-v6e2RtHb.js";import{F as ie}from"./FormAccess-DIV7UK1Y.js";import{V as se}from"./ViewHeader-DxK8RzXz.js";import{u as oe,m as pe}from"./useLocaleSort-Cjd-LyWL.js";import{u as ne}from"./useParams-tGf6FJmU.js";import"react-dom";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./CodeEditor-BZUGCa3z.js";import"./copy-icon-Cy7M-mD5.js";import"./GroupPickerDialog-CppD_q_3.js";import"./DataListItemRow-B1CYYhSa.js";import"./KeySelect-BUhUx10e.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-DThNyrNa.js";import"./AddRoleMappingModal-C4wZesy5.js";import"./translationFormatter-QNso5xUZ.js";import"./filter-icon-B5V3NoWK.js";const de=({mapperTypes:p,mapperType:a,form:d,id:f,updateMapperType:u})=>{const{t:s}=F(),{control:M}=d,[g,l]=C(!1),t=["inherit","import","legacy","force"];return m(S,{children:[r(O,{name:"name",label:s("name"),labelIcon:s("addIdpMapperNameHelp"),readOnly:!!f,rules:{required:s("required")}}),r(B,{name:"config.syncMode",label:s("syncModeOverride"),labelIcon:s("syncModeOverrideHelp"),options:t.map(i=>({key:i.toUpperCase(),value:s(`syncModes.${i}`)})),controller:{defaultValue:t[0].toUpperCase()}}),r(E,{label:s("mapperType"),labelIcon:r(j,{helpText:a.helpText,fieldLabelId:"mapperType"}),fieldId:"identityProviderMapper",children:r(k,{name:"identityProviderMapper",defaultValue:p[0].id,control:M,render:({field:i})=>r(K,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!f,onToggle:()=>l(!g),onSelect:e=>{const y=e;u(y),i.onChange(y.id),l(!1)},selections:a.name,variant:L.single,"aria-label":s("mapperType"),isOpen:g,children:p.map(e=>r(U,{selected:e===i.value,"datatest-id":e.id,value:e,children:e.name},e.name))})})})]})};function xe(){const{adminClient:p}=$(),{t:a}=F(),d=q({shouldUnregister:!0}),{handleSubmit:f}=d,{addAlert:u,addError:s}=H(),M=N(),g=oe(),{realm:l}=G(),{id:t,providerId:i,alias:e}=ne(),[y,V]=C(),[v,h]=C(),A=async o=>{const b=Z(o),c={...b,config:{...b.config},identityProviderAlias:e};if(t)try{await p.identityProviders.updateMapper({id:t,alias:e},{...c,id:t}),u(a("mapperSaveSuccess"),P.success)}catch(n){s("mapperSaveError",n)}else try{const n=await p.identityProviders.createMapper({identityProviderMapper:c,alias:e});u(a("mapperCreateSuccess"),P.success),M(ee({realm:l,alias:e,providerId:i,id:n.id}))}catch(n){s("mapperCreateError",n)}},[D,w]=ae({titleKey:"deleteProviderMapper",messageKey:a("deleteMapperConfirm",{mapper:v?.name}),continueButtonLabel:"delete",continueButtonVariant:Q.danger,onConfirm:async()=>{try{await p.identityProviders.delMapper({alias:e,id:t}),u(a("deleteMapperSuccess"),P.success),M(I({providerId:i,alias:e,tab:"mappers",realm:l}))}catch(o){s("deleteErrorIdentityProvider",o)}}});W(()=>Promise.all([t?p.identityProviders.findOneMapper({alias:e,id:t}):null,p.identityProviders.findMapperTypes({alias:e})]),([o,b])=>{const c=g(Object.values(b),pe("name"));o?(h(c.find(({id:n})=>n===o.identityProviderMapper)),x(o)):h(c[0]),V(c)},[t]);const x=o=>{re(o,d.setValue)};return!y||!v?r(z,{}):m(R,{variant:"light",children:[r(w,{}),r(se,{className:"kc-add-mapper-title",titleKey:t?a("editIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}):a("addIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}),dropdownItems:t?[r(_,{onClick:D,children:a("delete")},"delete")]:void 0,divider:!0}),m(ie,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:f(A),className:"pf-v5-u-mt-lg",children:[m(J,{...d,children:[t&&r(O,{name:"id",label:a("id"),readOnly:!0,rules:{required:a("required")}}),v.properties&&m(S,{children:[r(de,{form:d,id:t,mapperTypes:y,updateMapperType:h,mapperType:v}),r(te,{properties:v.properties})]})]}),m(X,{children:[r(T,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:a("save")}),r(T,{"data-testid":"new-mapper-cancel-button",variant:"link",component:o=>r(Y,{...o,to:I({realm:l,providerId:i,alias:e,tab:"mappers"})}),children:a("cancel")})]})]})]})}export{xe as default};
//# sourceMappingURL=AddMapper-Bnghad5z.js.map

import{jsx as e,jsxs as b,Fragment as R}from"react/jsx-runtime";import{n as qe,u as T,a as I,f as D,$ as N,c as E,M as X,h as P,B as F,r as oe,F as M,W as B,j as k,d as Ue,q as se,k as Se,C as re,A as K,aE as ce,aF as de,aQ as ue,aR as te,aS as z,aT as Te,aU as Ee,aV as _e,aW as Re,p as Be,aX as ke,aL as ae,aM as Ke,aY as Fe,P as q,Q as Y,aZ as je,a_ as L,a$ as $,b0 as ne,R as pe,b1 as he,b2 as ze,b3 as Ge,b4 as Ne,b5 as We,b6 as Ye,b7 as be,b8 as Qe,b9 as ye,ba as Xe,bb as Ze,bc as Je,b as Oe,aN as et,aO as tt,aP as xe,bd as at,be as nt,bf as it,bg as lt,bh as ot,bi as st,bj as rt,bk as ct,aH as dt,aB as ut,aI as mt,aG as pt,bl as ht,bm as bt,i as fe,L as De,bn as yt,s as ft,o as gt}from"./main-hZIJIVx9.js";import{useEffect as j,useState as _,useMemo as Me}from"react";import{u as At}from"./ConfirmDialog-BClP8m2C.js";import{R as wt,u as vt}from"./RoutableTabs-B1siEmtL.js";import{V as Pt}from"./ViewHeader-DxK8RzXz.js";import{u as Ve,m as Ct}from"./useLocaleSort-Cjd-LyWL.js";import{u as ie}from"./useToggle-K3Kx99tM.js";import{N as It}from"./NameDescription-DqpkGRwU.js";import{D as St}from"./DraggableTable-B9pZ_MGg.js";import{D as Tt}from"./DynamicComponents-v6e2RtHb.js";import{T as Et}from"./trash-icon-B7fZiFY1.js";import{f as _t}from"./AddRoleMappingModal-C4wZesy5.js";import{F as Z}from"./FormAccess-DIV7UK1Y.js";import{T as He}from"./TimeSelectorControl-BgeQYM1k.js";import{M as ge}from"./MultiLineInput-DThNyrNa.js";import{Q as Rt}from"./question-circle-icon-8FzzEl3Z.js";import{T as kt,a as O,b as x}from"./Tabs-DXjNMDMz.js";import{T as Ft}from"./Trans-CPgnEO0T.js";import{s as Nt}from"./sortBy-Dp9zHTFo.js";const Ot={name:"CogIcon",height:512,width:512,svgPath:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z",yOffset:0,xOffset:0},xt=qe(Ot),Dt=({flowAlias:n,onClose:a})=>{const{adminClient:l}=T(),{t}=I(),i=D(),{addAlert:s,addError:c}=N(),{realm:d,realmRepresentation:m,refresh:g}=E(),h=async({bindingType:A})=>{try{await l.realms.update({realm:d},{...m,[A]:n}),g(),s(t("updateFlowSuccess"),k.success)}catch(u){c("updateFlowError",u)}a(!0)},f=Array.from(Q.keys());return e(X,{title:t("bindFlow"),variant:"small",onClose:()=>a(),actions:[e(P,{"data-testid":"save",type:"submit",form:"bind-form",children:t("save")},"confirm"),e(P,{"data-testid":"cancel",variant:F.link,onClick:()=>a(),children:t("cancel")},"cancel")],isOpen:!0,children:e(oe,{id:"bind-form",isHorizontal:!0,onSubmit:i.handleSubmit(h),children:e(M,{...i,children:e(B,{id:"chooseBindingType",name:"bindingType",label:t("chooseBindingType"),options:f.filter(A=>A!=="dockerAuthenticationFlow").map(A=>({key:A,value:t(`flow.${Q.get(A)}`)})),controller:{defaultValue:f[0]},menuAppendTo:"parent","aria-label":t("chooseBindingType")})})})})},Mt=({name:n,description:a,toggleDialog:l,onComplete:t})=>{const{adminClient:i}=T(),{t:s}=I(),c=D({mode:"onChange"}),{setValue:d,getValues:m,handleSubmit:g}=c,{addAlert:h,addError:f}=N(),A=Ue(),{realm:u}=E();j(()=>{d("alias",s("copyOf",{name:n})),d("description",a)},[n,a]);const y=async()=>{const v=m();try{await i.authenticationManagement.copyFlow({flow:n,newName:v.alias});const o=(await i.authenticationManagement.getFlows()).find(w=>w.alias===v.alias);v.description!==a&&(o.description=v.description,await i.authenticationManagement.updateFlow({flowId:o.id},o)),h(s("copyFlowSuccess"),k.success),A(Se({realm:u,id:o.id,usedBy:"notInUse",builtIn:o.builtIn?"builtIn":void 0}))}catch(o){f("copyFlowError",o)}t()};return e(X,{title:s("duplicateFlow"),onClose:l,variant:se.small,actions:[e(P,{"data-testid":"confirm",type:"submit",form:"duplicate-flow-form",children:s("duplicate")},"confirm"),e(P,{"data-testid":"cancel",variant:F.link,onClick:l,children:s("cancel")},"cancel")],isOpen:!0,children:e(M,{...c,children:e(oe,{id:"duplicate-flow-form",onSubmit:g(y),isHorizontal:!0,children:e(It,{})})})})},Vt=({requiredAction:n,onClose:a})=>{const{adminClient:l}=T(),{t}=I(),{addAlert:i,addError:s}=N(),[c,d]=_(),m=D(),{setValue:g,handleSubmit:h}=m,f=u=>{ce(u||{},g)};re(async()=>{const u=await l.authenticationManagement.getRequiredActionConfigDescription({alias:n.alias}),y=await l.authenticationManagement.getRequiredActionConfig({alias:n.alias});return u.properties=[...u.properties],{configDescription:u,config:y}},({configDescription:u,config:y})=>{d(u),f(y)},[]);const A=async u=>{const y=de(u);try{await l.authenticationManagement.updateRequiredActionConfig({alias:n.alias},y),f(y),i(t("configSaveSuccess"),k.success),a()}catch(v){s("configSaveError",v)}};return e(X,{variant:se.small,isOpen:!0,title:t("requiredActionConfig",{name:n.name}),onClose:a,children:b(oe,{id:"required-action-config-form",onSubmit:h(A),children:[e(M,{...m,children:e(Tt,{stringify:!0,properties:c?.properties||[]})}),b(K,{children:[e(P,{"data-testid":"save",variant:"primary",type:"submit",children:t("save")}),e(P,{"data-testid":"cancel",variant:F.link,onClick:a,children:t("cancel")}),b(P,{className:"pf-v5-u-ml-3xl","data-testid":"clear",variant:F.link,onClick:async()=>{await l.authenticationManagement.removeRequiredActionConfig({alias:n.alias}),m.reset({}),a()},children:[t("clear")," ",e(Et,{})]})]})]})})},Ht=()=>{const{adminClient:n}=T(),{t:a}=I(),{addAlert:l,addError:t}=N(),[i,s]=_(),[c,d]=_(),[m,g]=_(0),h=()=>g(m+1),{realm:f}=E(),A=async()=>await(await Te(`${_e(n.baseUrl)}admin/realms/${f}/ui-ext/authentication-management/required-actions`,{method:"GET",headers:Ee(await n.getAccessToken())})).json();re(async()=>{const[o,w]=await Promise.all([A(),n.authenticationManagement.getUnregisteredRequiredActions()]);return[...o.map(r=>({name:r.name,enabled:r.enabled,defaultAction:r.defaultAction,data:r})),...w.map(r=>({name:r.name,enabled:!1,defaultAction:!1,data:r}))]},o=>s(o),[m]);const u=o=>!("alias"in o),y=async(o,w)=>{try{w in o?(o[w]=!o[w],delete o.configurable,await n.authenticationManagement.updateRequiredAction({alias:o.alias},o)):u(o)&&await n.authenticationManagement.registerRequiredAction({name:o.name,providerId:o.providerId}),h(),l(a("updatedRequiredActionSuccess"),k.success)}catch(r){t("updatedRequiredActionError",r)}},v=async(o,w)=>{try{const r=o.alias;for(let p=0;p<Math.abs(w);p++)w>0?await n.authenticationManagement.lowerRequiredActionPriority({alias:r}):await n.authenticationManagement.raiseRequiredActionPriority({alias:r});h(),l(a("updatedRequiredActionSuccess"),k.success)}catch(r){t("updatedRequiredActionError",r)}};return i?b(R,{children:[c&&e(Vt,{requiredAction:c,onClose:()=>d(void 0)}),e(St,{keyField:"name",onDragFinish:async(o,w)=>{const r=i.map(C=>C.name),p=w.indexOf(o),S=r.indexOf(o),V=i[S].data;if(!V.alias)return;const J=p-S;v(V,J)},columns:[{name:"name",displayKey:"action",width:50},{name:"enabled",displayKey:"enabled",cellRenderer:o=>e(te,{id:`enable-${z(o.name)}`,label:a("on"),labelOff:a("off"),isChecked:o.enabled,onChange:()=>{y(o.data,"enabled")},"aria-label":z(o.name)}),width:20},{name:"default",displayKey:"setAsDefaultAction",thTooltipText:"authDefaultActionTooltip",cellRenderer:o=>e(te,{id:`default-${z(o.name)}`,label:a("on"),isDisabled:!o.enabled,labelOff:o.enabled?a("off"):a("disabledOff"),isChecked:o.defaultAction,onChange:()=>{y(o.data,"defaultAction")},"aria-label":z(o.name)}),width:20},{name:"config",displayKey:"configure",cellRenderer:o=>o.data.configurable?e(P,{variant:"plain","aria-label":a("settings"),onClick:()=>d(o.data),children:e(xt,{})}):void 0,width:10}],data:i})]}):e(ue,{})},Lt="_label_1u2bs_1",le={label:Lt},ee=({label:n})=>b(R,{children:[e(Be,{className:le.label})," ",n]}),$t=({id:n,isSpecificClient:a,onClose:l})=>{const{adminClient:t}=T(),{t:i}=I(),s=async(c,d,m)=>(await _t(t,{id:n,type:a?"clients":"idp",first:c||0,max:d||10,search:m})).map(h=>({name:h}));return e(X,{header:b(ke,{children:[e(ae,{component:Ke.h1,children:i("flowUsedBy")}),e(ae,{children:i("flowUsedByDescription",{value:i(a?"clients":"identiyProviders")})})]}),variant:se.medium,isOpen:!0,onClose:l,actions:[e(P,{"data-testid":"cancel",id:"modal-cancel",onClick:l,children:i("close")},"cancel")],children:e(Fe,{loader:s,isPaginated:!0,ariaLabelKey:"usedBy",searchPlaceholderKey:"search",columns:[{name:"name"}]})})},qt=({authType:{id:n,usedBy:a}})=>{const{t:l}=I(),{realmRepresentation:t}=E(),[i,s]=ie(),c=Object.entries(t).find(d=>d[1]===a?.values[0])?.[0];return b(R,{children:[i&&e($t,{id:n,onClose:s,isSpecificClient:a?.type==="SPECIFIC_CLIENTS"}),(a?.type==="SPECIFIC_PROVIDERS"||a?.type==="SPECIFIC_CLIENTS")&&(a.values.length<=8?e(Re,{"aria-label":l("usedBy"),bodyContent:b("div",{children:[l("appliedBy"+(a.type==="SPECIFIC_CLIENTS"?"Clients":"Providers"))," ",a.values.map((d,m)=>b(R,{children:[e("strong",{children:d}),m<a.values.length-1?", ":""]}))]},`usedBy-${n}-${a.values}`),children:e(P,{variant:"link",className:le.label,children:e(ee,{label:l(`used.${a.type}`)})})},n):e(P,{variant:"link",className:le.label,onClick:s,children:e(ee,{label:l(`used.${a.type}`)})})),a?.type==="DEFAULT"&&e(ee,{label:l(`flow.${Q.get(c)}`)}),!a?.type&&l("used.notInUse")]})},Ut=["poll","ping"],G=10,W=600,Ae=0,we=600,Bt=({realm:n,realmUpdated:a})=>{const{adminClient:l}=T(),{t}=I(),i=D({mode:"onChange"}),{realm:s}=E(),{addAlert:c,addError:d}=N(),m=h=>ce(h,i.setValue);j(()=>m(n),[]);const g=async h=>{try{await l.realms.update({realm:s},de(h));const f=await l.realms.findOne({realm:s});a(f),m(f),c(t("updateCibaSuccess"),k.success)}catch(f){d("updateCibaError",f)}};return e(q,{variant:"light",children:b(Z,{role:"manage-realm",isHorizontal:!0,onSubmit:i.handleSubmit(g),children:[b(M,{...i,children:[e(B,{name:"attributes.cibaBackchannelTokenDeliveryMode",label:t("cibaBackchannelTokenDeliveryMode"),labelIcon:t("cibaBackchannelTokenDeliveryModeHelp"),options:Ut.map(h=>({key:h,value:t(`cibaBackhannelTokenDeliveryModes.${h}`)})),controller:{defaultValue:""}}),e(Y,{name:"attributes.cibaExpiresIn",type:"number",min:G,max:W,label:t("cibaExpiresIn"),labelIcon:t("cibaExpiresInHelp"),rules:{min:{value:G,message:t("greaterThan",{value:G})},max:{value:W,message:t("lessThan",{value:W})},required:{value:!0,message:t("required")}}}),e(Y,{name:"attributes.cibaInterval",type:"number",min:G,max:W,label:t("cibaInterval"),labelIcon:t("cibaIntervalHelp"),rules:{min:{value:Ae,message:t("greaterThan",{value:Ae})},max:{value:we,message:t("lessThan",{value:we})},required:{value:!0,message:t("required")}}}),e(B,{name:"attributes.cibaAuthRequestedUserHint",label:t("cibaAuthRequestedUserHint"),labelIcon:t("cibaAuthRequestedUserHintHelp"),options:["login_hint","id_token_hint","login_hint_token"],controller:{defaultValue:""},isDisabled:!0})]}),b(K,{children:[e(P,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!i.formState.isValid||!i.formState.isDirty,children:t("save")}),e(P,{"data-testid":"reload",variant:F.link,onClick:()=>m({...n}),children:t("reload")})]})]})})},H=["totp","hotp"],ve=["SHA1","SHA256","SHA512"],Pe=[6,8],Kt=({realm:n,realmUpdated:a})=>{const{adminClient:l}=T(),{t}=I(),i=D({mode:"onChange",defaultValues:n}),{control:s,reset:c,handleSubmit:d,formState:{isValid:m,isDirty:g}}=i,{realm:h}=E(),{addAlert:f,addError:A}=N(),u=Ve(),y=je({name:"otpPolicyType",control:s,defaultValue:H[0]}),v=r=>c(r);j(()=>v(n),[]);const o=Me(()=>{const r=(n.otpSupportedApplications??[]).map(p=>t(`otpSupportedApplications.${p}`));return u(r,p=>p)},[n.otpSupportedApplications]);return e(q,{variant:"light",children:e(Z,{role:"manage-realm",isHorizontal:!0,onSubmit:d(async r=>{try{await l.realms.update({realm:h},r);const p=await l.realms.findOne({realm:h});a(p),v(p),f(t("updateOtpSuccess"),k.success)}catch(p){A("updateOtpError",p)}}),className:"keycloak__otp_policies_authentication__form",children:b(M,{...i,children:[e(L,{label:t("otpType"),labelIcon:e($,{helpText:t("otpTypeHelp"),fieldLabelId:"otpType"}),hasNoPaddingTop:!0,children:e(ne,{name:"otpPolicyType","data-testid":"otpPolicyType",defaultValue:H[0],control:s,render:({field:r})=>e(R,{children:H.map(p=>e(pe,{id:p,"data-testid":p,isChecked:r.value===p,name:"otpPolicyType",onChange:()=>r.onChange(p),label:t(`policyType.${p}`),className:"keycloak__otp_policies_authentication__policy-type"},p))})})}),e(B,{name:"otpPolicyAlgorithm",label:t("otpHashAlgorithm"),labelIcon:t("otpHashAlgorithmHelp"),options:ve.map(r=>({key:`Hmac${r}`,value:r})),controller:{defaultValue:`Hmac${ve[0]}`}}),e(L,{label:t("otpPolicyDigits"),labelIcon:e($,{helpText:t("otpPolicyDigitsHelp"),fieldLabelId:"otpPolicyDigits"}),hasNoPaddingTop:!0,children:e(ne,{name:"otpPolicyDigits","data-testid":"otpPolicyDigits",defaultValue:Pe[0],control:s,render:({field:r})=>e(R,{children:Pe.map(p=>e(pe,{id:`digit-${p}`,"data-testid":`digit-${p}`,isChecked:r.value===p,name:"otpPolicyDigits",onChange:()=>r.onChange(p),label:p,className:"keycloak__otp_policies_authentication__number-of-digits"},p))})})}),e(he,{name:"otpPolicyLookAheadWindow",label:t("lookAround"),labelIcon:t("lookAroundHelp"),controller:{defaultValue:1,rules:{min:0}}}),y===H[0]&&e(He,{name:"otpPolicyPeriod",label:t("otpPolicyPeriod"),labelIcon:t("otpPolicyPeriodHelp"),units:["second","minute"],controller:{defaultValue:30,rules:{min:1,max:{value:120,message:t("maxLength",{length:"2 "+t("minutes")})}}}}),y===H[1]&&e(he,{name:"otpPolicyInitialCounter",label:t("initialCounter"),labelIcon:t("initialCounterHelp"),controller:{defaultValue:30,rules:{min:1,max:120}}}),e(L,{label:t("supportedApplications"),labelIcon:e($,{helpText:t("supportedApplicationsHelp"),fieldLabelId:"supportedApplications"}),children:e("span",{"data-testid":"supportedApplications",children:e(ze,{children:o.map(r=>e(Ge,{isReadOnly:!0,children:r},r))})})}),y===H[0]&&e(Ne,{name:"otpPolicyCodeReusable",label:t("otpPolicyCodeReusable"),labelIcon:t("otpPolicyCodeReusableHelp"),labelOn:t("on"),labelOff:t("off")}),b(K,{children:[e(P,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!m||!g,children:t("save")}),e(P,{"data-testid":"reload",variant:F.link,onClick:()=>c({...n}),children:t("reload")})]})]})})})},jt=({policy:{id:n,configType:a,defaultValue:l,displayName:t},onRemove:i})=>{const{t:s}=I(),{control:c,register:d,formState:{errors:m}}=We(),g=m[n];return b(L,{label:t,fieldId:n,isRequired:!0,labelIcon:e($,{helpText:s(`passwordPoliciesHelp.${n}`),fieldLabelId:n}),children:[b(Ye,{children:[b(be,{isFilled:!0,children:[a&&a!=="int"&&e(Qe,{id:n,"data-testid":n,...d(n,{required:!0}),defaultValue:l,validated:g?ye.error:ye.default}),a==="int"&&e(ne,{name:n,defaultValue:Number.parseInt(l||"0"),control:c,render:({field:h})=>{const A=y=>h.onChange(Math.max(y,0)),u=Number(h.value);return e(Xe,{id:n,value:u,min:0,onPlus:()=>A(u+1),onMinus:()=>A(u-1),onChange:y=>{const v=Number(y.currentTarget.value);A(isNaN(v)?0:v)},className:"keycloak__policies_authentication__number-field"})}}),!a&&e(te,{id:n,label:s("on"),labelOff:s("off"),isChecked:!0,isDisabled:!0,"aria-label":t})]}),e(be,{children:e(P,{"data-testid":`remove-${n}`,variant:"link",className:"keycloak__policies_authentication__minus-icon",onClick:()=>i(n),"aria-label":s("remove"),children:e(Ze,{})})})]}),g&&e(Je,{message:s("required")})]})},Le=" and ",zt=(n,a)=>n.map(l=>`${l.id}(${a[l.id]})`).join(Le),Gt=(n,a)=>n.split(Le).map(Wt).reduce((l,{id:t,value:i})=>{const s=a.find(c=>c.id===t);return s?l.concat({...s,value:i}):l},[]);function Wt(n){const a=n.indexOf("(");if(a===-1)return{id:n.trim()};const l=n.substring(0,a).trim(),t=n.lastIndexOf(")");if(t===-1)return{id:l};const i=n.substring(a+1,t).trim();return{id:l,value:i}}const Ce=({onSelect:n,selectedPolicies:a})=>{const{t:l}=I(),{passwordPolicies:t}=Oe(),[i,s]=_(!1),c=Me(()=>t?.filter(d=>a.find(m=>m.id===d.id)===void 0),[a]);return e(dt,{onSelect:(d,m)=>{n(m),s(!1)},toggle:d=>e(ut,{ref:d,onClick:()=>s(!i),isExpanded:i,isDisabled:c?.length===0,style:{width:"300px"},"data-testid":"add-policy",children:l("addPolicy")}),isOpen:i,children:e(mt,{children:c?.map(d=>e(pt,{value:d,children:d.displayName},d.id))})})},Yt=({realm:n,realmUpdated:a})=>{const{adminClient:l}=T(),{t}=I(),{passwordPolicies:i}=Oe(),{addAlert:s,addError:c}=N(),{realm:d}=E(),[m,g]=_([]),h=r=>{g([...m,r]),u(r.id,r.defaultValue,{shouldDirty:!0})},f=D({defaultValues:{}}),{handleSubmit:A,setValue:u,reset:y,formState:{isDirty:v}}=f,o=r=>{y();const p=Gt(r.passwordPolicy||"",i);p.forEach(S=>{u(S.id,S.value)}),g(p)};j(()=>o(n),[]);const w=async r=>{const p={...n,passwordPolicy:zt(m,r)};try{await l.realms.update({realm:d},p),a(p),o(p),s(t("updatePasswordPolicySuccess"),k.success)}catch(S){c("updatePasswordPolicyError",S)}};return b(q,{variant:"light",className:"pf-v5-u-p-0",children:[(m.length!==0||n.passwordPolicy)&&b(R,{children:[e(et,{children:e(tt,{children:e(xe,{children:e(Ce,{onSelect:h,selectedPolicies:m})})})}),e(at,{}),e(q,{variant:"light",children:e(M,{...f,children:b(Z,{className:"keycloak__policies_authentication__form",role:"manage-realm",isHorizontal:!0,onSubmit:A(w),children:[m.map((r,p)=>e(jt,{policy:r,onRemove:S=>{g(m.filter(V=>V.id!==S)),u(r.id,"",{shouldDirty:!0})}},`${r.id}-${p}`)),b(K,{children:[e(P,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!v,children:t("save")}),e(P,{"data-testid":"reload",variant:F.link,onClick:()=>o(n),children:t("reload")})]})]})})})]}),!m.length&&!n.passwordPolicy&&b(nt,{"data-testid":"empty-state",variant:"lg",children:[e(it,{titleText:e(R,{children:t("noPasswordPolicies")}),icon:e(lt,{icon:ot}),headingLevel:"h1"}),e(st,{children:t("noPasswordPoliciesInstructions")}),e(rt,{children:e(ct,{children:e(Ce,{onSelect:h,selectedPolicies:[]})})})]})]})},Qt=["ES256","ES384","ES512","RS256","RS384","RS512","Ed25519","RS1"],Xt=["not specified","none","indirect","direct"],Zt=["not specified","platform","cross-platform"],Jt=["not specified","Yes","No"],ea=["not specified","required","preferred","discouraged"],U=({name:n,label:a,options:l,labelPrefix:t,isMultiSelect:i=!1})=>{const{t:s}=I();return e(B,{name:n,label:s(a),variant:i?"typeaheadMulti":"single",controller:{defaultValue:l[0]},options:l.map(c=>({key:c,value:t?s(`${t}.${c}`):c}))})},Ie=({realm:n,realmUpdated:a,isPasswordLess:l=!1})=>{const{adminClient:t}=T(),{t:i}=I(),{addAlert:s,addError:c}=N(),{realm:d}=E(),{enabled:m}=ht(),g=D({mode:"onChange"}),{setValue:h,handleSubmit:f,formState:{isDirty:A}}=g,u=l?"webAuthnPolicyPasswordless":"webAuthnPolicy",y=o=>ce(o,h);j(()=>y(n),[]);const v=async o=>{const w=de(o);try{await t.realms.update({realm:d},w),a(w),y(w),s(i("webAuthnUpdateSuccess"),k.success)}catch(r){c("webAuthnUpdateError",r)}};return b(q,{variant:"light",children:[m&&e(Re,{bodyContent:i(`${u}FormHelp`),children:e(ke,{className:"keycloak__section_intro__help",children:b(ae,{children:[e(Rt,{})," ",i("webauthnIntro")]})})}),b(Z,{role:"manage-realm",isHorizontal:!0,onSubmit:f(v),className:"keycloak__webauthn_policies_authentication__form",children:[b(M,{...g,children:[e(Y,{name:`${u}RpEntityName`,label:i("webAuthnPolicyRpEntityName"),labelIcon:i("webAuthnPolicyRpEntityNameHelp"),rules:{required:{value:!0,message:i("required")}}}),e(U,{name:`${u}SignatureAlgorithms`,label:"webAuthnPolicySignatureAlgorithms",options:Qt,isMultiSelect:!0}),e(Y,{name:`${u}RpId`,label:i("webAuthnPolicyRpId"),labelIcon:i("webAuthnPolicyRpIdHelp")}),e(U,{name:`${u}AttestationConveyancePreference`,label:"webAuthnPolicyAttestationConveyancePreference",options:Xt,labelPrefix:"attestationPreference"}),e(U,{name:`${u}AuthenticatorAttachment`,label:"webAuthnPolicyAuthenticatorAttachment",options:Zt,labelPrefix:"authenticatorAttachment"}),e(U,{name:`${u}RequireResidentKey`,label:"webAuthnPolicyRequireResidentKey",options:Jt,labelPrefix:"residentKey"}),e(U,{name:`${u}UserVerificationRequirement`,label:"webAuthnPolicyUserVerificationRequirement",options:ea,labelPrefix:"userVerify"}),e(He,{name:`${u}CreateTimeout`,label:i("webAuthnPolicyCreateTimeout"),labelIcon:i("otpPolicyPeriodHelp"),units:["second","minute","hour"],controller:{defaultValue:0,rules:{min:0,max:{value:31536,message:i("webAuthnPolicyCreateTimeoutHint")}}}}),e(Ne,{name:`${u}AvoidSameAuthenticatorRegister`,label:i("webAuthnPolicyAvoidSameAuthenticatorRegister"),labelIcon:i("webAuthnPolicyAvoidSameAuthenticatorRegisterHelp"),labelOn:i("on"),labelOff:i("off")}),e(L,{label:i("webAuthnPolicyAcceptableAaguids"),fieldId:"webAuthnPolicyAcceptableAaguids",labelIcon:e($,{helpText:i("webAuthnPolicyAcceptableAaguidsHelp"),fieldLabelId:"webAuthnPolicyAcceptableAaguids"}),children:e(ge,{name:`${u}AcceptableAaguids`,"aria-label":i("webAuthnPolicyAcceptableAaguids"),addButtonLabel:"addAaguids"})}),e(L,{label:i("webAuthnPolicyExtraOrigins"),fieldId:"webAuthnPolicyExtraOrigins",labelIcon:e($,{helpText:i("webAuthnPolicyExtraOriginsHelp"),fieldLabelId:"webAuthnPolicyExtraOrigins"}),children:e(ge,{name:`${u}ExtraOrigins`,"aria-label":i("webAuthnPolicyExtraOrigins"),addButtonLabel:"addOrigins"})})]}),b(K,{children:[e(P,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!A,children:i("save")}),e(P,{"data-testid":"reload",variant:F.link,onClick:()=>y(n),children:i("reload")})]})]})]})},ta=()=>{const{adminClient:n}=T(),{t:a}=I(),[l,t]=_(1),{realm:i}=E(),[s,c]=_();return re(async()=>{const d=await n.realms.findOne({realm:i});if(!d)throw new Error(a("notFound"));return d},d=>{c(d)},[]),s?b(kt,{activeKey:l,onSelect:(d,m)=>t(m),mountOnEnter:!0,unmountOnExit:!0,children:[e(O,{id:"passwordPolicy",eventKey:1,title:e(x,{children:a("passwordPolicy")}),children:e(Yt,{realm:s,realmUpdated:c})}),e(O,{id:"otpPolicy",eventKey:2,title:e(x,{children:a("otpPolicy")}),children:e(Kt,{realm:s,realmUpdated:c})}),e(O,{id:"webauthnPolicy",eventKey:3,title:e(x,{children:a("webauthnPolicy")}),children:e(Ie,{realm:s,realmUpdated:c})}),e(O,{id:"webauthnPasswordlessPolicy",eventKey:4,title:e(x,{children:a("webauthnPasswordlessPolicy")}),children:e(Ie,{realm:s,realmUpdated:c,isPasswordLess:!0})}),e(O,{"data-testid":"tab-ciba-policy",eventKey:5,title:e(x,{children:a("cibaPolicy")}),children:e(Bt,{realm:s,realmUpdated:c})})]}):e(ue,{})},Q=new Map([["browserFlow","browser"],["registrationFlow","registration"],["directGrantFlow","direct grant"],["resetCredentialsFlow","reset credentials"],["clientAuthenticationFlow","clients"],["dockerAuthenticationFlow","docker auth"],["firstBrokerLoginFlow","firstBrokerLogin"]]),aa=({id:n,alias:a,usedBy:l,builtIn:t})=>{const{t:i}=I(),{realm:s}=E();return b(R,{children:[e(De,{to:Se({realm:s,id:n,usedBy:l?.type||"notInUse",builtIn:t?"builtIn":void 0}),children:a},`link-${n}`)," ",t&&e(gt,{children:i("buildIn")},`label-${n}`)]})};function na(){const{adminClient:n}=T(),{t:a}=I(),{realm:l,realmRepresentation:t}=E(),[i,s]=_(0),c=()=>s(i+1),{addAlert:d,addError:m}=N(),g=Ve(),[h,f]=_(),[A,u]=ie(),[y,v]=ie(),o=async()=>{const me=await(await Te(`${_e(n.baseUrl)}admin/realms/${l}/ui-ext/authentication-management/flows`,{method:"GET",headers:Ee(await n.getAccessToken())})).json();return me?Nt(g(me,Ct("alias")),$e=>$e.usedBy?.type):[]},w=C=>vt(fe({realm:l,tab:C})),r=w("flows"),p=w("required-actions"),S=w("policies"),[V,J]=At({titleKey:"deleteConfirmFlow",children:b(Ft,{i18nKey:"deleteConfirmFlowMessage",children:[" ",e("strong",{children:{flow:h?h.alias:""}}),"."]}),continueButtonLabel:"delete",continueButtonVariant:F.danger,onConfirm:async()=>{try{await n.authenticationManagement.deleteFlow({flowId:h.id}),c(),d(a("deleteFlowSuccess"),k.success)}catch(C){m("deleteFlowError",C)}}});return t?b(R,{children:[e(J,{}),A&&e(Mt,{name:h?h.alias:"",description:h?.description,toggleDialog:u,onComplete:()=>{c(),u()}}),y&&e(Dt,{onClose:()=>{v(),c()},flowAlias:h?.alias}),e(Pt,{titleKey:"titleAuthentication",subKey:"authenticationExplain",helpUrl:bt.authenticationUrl,divider:!1}),e(q,{variant:"light",className:"pf-v5-u-p-0",children:b(wt,{isBox:!0,defaultLocation:fe({realm:l,tab:"flows"}),children:[e(O,{"data-testid":"flows",title:e(x,{children:a("flows")}),...r,children:e(Fe,{loader:o,ariaLabelKey:"titleAuthentication",searchPlaceholderKey:"searchForFlow",toolbarItem:e(xe,{children:e(P,{component:C=>e(De,{...C,to:yt({realm:l})}),children:a("createFlow")})}),actionResolver:({data:C})=>[{title:a("duplicate"),onClick:()=>{u(),f(C)}},...C.usedBy?.type!=="DEFAULT"?[{title:a("bindFlow"),onClick:()=>{v(),f(C)}}]:[],...!C.builtIn&&!C.usedBy?[{title:a("delete"),onClick:()=>{f(C),V()}}]:[]],columns:[{name:"alias",displayKey:"flowName",cellRenderer:C=>e(aa,{...C})},{name:"usedBy",displayKey:"usedBy",cellRenderer:C=>e(qt,{authType:C})},{name:"description",displayKey:"description"}],emptyState:e(ft,{message:a("emptyEvents"),instructions:a("emptyEventsInstructions")})},i)}),e(O,{"data-testid":"requiredActions",title:e(x,{children:a("requiredActions")}),...p,children:e(Ht,{})}),e(O,{"data-testid":"policies",title:e(x,{children:a("policies")}),...S,children:e(ta,{})})]})})]}):e(ue,{})}const Ia=Object.freeze(Object.defineProperty({__proto__:null,REALM_FLOWS:Q,default:na},Symbol.toStringTag,{value:"Module"}));export{Ia as A,Dt as B,xt as C,Mt as D};
//# sourceMappingURL=AuthenticationSection-CVtthFN0.js.map

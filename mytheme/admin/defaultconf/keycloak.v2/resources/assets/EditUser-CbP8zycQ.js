import{jsx as e,jsxs as b,Fragment as H}from"react/jsx-runtime";import{ei as it,el as bt,fq as yt,fr as Qe,fs as Ct,dq as wt,dn as vt,dp as Je,ds as It,ed as kt,dL as Pt,ft as Tt,fu as Dt,fv as At,fw as Lt,fx as St,fy as Rt,u as $,a as M,M as He,q as Re,h as E,aY as he,cm as xt,eB as Ut,e as Et,$ as X,c as be,C as Ae,B as se,eE as Ot,L as ot,db as Bt,aP as Xe,aA as dt,aB as lt,aC as ct,D as fe,s as xe,b5 as Mt,P as me,dy as ze,j as _,bv as Te,bu as K,b2 as Nt,b3 as Ft,b_ as Ge,dc as Kt,b$ as je,c0 as ce,c1 as q,c2 as Ve,c3 as O,bt as zt,f as ye,r as Ue,a_ as Le,b8 as mt,f2 as Gt,d5 as jt,aZ as Vt,F as Ee,fz as qt,cq as Ye,bc as Ze,aQ as ut,bd as Ht,a$ as _t,bX as et,cF as Ke,bl as $t,bY as _e,cT as Wt,aW as Qt,dA as Jt,Q as tt,b as Xt,cu as rt,aX as ke,aL as Pe,cM as Yt,o as qe,dI as Zt,d as er,bA as tr,bB as rr,eu as ar,az as nr,cx as sr,cy as ir,fm as or,fn as at}from"./main-hZIJIVx9.js";import{useState as I,useMemo as pt,useRef as dr,Fragment as lr}from"react";import{u as ne,C as gt}from"./ConfirmDialog-BClP8m2C.js";import{R as cr,u as mr}from"./RoutableTabs-B1siEmtL.js";import{V as ur}from"./ViewHeader-DxK8RzXz.js";import{U as pr}from"./UserProfileContext-CdN6lacy.js";import{u as $e}from"./useParams-tGf6FJmU.js";import{u as Se}from"./useToggle-K3Kx99tM.js";import{A as gr}from"./AttributeForm-BLb7UvaY.js";import{a as De,R as hr,F as fr,U as br,t as yr,f as Cr}from"./UserForm-Cy_IbmvP.js";import{U as wr}from"./userProfileMetadata-CFgHgJ2w.js";import{u as ht}from"./useFormatDate-wmPxp-7e.js";import{s as ft}from"./sortBy-Dp9zHTFo.js";import{C as vr,S as Ir,i as kr}from"./SessionsTable-Bpik6NQE.js";import{u as Pr}from"./useLocaleSort-Cjd-LyWL.js";import{P as Tr}from"./pencil-alt-icon-DlDullb7.js";import{T as Dr}from"./TimeSelectorControl-BgeQYM1k.js";import{D as Ar}from"./SwitchControl-CuqH9Ng4.js";import{G as Lr,a as Sr}from"./GroupPickerDialog-CppD_q_3.js";import{Q as Rr}from"./question-circle-icon-8FzzEl3Z.js";import{c as ue}from"./capitalize-C7hSmiNl.js";import{R as xr}from"./AddRoleMappingModal-C4wZesy5.js";/* empty css                     */import{a as re,b as ae}from"./Tabs-DXjNMDMz.js";import"react-dom";import"./PageHandler-B0KkvOoM.js";import"./DynamicComponents-v6e2RtHb.js";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./CodeEditor-BZUGCa3z.js";import"./copy-icon-Cy7M-mD5.js";import"./KeySelect-BUhUx10e.js";import"./MultiLineInput-DThNyrNa.js";import"./PageList-DUHf6xan.js";import"./FormAccess-DIV7UK1Y.js";import"./KeyValueInput-CYwzrckm.js";import"./ListItem-BJr2pMeN.js";import"./TimeSelector-BQoPDF1p.js";import"./DataListItemRow-B1CYYhSa.js";import"./_baseSlice-F8doVSIJ.js";import"./translationFormatter-QNso5xUZ.js";import"./filter-icon-B5V3NoWK.js";var Ur=Math.min;function Er(t,r,n){for(var s=Ct,u=t[0].length,o=t.length,d=o,g=Array(o),l=1/0,c=[];d--;){var m=t[d];d&&r&&(m=it(m,bt(r))),l=Ur(m.length,l),g[d]=r||u>=120&&m.length>=120?new yt(d&&m):void 0}m=t[0];var i=-1,p=g[0];e:for(;++i<u&&c.length<l;){var f=m[i],T=r?r(f):f;if(f=f!==0?f:0,!(p?Qe(p,T):s(c,T))){for(d=o;--d;){var w=g[d];if(!(w?Qe(w,T):s(t[d],T)))continue e}p&&p.push(T),c.push(f)}}return c}function Or(t){return wt(t)?t:[]}var Br=vt(function(t){var r=Je(t),n=it(t,Or);return r===Je(n)?r=void 0:n.pop(),n.length&&n[0]===t[0]?Er(n,It(r)):[]}),Mr="[object Map]",Nr="[object Set]",Fr=Object.prototype,Kr=Fr.hasOwnProperty;function nt(t){if(t==null)return!0;if(kt(t)&&(Pt(t)||typeof t=="string"||typeof t.splice=="function"||Tt(t)||Dt(t)||At(t)))return!t.length;var r=Lt(t);if(r==Mr||r==Nr)return!t.size;if(St(t))return!Rt(t).length;for(var n in t)if(Kr.call(t,n))return!1;return!0}const zr=({isJoin:t=!0,existingOrgs:r,onAdd:n,onClose:s})=>{const{adminClient:u}=$(),{t:o}=M(),[d,g]=I([]),l=async(c,m,i)=>{const p={first:c,search:i,max:m+r.length},f=await u.organizations.find(p);return Ut(f,r,"id")};return e(He,{variant:Re.small,title:o(t?"joinOrganization":"sendInvitation"),isOpen:!0,onClose:s,actions:[e(E,{"data-testid":"join",variant:"primary",onClick:async()=>{await n(d),s()},children:o(t?"join":"send")},"confirm"),e(E,{"data-testid":"cancel",variant:"link",onClick:s,children:o("cancel")},"cancel")],children:e(he,{loader:l,isPaginated:!0,ariaLabelKey:"organizationsList",searchPlaceholderKey:"searchOrganization",canSelectAll:!0,onSelect:c=>g([...c]),columns:[{name:"name",displayKey:"organizationName"},{name:"description",cellRenderer:c=>e(xt,{wrapModifier:"truncate",children:c.description})}]})})},Gr=()=>{const{adminClient:t}=$(),{t:r}=M(),{id:n}=Et(),{addAlert:s,addError:u}=X(),{realm:o}=be(),[d,g]=I(0),l=()=>g(d+1),[c,m,i]=Se(),[p,f]=I(!0),[T,w]=I(!1),[k,B]=I([]),[z,G]=I([]);Ae(()=>t.organizations.memberOrganizations({userId:n}),B,[d]);const[W,N]=ne({titleKey:"removeConfirmOrganizationTitle",messageKey:r("organizationRemoveConfirm",{count:z.length}),continueButtonLabel:"remove",continueButtonVariant:se.danger,onConfirm:async()=>{try{await Promise.all(z.map(L=>t.organizations.delMember({orgId:L.id,userId:n}))),s(r("organizationRemovedSuccess")),G([]),l()}catch(L){u("organizationRemoveError",L)}}});return b(H,{children:[T&&e(zr,{isJoin:p,existingOrgs:k,onClose:()=>w(!1),onAdd:async L=>{try{await Promise.all(L.map(S=>{const R=new FormData;return R.append("id",n),p?t.organizations.addMember({orgId:S.id,userId:n}):t.organizations.inviteExistingUser({orgId:S.id},R)})),s(r(p?"userAddedOrganization":"userInvitedOrganization",{count:L.length})),l()}catch(S){u(p?"userAddedOrganizationError":"userInvitedError",S)}}}),e(N,{}),e(Ot,{link:({organization:L,children:S})=>e(ot,{to:Bt({realm:o,id:L.id,tab:"settings"}),children:S},L.id),loader:k,onSelect:L=>G(L),deleteLabel:"remove",onDelete:L=>{G([L]),W()},toolbarItem:b(H,{children:[e(Xe,{children:e(dt,{onOpenChange:i,toggle:L=>e(lt,{ref:L,id:"toggle-id",onClick:m,variant:"primary",children:r("joinOrganization")}),isOpen:c,children:b(ct,{children:[e(fe,{onClick:()=>{f(!0),w(!0)},children:r("joinOrganization")},"join"),e(fe,{onClick:()=>{f(!1),w(!0)},children:r("sendInvite")},"invite")]})})}),e(Xe,{children:e(E,{"data-testid":"removeOrganization",variant:"secondary",isDisabled:z.length===0,onClick:()=>W(),children:r("remove")})})]}),children:e(xe,{message:r("emptyUserOrganizations"),instructions:r("emptyUserOrganizationsInstructions"),secondaryActions:[{text:r("joinOrganization"),onClick:()=>{f(!0),w(!0)}},{text:r("sendInvitation"),onClick:()=>{f(!1),w(!0)}}]})})]})},jr=({user:t,save:r,upConfig:n})=>{const s=Mt();return e(me,{variant:ze.light,children:e(gr,{form:s,save:r,fineGrainedAccess:t.access?.manage,reset:()=>s.reset({...s.getValues(),attributes:De(t).attributes}),name:"unmanagedAttributes",isDisabled:wr.AdminView==n?.unmanagedAttributePolicy})})},Vr=()=>{const{adminClient:t}=$(),[r,n]=I(),{t:s}=M(),{addAlert:u,addError:o}=X(),d=ht(),[g,l]=I(0),{id:c}=$e(),m=k=>ft(k,B=>B.clientId?.toUpperCase()),i=()=>l(new Date().getTime()),p=async()=>{const k=await t.users.listConsents({id:c});return m(k)},f=({grantedClientScopes:k})=>e(Nt,{className:"kc-consents-chip-group",children:k.map(B=>e(Ft,{isReadOnly:!0,className:"kc-consents-chip",children:B},B))}),[T,w]=ne({titleKey:"revokeClientScopesTitle",messageKey:s("revokeClientScopes",{clientId:r?.clientId}),continueButtonLabel:"revoke",continueButtonVariant:se.danger,onConfirm:async()=>{try{await t.users.revokeConsent({id:c,clientId:r.clientId}),i(),u(s("deleteGrantsSuccess"),_.success)}catch(k){o("deleteGrantsError",k)}}});return b(H,{children:[e(w,{}),e(he,{loader:p,ariaLabelKey:"roleList",searchPlaceholderKey:" ",columns:[{name:"clientId",displayKey:"Client",cellFormatters:[Te()],transforms:[K(20)]},{name:"grantedClientScopes",displayKey:"grantedClientScopes",cellRenderer:f,transforms:[K(30)]},{name:"createdDate",displayKey:"created",transforms:[K(20)],cellRenderer:({createdDate:k})=>k?d(new Date(k)):"—"},{name:"lastUpdatedDate",displayKey:"lastUpdated",transforms:[K(10)],cellRenderer:({lastUpdatedDate:k})=>k?d(new Date(k)):"—"}],actions:[{title:s("revoke"),onRowClick:k=>{n(k),T()}}],emptyState:e(xe,{hasIcon:!0,icon:vr,message:s("noConsents"),instructions:s("noConsentsText")})},g)]})},qr=({credentialData:t,onClose:r})=>{const{t:n}=M();return e(He,{variant:Re.medium,title:n("passwordDataTitle"),"data-testid":"passwordDataDialog",isOpen:!0,onClose:r,children:b(Ge,{"aria-label":n("passwordDataTitle"),"data-testid":"password-data-dialog",variant:Kt.compact,children:[e(je,{children:b(ce,{children:[e(q,{children:n("showPasswordDataName")}),e(q,{children:n("showPasswordDataValue")})]})}),e(Ve,{children:t.map((s,u)=>b(ce,{children:[e(O,{children:s[0]}),e(O,{children:s[1]})]},u))})]})})},Hr=({credential:t,resetPassword:r,toggleDelete:n,children:s})=>{const u=ht(),{t:o}=M(),[d,g]=Se(),[l,c]=Se(),m=Pr(),i=pt(()=>{if(!t.credentialData)return[];const p=JSON.parse(t.credentialData);return m(Object.entries(p),([f])=>f).map(([f,T])=>typeof T=="string"?[f,T]:[f,JSON.stringify(T)])},[t.credentialData]);return b(H,{children:[d&&Object.keys(t).length!==0&&e(qr,{credentialData:i,onClose:()=>{g()}}),e(O,{children:s}),e(O,{children:u(new Date(t.createdDate))}),e(O,{children:e(E,{className:"kc-showData-btn",variant:"link","data-testid":"showDataBtn",onClick:g,children:o("showDataBtn")})}),t.type==="password"?e(O,{isActionCell:!0,children:e(E,{variant:"secondary","data-testid":"resetPasswordBtn",onClick:r,children:o("resetPasswordBtn")})}):e(O,{}),e(O,{isActionCell:!0,children:e(dt,{popperProps:{position:"right"},onOpenChange:c,toggle:p=>e(lt,{ref:p,isExpanded:l,onClick:c,variant:"plain","aria-label":"Kebab toggle",children:e(zt,{})}),isOpen:l,children:e(ct,{children:e(fe,{"data-testid":"deleteDropdownItem",component:"button",onClick:()=>{n(),c()},children:o("deleteBtn")},t.id)})})})]})},_r=({userId:t,credential:r,isEditable:n,toggle:s})=>{const{adminClient:u}=$(),{t:o}=M(),{register:d,handleSubmit:g}=ye(),{addAlert:l,addError:c}=X();return e(Ue,{isHorizontal:!0,className:"kc-form-userLabel",onSubmit:g(async i=>{try{await u.users.updateCredentialLabel({id:t,credentialId:r.id},i.userLabel||""),l(o("updateCredentialUserLabelSuccess"),_.success),s()}catch(p){c("updateCredentialUserLabelError",p)}}),children:e(Le,{fieldId:"kc-userLabel",className:"kc-userLabel-row",children:e("div",{className:"kc-form-group-userLabel",children:n?b(H,{children:[e(mt,{"data-testid":"userLabelFld",defaultValue:r.userLabel,className:"kc-userLabel","aria-label":o("userLabel"),...d("userLabel")}),b("div",{className:"kc-userLabel-actionBtns",children:[e(E,{"data-testid":"editUserLabelAcceptBtn",variant:"link",className:"kc-editUserLabelAcceptBtn","aria-label":o("acceptBtn"),type:"submit",icon:e(Gt,{})}),e(E,{"data-testid":"editUserLabelCancelBtn",variant:"link",className:"kc-editUserLabel-cancelBtn","aria-label":o("cancelBtn"),onClick:s,icon:e(jt,{})})]})]}):b(H,{children:[r.userLabel,e(E,{"aria-label":o("editUserLabel"),variant:"link",className:"kc-editUserLabel-btn",onClick:s,"data-testid":"editUserLabelBtn",icon:e(Tr,{})})]})})})})},$r=()=>{const{t}=M();return e(Dr,{name:"lifespan",label:t("lifespan"),labelIcon:t("lifespanHelp"),units:["minute","hour","day"],menuAppendTo:"parent",controller:{}})},Wr=({userId:t,onClose:r})=>{const{adminClient:n}=$(),{realmRepresentation:s}=be(),{t:u}=M(),o=ye({defaultValues:{actions:[],lifespan:s?.actionTokenGeneratedByAdminLifespan}}),{handleSubmit:d,control:g}=o,l=Vt({control:g,name:"actions"}),c=!nt(l),{addAlert:m,addError:i}=X(),p=async({actions:f,lifespan:T})=>{if(!nt(f))try{await n.users.executeActionsEmail({id:t,actions:f,lifespan:T}),m(u("credentialResetEmailSuccess"),_.success),r()}catch(w){i("credentialResetEmailError",w)}};return e(gt,{variant:Re.medium,titleKey:"credentialReset",open:!0,onCancel:r,toggleDialog:r,continueButtonLabel:"credentialResetConfirm",onConfirm:()=>{d(p)()},confirmButtonDisabled:!c,children:e(Ue,{id:"userCredentialsReset-form",isHorizontal:!0,"data-testid":"credential-reset-modal",children:b(Ee,{...o,children:[e(hr,{name:"actions",label:"resetAction",help:"resetActions"}),e($r,{})]})})})},Qr={password:"",passwordConfirmation:"",temporaryPassword:!0},Jr=({user:t,isResetPassword:r,onAddRequiredActions:n,refresh:s,onClose:u})=>{const{adminClient:o}=$(),{t:d}=M(),g=ye({defaultValues:Qr,mode:"onChange"}),{register:l,formState:{isValid:c,errors:m},watch:i,handleSubmit:p,clearErrors:f,setError:T}=g,[w,k]=Se(!0),B=i("password",""),z=i("passwordConfirmation",""),{addAlert:G,addError:W}=X(),[N,L]=ne({titleKey:r?"resetPasswordConfirm":"setPasswordConfirm",messageKey:r?d("resetPasswordConfirmText",{username:t.username}):d("setPasswordConfirmText",{username:t.username}),continueButtonLabel:r?"resetPassword":"savePassword",continueButtonVariant:se.danger,onConfirm:()=>p(S)()}),S=async({password:h,temporaryPassword:U})=>{try{await o.users.resetPassword({id:t.id,credential:{temporary:U,type:"password",value:h}}),U&&n?.([qt.UPDATE_PASSWORD]);const y=(await o.users.getCredentials({id:t.id})).find(P=>P.type==="password");y&&await o.users.updateCredentialLabel({id:t.id,credentialId:y.id},d("defaultPasswordLabel")),G(d(r?"resetCredentialsSuccess":"savePasswordSuccess"),_.success),s()}catch(V){W(r?"resetPasswordError":"savePasswordError",V)}u()},{onChange:R,...j}=l("password",{required:!0});return b(H,{children:[e(L,{}),e(gt,{titleKey:r?d("resetPasswordFor",{username:t.username}):d("setPasswordFor",{username:t.username}),open:w,onCancel:u,toggleDialog:k,onConfirm:N,confirmButtonDisabled:!c,continueButtonLabel:"save",children:b(Ue,{id:"userCredentials-form",isHorizontal:!0,className:"keycloak__user-credentials__reset-form",children:[b(Le,{name:"password",label:d("password"),fieldId:"password",isRequired:!0,children:[e(Ye,{"data-testid":"passwordField",id:"password",onChange:h=>{R(h),z!==h.currentTarget.value?T("passwordConfirmation",{message:d("confirmPasswordDoesNotMatch").toString()}):f("passwordConfirmation")},...j}),m.password&&e(Ze,{message:d("required")})]}),b(Le,{name:"passwordConfirmation",label:d(r?"resetPasswordConfirmation":"passwordConfirmation"),fieldId:"passwordConfirmation",isRequired:!0,children:[e(Ye,{"data-testid":"passwordConfirmationField",id:"passwordConfirmation",...l("passwordConfirmation",{required:!0,validate:h=>h===B||d("confirmPasswordDoesNotMatch").toString()})}),m.passwordConfirmation&&e(Ze,{message:m.passwordConfirmation.message})]}),e(Ee,{...g,children:e(Ar,{name:"temporaryPassword",label:d("temporaryPassword"),labelIcon:d("temporaryPasswordHelpText"),defaultValue:"true"})})]})})]})},st=({credential:t,userId:r,toggleDelete:n,resetPassword:s,isUserLabelEdit:u,setIsUserLabelEdit:o,refresh:d})=>e(Hr,{credential:t,toggleDelete:()=>n(t),resetPassword:s,children:e(_r,{credential:t,userId:r,isEditable:u?.status&&u.rowKey===t.id||!1,toggle:()=>{o({status:!u?.status,rowKey:t.id}),u?.status&&d()}})},t.id),Xr=({user:t,setUser:r})=>{const{adminClient:n}=$(),{t:s}=M(),{addAlert:u,addError:o}=X(),[d,g]=I(0),l=()=>g(d+1),[c,m]=I(!1),[i,p]=I(!1),[f,T]=I([]),[w,k]=I([]),[B,z]=I({}),[G,W]=I(!1),[N,L]=I(),S=dr(null),[R,j]=I({draggedItemId:"",draggingToItemIndex:-1,dragging:!1,tempItemOrder:[""]});Ae(()=>n.users.getCredentials({id:t.id}),a=>{T(a);const C=a.reduce((D,x)=>(D[x.type]=D[x.type]||[],D[x.type].push(x),D),Object.create(null)),v=Object.keys(C).map(D=>({key:D,value:C[D]}));k(v.map(D=>({...D,isExpanded:!1})))},[d]);const h=f.find(a=>a.type==="password"),U=()=>m(!c),V=()=>{p(!i)},y=()=>{W(!0),U()},[P,F]=ne({titleKey:s("deleteCredentialsConfirmTitle"),messageKey:s("deleteCredentialsConfirm"),continueButtonLabel:s("delete"),continueButtonVariant:se.danger,onConfirm:async()=>{try{await n.users.deleteCredential({id:t.id,credentialId:B.id}),u(s("deleteCredentialsSuccess"),_.success),g(a=>a+1)}catch(a){o("deleteCredentialsError",a)}}}),J=pt(()=>w.flatMap(a=>[a.value.map(({id:C})=>C).toString(),...a.isExpanded?a.value.map(C=>C.id):[]]),[w]),ie=a=>{a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",a.currentTarget.id);const C=a.currentTarget.id;a.currentTarget.classList.add(Ke.modifiers.ghostRow),a.currentTarget.setAttribute("aria-pressed","true"),j({...R,draggedItemId:C,dragging:!0})},pe=(a,C,v)=>{const D=a.indexOf(C);if(D===v)return a;const x=[...a];return x.splice(v,0,x.splice(D,1)[0]),x},oe=a=>{if(!S.current)return;const C=S.current,v=Array.from(C.children);v.every(({id:D},x)=>D===a[x])||(C.replaceChildren(),a.forEach(D=>{C.appendChild(v.find(({id:x})=>x===D))}))},Oe=()=>{S.current&&(Array.from(S.current.children).forEach(a=>{a.classList.remove(Ke.modifiers.ghostRow),a.setAttribute("aria-pressed","false")}),j({...R,draggedItemId:"",draggingToItemIndex:-1,dragging:!1}))},Be=a=>{Ce(a)||(oe(J),j({...R,draggingToItemIndex:-1}))},Ce=a=>{if(!S.current)return!1;const C=S.current.getBoundingClientRect();return a.clientX>C.x&&a.clientX<C.x+C.width&&a.clientY>C.y&&a.clientY<C.y+C.height},we=a=>{Ce(a)?Ne(R.draggedItemId,R.tempItemOrder):Oe()},le=a=>{a.preventDefault();const v=a.target.closest("tr");if(!(!v||S.current&&!S.current.contains(v)||v.id===R.draggedItemId)){const D=v.id,x=Array.from(S.current?.children||[]).findIndex(Q=>Q.id===D);if(x===R.draggingToItemIndex)return;const de=pe(J,R.draggedItemId,x);oe(de),j({...R,draggingToItemIndex:x,tempItemOrder:de})}},Me=a=>{r({...t,requiredActions:[...t.requiredActions??[],...a]})},ve=({target:a})=>{a instanceof HTMLTableRowElement&&(a.classList.remove(Ke.modifiers.ghostRow),a.setAttribute("aria-pressed","false"),j({...R,draggedItemId:"",draggingToItemIndex:-1,dragging:!1}))},Ne=async(a,C)=>{const v=J.findIndex(Q=>Q===a),D=C.findIndex(Q=>Q===a),x=D-v,de=a.split(",");try{for(const Q of de)for(let We=0;We<Math.abs(x);We++)x>0?await n.users.moveCredentialPositionDown({id:t.id,credentialId:Q,newPreviousCredentialId:J[D]}):await n.users.moveCredentialPositionUp({id:t.id,credentialId:Q});l(),u(s("updatedCredentialMoveSuccess"),_.success)}catch(Q){o("updatedCredentialMoveError",Q)}},Ie=a=>{z(a),P()},Fe=t.federationLink,[ge,A]=I([]);if(Ae(()=>n.users.getUserStorageCredentialTypes({id:t.id}),A,[]),!ge)return e(ut,{});const Y=ge.length>0,ee=w.length===0,te=!t.credentials||t.credentials.length===0,Z=ee&&te&&!Y;return b(H,{children:[c&&e(Jr,{user:t,isResetPassword:G,onAddRequiredActions:Me,refresh:l,onClose:()=>m(!1)}),i&&e(Wr,{userId:t.id,onClose:()=>p(!1)}),e(F,{}),t.email&&!Z&&e(E,{className:"kc-resetCredentialBtn-header",variant:"primary","data-testid":"credentialResetBtn",onClick:()=>p(!0),children:s("credentialResetBtn")}),f.length!==0&&h===void 0&&b(H,{children:[e(E,{className:"kc-setPasswordBtn-tbl","data-testid":"setPasswordBtn-table",variant:"primary",form:"userCredentials-form",onClick:()=>{m(!0)},children:s("setPassword")}),e(Ht,{})]}),w.length!==0&&e(me,{variant:ze.light,children:b(Ge,{variant:"compact",children:[e(je,{children:b(ce,{className:"kc-table-header",children:[e(q,{children:e(_t,{helpText:s("userCredentialsHelpText"),fieldLabelId:"userCredentialsHelpTextLabel"})}),e(q,{"aria-hidden":"true"}),e(q,{children:s("type")}),e(q,{children:s("userLabel")}),e(q,{children:s("createdAt")}),e(q,{children:s("data")}),e(q,{"aria-hidden":"true"}),e(q,{"aria-hidden":"true"})]})}),e(Ve,{ref:S,onDragOver:le,onDrop:le,onDragLeave:Be,children:w.map((a,C)=>b(lr,{children:[b(ce,{id:a.value.map(({id:v})=>v).toString(),draggable:w.length>1,onDrop:we,onDragEnd:ve,onDragStart:ie,children:[e(O,{className:w.length===1?"one-row":"",draggableRow:{id:`draggable-row-${a.value.map(({id:v})=>v)}`}}),a.value.length>1?e(O,{className:"kc-expandRow-btn",expand:{rowIndex:C,isExpanded:a.isExpanded,onToggle:(v,D)=>{const x=w.map((de,Q)=>Q===D?{...de,isExpanded:!de.isExpanded}:de);k(x)}}}):e(O,{}),e(O,{dataLabel:`columns-${a.key}`,className:"kc-notExpandableRow-credentialType","data-testid":"credentialType",children:et(a.key)}),a.value.length<=1&&a.value.map(v=>e(st,{credential:v,userId:t.id,toggleDelete:Ie,resetPassword:y,isUserLabelEdit:N,setIsUserLabelEdit:L,refresh:l},v.id))]}),a.isExpanded&&a.value.map(v=>b(ce,{id:v.id,draggable:!0,onDrop:we,onDragEnd:ve,onDragStart:ie,children:[e(O,{}),e(O,{className:"kc-draggable-dropdown-type-icon",draggableRow:{id:`draggable-row-${a.value.map(({id:D})=>D)}`}}),e(O,{dataLabel:`child-columns-${v.id}`,className:"kc-expandableRow-credentialType",children:et(v.type)}),e(st,{credential:v,userId:t.id,toggleDelete:Ie,resetPassword:y,isUserLabelEdit:N,setIsUserLabelEdit:L,refresh:l})]},v.id))]},a.key))})]})}),Fe&&Y&&e(me,{variant:ze.light,children:b(Ge,{variant:"compact",children:[e(je,{children:b(ce,{children:[e(q,{children:s("type")}),e(q,{children:s("providedBy")}),e(q,{"aria-hidden":"true"})]})}),e(Ve,{children:ge.map(a=>b(ce,{children:[e(O,{children:e("b",{children:a})}),e(O,{children:e(fr,{user:t})}),a==="password"&&e(O,{modifier:"fitContent",children:e(E,{variant:"secondary",onClick:U,children:s("setPassword")})})]},a))})]})}),Z&&e(xe,{hasIcon:!0,message:s("noCredentials"),instructions:s("noCredentialsText"),primaryActionText:s("setPassword"),onPrimaryAction:U,secondaryActions:t.email?[{text:s("credentialResetBtn"),onClick:V,type:se.link}]:void 0})]})},Yr=({user:t})=>{const{adminClient:r}=$(),{t:n}=M(),{addAlert:s,addError:u}=X(),[o,d]=I(0),g=()=>d(o+1),[l,c]=I([]),[m,i]=I(!0),[p,f]=I([]),[T,w]=I(!1),{enabled:k}=$t(),{hasAccess:B}=_e(),z=B("manage-users"),G=h=>ft(h,U=>U.path?.toUpperCase()),W=async(h,U,V)=>{const y={first:h,max:U},P=V||"";P&&(y.search=P);const F=await r.users.listGroups({...y,id:t.id});f([...F]);const J=[];return m||F.forEach(ie=>{const pe=(ie.path?.substring(1).match(/((~\/)|[^/])+/g)||[]).slice(0,-1);J.push(...pe.map(oe=>({name:oe,path:ie.path?.substring(0,ie.path.indexOf(oe)+oe.length)})))}),G(Jt([...F,...J],"path"))},N=()=>{w(!T)},[L,S]=ne({titleKey:n("leaveGroup",{count:l.length,name:l[0]?.name}),messageKey:n("leaveGroupConfirmDialog",{count:l.length,groupname:l[0]?.name,username:t.username}),continueButtonLabel:"leave",continueButtonVariant:se.danger,onConfirm:async()=>{try{await Promise.all(l.map(h=>r.users.delFromGroup({id:t.id,groupId:h.id}))),c([]),s(n("removedGroupMembership"),_.success)}catch(h){u("removedGroupMembershipError",h)}g()}}),R=h=>{c(h),L()},j=async h=>{try{await Promise.all(h.map(U=>r.users.addToGroup({id:t.id,groupId:U.id}))),s(n("addedGroupMembership"),_.success)}catch(U){u("addedGroupMembershipError",U)}g()};return b(H,{children:[e(S,{}),T&&e(Lr,{id:t.id,type:"selectMany",text:{title:n("joinGroupsFor",{username:t.username}),ok:"join"},canBrowse:z,onClose:()=>w(!1),onConfirm:async(h=[])=>{await j(h),w(!1)}}),e(he,{loader:W,className:"keycloak_user-section_groups-table",isPaginated:!0,ariaLabelKey:"roleList",searchPlaceholderKey:"searchGroup",canSelectAll:!0,onSelect:h=>c(m?h:Br(h,p,"id")),isRowDisabled:h=>!m&&p.every(U=>U.id!==h.id),toolbarItem:b(H,{children:[e(E,{className:"kc-join-group-button",onClick:N,"data-testid":"add-group-button",isDisabled:!t.access?.manageGroupMembership,children:n("joinGroup")}),e(Wt,{label:n("directMembership"),id:"kc-direct-membership-checkbox",onChange:()=>{i(!m),g()},isChecked:m,className:"direct-membership-check"},"direct-membership-check"),e(E,{onClick:()=>R(l),"data-testid":"leave-group-button",variant:"link",isDisabled:l.length===0,children:n("leave")}),k&&e(Qt,{"aria-label":"Basic popover",position:"bottom",bodyContent:e("div",{children:n("whoWillAppearPopoverTextUsers")}),children:e(E,{variant:"link",className:"kc-who-will-appear-button",icon:e(Rr,{}),children:n("whoWillAppearLinkTextUsers")},"who-will-appear-button")})]}),columns:[{name:"groupMembership",displayKey:"groupMembership",cellRenderer:h=>h.name||"-",transforms:[K(40)]},{name:"path",displayKey:"path",cellRenderer:h=>e(Sr,{group:h}),transforms:[K(45)]},{name:"",cellRenderer:h=>p.some(V=>V.id===h.id)||p.length===0||m?e(E,{"data-testid":`leave-${h.name}`,onClick:()=>R([h]),variant:"link",isDisabled:!t.access?.manageGroupMembership,children:n("leave")}):"-",transforms:[K(20)]}],emptyState:e(xe,{hasIcon:!0,message:n("noGroups"),instructions:n("noGroupsText"),primaryActionText:n("joinGroup"),onPrimaryAction:N})},o)]})},Zr=({userId:t,federatedId:r,onClose:n,onRefresh:s})=>{const{adminClient:u}=$(),{t:o}=M(),{addAlert:d,addError:g}=X(),l=ye({mode:"onChange"}),{handleSubmit:c,formState:{isValid:m}}=l,i=async p=>{try{await u.users.addToFederatedIdentity({id:t,federatedIdentityId:r,federatedIdentity:p}),d(o("idpLinkSuccess"),_.success),n(),s()}catch(f){g("couldNotLinkIdP",f)}};return e(He,{variant:Re.small,title:o("linkAccountTitle",{provider:ue(r)}),onClose:n,actions:[e(E,{"data-testid":"confirm",variant:"primary",type:"submit",form:"group-form",isDisabled:!m,children:o("link")},"confirm"),e(E,{"data-testid":"cancel",variant:se.link,onClick:n,children:o("cancel")},"cancel")],isOpen:!0,children:e(Ue,{id:"group-form",onSubmit:c(i),children:b(Ee,{...l,children:[e(Le,{label:o("identityProvider"),fieldId:"identityProvider",children:e(mt,{id:"identityProvider","data-testid":"idpNameInput",value:ue(r),readOnly:!0})}),e(tt,{name:"userId",label:o("userID"),helperText:o("userIdHelperText"),autoFocus:!0,rules:{required:o("required")}}),e(tt,{name:"userName",label:o("username"),helperText:o("usernameHelperText"),rules:{required:o("required")}})]})})})},ea=({userId:t})=>{const{adminClient:r}=$(),[n,s]=I(0),[u,o]=I(""),[d,g]=I(!1),{realm:l}=be(),{addAlert:c,addError:m}=X(),{t:i}=M(),{hasAccess:p,hasSomeAccess:f}=_e(),T=f("manage-identity-providers","view-identity-providers"),w=()=>s(new Date().getTime()),k=Xt().identityProviders,B=async()=>{const y=await r.users.listFederatedIdentities({id:t});if(T){const P=await r.identityProviders.find();for(const F of y)F.providerId=P.find(J=>J.alias===F.identityProvider)?.providerId}return y},z=async()=>r.identityProviders.find(),G=async()=>B(),W=async()=>{const y=(await B()).map(P=>P.identityProvider);return(await z())?.filter(P=>!y.includes(P.alias))},[N,L]=ne({titleKey:i("unlinkAccountTitle",{provider:ue(u)}),messageKey:i("unlinkAccountConfirm",{provider:ue(u)}),continueButtonLabel:"unlink",continueButtonVariant:se.primary,onConfirm:async()=>{try{await r.users.delFromFederatedIdentity({id:t,federatedIdentityId:u}),c(i("idpUnlinkSuccess"),_.success),w()}catch(y){m("mappingDeletedError",y)}}}),S=y=>T?e(ot,{to:Zt({realm:l,providerId:y.providerId,alias:y.identityProvider,tab:"settings"}),children:ue(y.identityProvider)}):e("span",{children:ue(y.identityProvider)}),R=y=>{const P=k?.find(F=>F.id===y.identityProvider)?.groupName;return e(qe,{color:P==="Social"?"blue":"orange",children:i(P==="Social"?"idpType.social":"idpType.custom")})},j=y=>{const P=k?.find(F=>F.id===y.providerId)?.groupName;return e(qe,{color:P==="User-defined"?"orange":"blue",children:P==="User-defined"?"Custom":P==="Social"?i("idpType.social"):P})},h=y=>p("manage-users")?e(E,{variant:"link",onClick:()=>{o(y.identityProvider),N()},children:i("unlinkAccount")}):e("span",{}),U=y=>e(E,{variant:"link",onClick:()=>{o(y.alias),g(!0)},children:i("linkAccount")}),V=()=>{const y=[{name:"identityProvider",displayKey:"name",cellRenderer:S,transforms:[K(20)]},{name:"userId",displayKey:"userID",cellFormatters:[Te()],transforms:[K(30)]},{name:"userName",displayKey:"username",cellFormatters:[Te()],transforms:[K(20)]},{name:"",cellRenderer:h,transforms:[K(20)]}];return T&&y.splice(1,0,{name:"type",displayKey:"type",cellRenderer:R,transforms:[K(10)]}),y};return b(H,{children:[d&&e(Zr,{userId:t,federatedId:u,onClose:()=>g(!1),onRefresh:w}),e(L,{}),b(me,{variant:"light",className:"pf-v5-u-p-0",children:[b(rt,{title:i("linkedIdPs"),className:"kc-linked-idps",children:[e(ke,{children:e(Pe,{className:"kc-available-idps-text",children:i("linkedIdPsText")})}),e(he,{loader:G,isPaginated:!1,ariaLabelKey:"LinkedIdPs",className:"kc-linked-IdPs-table",columns:V(),emptyState:e(ke,{className:"kc-no-providers-text",children:e(Pe,{children:i("noProvidersLinked")})})},n)]}),p("manage-users")&&T&&b(rt,{className:"kc-available-idps",title:i("availableIdPs"),children:[e(ke,{children:e(Pe,{className:"kc-available-idps-text",children:i("availableIdPsText")})}),e(he,{loader:W,isPaginated:!1,ariaLabelKey:"LinkedIdPs",className:"kc-linked-IdPs-table",columns:[{name:"alias",displayKey:"name",cellFormatters:[Te(),Yt()],transforms:[K(20)]},{name:"type",displayKey:"type",cellRenderer:j,transforms:[K(60)]},{name:"",cellRenderer:U}],emptyState:e(ke,{className:"kc-no-providers-text",children:e(Pe,{children:i("noAvailableIdentityProviders")})})},n)]})]})]})},ta=({id:t,name:r})=>{const{adminClient:n}=$(),{t:s}=M(),{addAlert:u,addError:o}=X();return e(xr,{name:r,id:t,type:"users",save:async g=>{try{const l=g.filter(c=>c.client===void 0).map(c=>c.role).flat();await n.users.addRealmRoleMappings({id:t,roles:l}),await Promise.all(g.filter(c=>c.client!==void 0).map(c=>n.users.addClientRoleMappings({id:t,clientUniqueId:c.client.id,roles:[c.role]}))),u(s("userRoleMappingUpdatedSuccess"),_.success)}catch(l){o("roleMappingUpdatedError",l)}}})},ra=()=>{const{adminClient:t}=$(),{id:r}=$e(),{realm:n}=be(),{t:s}=M();return e(me,{variant:"light",className:"pf-v5-u-p-0",children:e(Ir,{loader:()=>t.users.listSessions({id:r,realm:n}),hiddenColumns:["username","type"],emptyInstructions:s("noSessionsForUser"),logoutUser:r})})};function _a(){const{adminClient:t}=$(),{t:r}=M(),{addAlert:n,addError:s}=X(),u=er(),{hasAccess:o}=_e(),{id:d}=$e(),{realm:g,realmRepresentation:l}=be(),m=ye({mode:"onChange",resolver:async A=>({values:A,errors:{}})}),[i,p]=I(),[f,T]=I(),[w,k]=I(),[B,z]=I(),[G,W]=I(0),N=()=>W(A=>A+1),L=kr(i?.id),[S,R]=I(),[j,h]=I(!1),V=tr()(rr.Organizations)&&l?.organizationsEnabled,y=A=>ir({realm:g,id:i?.id||"",tab:A}),P=A=>mr(y(A)),F=P("settings"),J=P("attributes"),ie=P("credentials"),pe=P("role-mapping"),oe=P("groups"),Oe=P("organizations"),Be=P("consents"),Ce=P("identity-provider-links"),we=P("sessions");Ae(async()=>Promise.all([t.users.findOne({id:d,userProfileMetadata:!0}),t.attackDetection.findOne({id:d}),t.users.getUnmanagedAttributes({id:d}),t.users.getProfile({realm:g}),V?t.organizations.find({first:0,max:1}):[]]),([A,Y,ee,te,Z])=>{if(!A||!l||!Y)throw new Error(r("notFound"));const{userProfileMetadata:a,...C}=A;z(a),C.unmanagedAttributes=ee,C.attributes=Cr(C.attributes,ee),te.unmanagedAttributePolicy!==void 0&&k(!0),p(C),R(te);const v=l.bruteForceProtected,D=v&&Y.disabled;T({isBruteForceProtected:v,isLocked:D}),h(Z.length===1),m.reset(De(C))},[G]);const le=async A=>{try{await t.users.update({id:i.id},yr(A)),n(r("userSaved"),_.success),N()}catch(Y){if(or(Y)){if(w&&Array.isArray(A.unmanagedAttributes)){const ee=new Array(A.unmanagedAttributes.length);let te=!1;at(Y,(Z,a)=>{if(Z.startsWith("attributes.")){const C=Z.substring(11);A.unmanagedAttributes.forEach((v,D)=>{v.key===C&&(ee[D]=a,te=!0)})}else m.setError(Z,a)},(Z,a)=>r(Z,a)),te&&m.setError("unmanagedAttributes",ee)}else at(Y,m.setError,(ee,te)=>r(ee,te));s("userNotSaved","")}else s("userCreateError",Y)}},[Me,ve]=ne({titleKey:"disableConfirmUserTitle",messageKey:"disableConfirmUser",continueButtonLabel:"disable",onConfirm:()=>{le({...De(i),enabled:!1})}}),[Ne,Ie]=ne({titleKey:"deleteConfirm",messageKey:"deleteConfirmCurrentUser",continueButtonLabel:"delete",continueButtonVariant:se.danger,onConfirm:async()=>{try{L?await t.users.logout({id:i.id}):await t.users.del({id:i.id}),n(r("userDeletedSuccess"),_.success),u(ar({realm:g}))}catch(A){s("userDeletedError",A)}}}),[Fe,ge]=ne({titleKey:"impersonateConfirm",messageKey:"impersonateConfirmDialog",continueButtonLabel:"impersonate",onConfirm:async()=>{try{const A=await t.users.impersonation({id:i.id},{user:i.id,realm:g});A.sameRealm?window.location=A.redirect:window.open(A.redirect,"_blank")}catch(A){s("impersonateError",A)}}});return!i||!f?e(ut,{}):b(H,{children:[e(ge,{}),e(Ie,{}),e(ve,{}),e(ur,{titleKey:i.username,className:"kc-username-view-header",divider:!1,badges:L?[{text:e(nr,{content:r("transientUserTooltip"),children:e(qe,{"data-testid":"user-details-label-transient-user",icon:e(sr,{}),children:r("transientUser")})})}]:[],dropdownItems:[e(fe,{isDisabled:!i.access?.impersonate,onClick:()=>Fe(),children:r("impersonate")},"impersonate"),e(fe,{isDisabled:!i.access?.manage,onClick:()=>Ne(),children:r("delete")},"delete")],onToggle:A=>{A?le({...De(i),enabled:A}):Me()},isEnabled:i.enabled}),e(me,{variant:"light",className:"pf-v5-u-p-0",children:e(pr,{children:e(Ee,{...m,children:b(cr,{isBox:!0,mountOnEnter:!0,defaultLocation:y("settings"),children:[e(re,{"data-testid":"user-details-tab",title:e(ae,{children:r("details")}),...F,children:e(me,{variant:"light",children:e(br,{form:m,realm:l,user:i,bruteForce:f,userProfileMetadata:B,refresh:N,save:le})})}),w&&e(re,{"data-testid":"attributes",title:e(ae,{children:r("attributes")}),...J,children:e(jr,{user:i,save:le,upConfig:S})}),e(re,{"data-testid":"credentials",isHidden:!i.access?.view,title:e(ae,{children:r("credentials")}),...ie,children:e(Xr,{user:i,setUser:p})}),e(re,{"data-testid":"role-mapping-tab",isHidden:!i.access?.view,title:e(ae,{children:r("roleMapping")}),...pe,children:e(ta,{id:i.id,name:i.username})}),o("query-groups")&&e(re,{"data-testid":"user-groups-tab",title:e(ae,{children:r("groups")}),...oe,children:e(Yr,{user:i})}),V&&j&&e(re,{"data-testid":"user-organizations-tab",title:e(ae,{children:r("organizations")}),...Oe,children:e(Gr,{})}),e(re,{"data-testid":"user-consents-tab",title:e(ae,{children:r("consents")}),...Be,children:e(Vr,{})}),e(re,{"data-testid":"identity-provider-links-tab",title:e(ae,{children:r("identityProviderLinks")}),...Ce,children:e(ea,{userId:i.id})}),e(re,{"data-testid":"user-sessions-tab",title:e(ae,{children:r("sessions")}),...we,children:e(ra,{})})]})})})})]})}export{_a as default};
//# sourceMappingURL=EditUser-CbP8zycQ.js.map

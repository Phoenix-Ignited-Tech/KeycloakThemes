import{jsx as e,jsxs as R,Fragment as ue}from"react/jsx-runtime";import{u as U,d as $,c as Q,a as j,bl as pe,P as z,aY as be,aW as he,h as b,s as fe,bv as w,cM as Re,bA as ye,f as ge,$ as ve,bY as we,aZ as x,C as V,bw as O,cN as Ce,B as Te,j as D,aQ as ke,D as Ae,F as Ie,bK as W,cO as L,bB as Fe,ch as Ne,cP as De,cQ as Ee,cA as Pe,cR as Be}from"./main-hZIJIVx9.js";import{useState as C}from"react";import{u as Ke}from"./ConfirmDialog-BClP8m2C.js";import{A as Se}from"./AttributeForm-BLb7UvaY.js";import{P as Me}from"./PermissionTab-CKSyLWea.js";import{R as xe}from"./RoleForm-DxW3LOf8.js";import{A as Ve,R as Oe}from"./AddRoleMappingModal-C4wZesy5.js";import{R as We,u as Le}from"./RoutableTabs-B1siEmtL.js";import{V as Ue}from"./ViewHeader-DxK8RzXz.js";import{u as G}from"./useParams-tGf6FJmU.js";import{Q as $e}from"./question-circle-icon-8FzzEl3Z.js";import{a as h,b as f}from"./Tabs-DXjNMDMz.js";import"react-dom";import"./FormAccess-DIV7UK1Y.js";import"./copy-icon-Cy7M-mD5.js";import"./KeyValueInput-CYwzrckm.js";import"./KeySelect-BUhUx10e.js";import"./useToggle-K3Kx99tM.js";import"./useLocaleSort-Cjd-LyWL.js";import"./Trans-CPgnEO0T.js";import"./translationFormatter-QNso5xUZ.js";import"./filter-icon-B5V3NoWK.js";import"./PageHandler-B0KkvOoM.js";import"./DynamicComponents-v6e2RtHb.js";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./CodeEditor-BZUGCa3z.js";import"./GroupPickerDialog-CppD_q_3.js";import"./DataListItemRow-B1CYYhSa.js";import"./MultiLineInput-DThNyrNa.js";import"./PageList-DUHf6xan.js";const Qe=()=>{const{adminClient:n}=U(),m=$(),{realm:a}=Q(),{t:s}=j(),{id:y,clientId:T}=G(),k=async(r,l)=>{const i=await n.roles.findOneById({id:y});if(!i)throw new Error(s("notFound"));return i.clientRole?n.clients.findUsersWithRole({roleName:i.name,id:T,briefRepresentation:!0,first:r,max:l}):n.roles.findUsersWithRole({name:i.name,briefRepresentation:!0,first:r,max:l})},{enabled:g}=pe();return e(z,{"data-testid":"users-page",variant:"light",children:e(be,{isPaginated:!0,loader:k,ariaLabelKey:"roleList",searchPlaceholderKey:"","data-testid":"users-in-role-table",toolbarItem:g&&e(he,{"aria-label":"Basic popover",position:"bottom",bodyContent:R("div",{children:[s("whoWillAppearPopoverTextRoles"),e(b,{className:"kc-groups-link",variant:"link",onClick:()=>m(`/${a}/groups`),children:s("groups")}),s("or"),R(b,{className:"kc-users-link",variant:"link",onClick:()=>m(`/${a}/users`),children:[s("users"),"."]})]}),footerContent:s("whoWillAppearPopoverFooterText"),children:e(b,{variant:"link",className:"kc-who-will-appear-button",icon:e($e,{}),children:s("whoWillAppearLinkTextRoles")},"who-will-appear-button")}),emptyState:e(fe,{hasIcon:!0,message:s("noDirectUsers"),instructions:R("div",{children:[s("noUsersEmptyStateDescription"),e(b,{className:"kc-groups-link-empty-state",variant:"link",onClick:()=>m(`/${a}/groups`),children:s("groups")}),s("or"),e(b,{className:"kc-users-link-empty-state",variant:"link",onClick:()=>m(`/${a}/users`),children:s("users")}),s("noUsersEmptyStateDescriptionContinued")]})}),columns:[{name:"username",displayKey:"userName",cellFormatters:[w()]},{name:"email",displayKey:"email",cellFormatters:[w()]},{name:"lastName",displayKey:"lastName",cellFormatters:[w()]},{name:"firstName",displayKey:"firstName",cellFormatters:[Re(),w()]}]})})};function Ct(){const{adminClient:n}=U(),m=ye(),{t:a}=j(),s=ge({mode:"onChange"}),{control:y,reset:T,setValue:k}=s,g=$(),{id:r,clientId:l}=G(),{realm:i,realmRepresentation:v}=Q(),[E,Y]=C(0),[q,P]=C(),H=()=>Y(E+1),{addAlert:A,addError:I}=ve(),{hasAccess:Z}=we(),_=Z("query-clients","manage-authorization"),[J,X]=C(!1),[ee,te]=C(!1),ae=t=>{const{attributes:o,...N}=t;return{attributes:Be(o),...N}},c=x({control:y,defaultValue:void 0,name:"name"}),se=x({control:y,defaultValue:!1,name:"composite"});V(async()=>n.roles.findOneById({id:r}),t=>{if(!t)throw new Error(a("notFound"));const o=ae(t);T(o),P(o.attributes)},[E]),V(async()=>n.clients.findOne({id:l}),t=>{l&&X(t?.access?.manage)},[]);const B=async t=>{try{const{attributes:o,...N}=t,p=N;p.name=p.name?.trim(),p.attributes=Ne(o),l?await n.clients.updateRole({id:l,roleName:t.name},p):await n.roles.updateById({id:r},p),P(o),A(a("roleSaveSuccess"),D.success)}catch(o){I("roleSaveError",o)}},K=O(De.path),d=O(Ce.path),oe=()=>{if(K)return L({realm:i});if(d)return W({realm:i,clientId:d.params.clientId,tab:"roles"});throw new Error("Roles overview route could not be determined.")},F=t=>{if(K)return Ee({realm:i,id:r,tab:t});if(d)return Pe({realm:i,id:r,clientId:d.params.clientId,tab:t});throw new Error("Route could not be determined.")},u=t=>Le(F(t)),re=u("details"),ne=u("associated-roles"),ie=u("attributes"),le=u("users-in-role"),ce=u("permissions"),[me,de]=Ke({titleKey:"roleDeleteConfirm",messageKey:a("roleDeleteConfirmDialog",{selectedRoleName:c||a("createRole")}),continueButtonLabel:"delete",continueButtonVariant:Te.danger,onConfirm:async()=>{try{l?await n.clients.delRole({id:l,roleName:c}):await n.roles.delById({id:r}),A(a("roleDeletedSuccess"),D.success),g(oe())}catch(t){I("roleDeleteError",t)}}}),S=async t=>{try{await n.roles.createComposite({roleId:r,realm:v.realm},t),H(),g(F("associated-roles")),A(a("addAssociatedRolesSuccess"),D.success)}catch(o){I("addAssociatedRolesError",o)}},M=t=>v?.defaultRole&&v.defaultRole.name===t;return v?R(ue,{children:[e(de,{}),ee&&e(Ve,{id:r,type:"roles",name:c,onAssign:t=>S(t.map(o=>o.role)),onClose:()=>te(!1)}),e(Ue,{titleKey:c,badges:[{id:"composite-role-badge",text:se?a("composite"):"",readonly:!0}],actionsDropdownId:"roles-actions-dropdown",dropdownItems:[e(Ae,{component:"button",onClick:()=>{me()},children:a("deleteRole")},"delete-role")],divider:!1}),e(z,{variant:"light",className:"pf-v5-u-p-0",children:e(Ie,{...s,children:R(We,{isBox:!0,mountOnEnter:!0,defaultLocation:F("details"),children:[e(h,{title:e(f,{children:a("details")}),...re,children:e(xe,{form:s,onSubmit:B,role:d?"manage-clients":"manage-realm",cancelLink:d?W({realm:i,clientId:l,tab:"roles"}):L({realm:i}),editMode:!0})}),e(h,{"data-testid":"associatedRolesTab",title:e(f,{children:a("associatedRolesText")}),...ne,children:e(Oe,{name:c,id:r,type:"roles",isManager:!0,save:t=>S(t.map(o=>o.role))})}),!M(c)&&e(h,{"data-testid":"attributesTab",className:"kc-attributes-tab",title:e(f,{children:a("attributes")}),...ie,children:e(Se,{form:s,save:B,fineGrainedAccess:J,reset:()=>k("attributes",q,{shouldDirty:!1})})}),!M(c)&&e(h,{title:e(f,{children:a("usersInRole")}),...le,children:e(Qe,{"data-cy":"users-in-role-tab"})}),m(Fe.AdminFineGrainedAuthz)&&_&&e(h,{title:e(f,{children:a("permissions")}),...ce,children:e(Me,{id:r,type:"roles"})})]})})})]}):e(ke,{})}export{Ct as default};
//# sourceMappingURL=RealmRoleTabs-Djlp4ni6.js.map

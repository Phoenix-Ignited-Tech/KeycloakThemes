import{jsx as a,jsxs as u,Fragment as k}from"react/jsx-runtime";import{u as I,bY as U,c as se,C as V,h as S,L as ne,fi as oe,eY as le,cR as ce,ch as x,fo as de,a as M,W as ue,c5 as me,$ as pe,e1 as be,d as fe,F as he,a_ as f,b8 as R,a$ as v,fp as Ae,Q as y,eR as ye,b4 as ge,aR as ke,b0 as ve,cb as Ie,cc as j,b2 as Le,b3 as Oe,bc as we,j as T,eu as Fe}from"./main-hZIJIVx9.js";import{useState as h,useEffect as Ge}from"react";import{D as qe}from"./SwitchControl-CuqH9Ng4.js";import{F as Ce,a as xe}from"./FormAccess-DIV7UK1Y.js";import{G as Re}from"./GroupPickerDialog-CppD_q_3.js";import{u as je}from"./useFormatDate-wmPxp-7e.js";const Te=({user:r})=>{const{adminClient:n}=I(),e=U(),{realm:o}=se(),[s,l]=h();return V(()=>e.hasAccess("view-realm")?n.components.findOne({id:r.federationLink}):n.userStorageProvider.name({id:r.federationLink}),l,[]),s?e.hasAccess("view-realm")?a(S,{variant:"link",component:b=>a(ne,{...b,to:oe({id:s.id,providerId:s.providerId,realm:o})}),children:s.name}):a("span",{children:s.name}):null};function Ue(r){const n={};Object.entries(r.attributes||{}).forEach(([o,s])=>n[le(o)]=s);const e=ce(r.unmanagedAttributes);return{...r,attributes:n,unmanagedAttributes:e}}function $e(r){const n=r.username?.trim(),e=Array.isArray(r.attributes)?x(r.attributes):Object.fromEntries(Object.entries(r.attributes||{}).map(([s,l])=>[de(s),l])),o=Array.isArray(r.unmanagedAttributes)?x(r.unmanagedAttributes):r.unmanagedAttributes;for(const s in o)if(e&&Object.hasOwn(e,s))throw Error(`Attribute ${s} is a managed attribute and is already available from the user details.`);return{...r,username:n,attributes:{...o,...e},unmanagedAttributes:void 0}}function Be(r={},n={}){return Object.fromEntries(Object.entries(r).filter(([e])=>!Object.hasOwn(n,e)))}const Ve=({name:r,label:n,help:e})=>{const{adminClient:o}=I(),{t:s}=M(),[l,b]=h([]);return V(()=>o.authenticationManagement.getRequiredActions(),d=>{const m=d.filter(A=>A.enabled);b(m)},[]),a(ue,{name:r,label:s(n),labelIcon:s(e),controller:{defaultValue:[]},isScrollable:!0,maxMenuHeight:"375px",variant:me.typeaheadMulti,chipGroupProps:{numChips:3},placeholderText:s("requiredActionPlaceholder"),menuAppendTo:"parent",options:l.map(({alias:d,name:m})=>({key:d,value:m||d}))})},We=({form:r,realm:n,user:e,bruteForce:{isBruteForceProtected:o,isLocked:s}={isBruteForceProtected:!1,isLocked:!1},userProfileMetadata:l,save:b,refresh:d,onGroupsUpdate:m})=>{const{adminClient:A}=I(),{t}=M(),E=je(),{addAlert:L,addError:O}=pe(),{hasAccess:w}=U(),D=w("manage-users"),H=w("view-realm"),{whoAmI:P}=be(),N=P.getLocale(),{handleSubmit:$,setValue:F,control:B,reset:W,formState:z}=r,{errors:Q}=z,[p,G]=h([]),[q,g]=h(!1),[C,Y]=h(s),_=fe();Ge(()=>{F("requiredActions",e?.requiredActions||[])},[e,F]);const K=async()=>{try{await A.users.update({id:e.id},{enabled:!0}),L(t("unlockSuccess"),T.success),d&&d()}catch(i){O("unlockError",i)}},J=i=>{G(p.filter(c=>c.name!==i)),m?.(p)},X=async i=>{G([...p,...i]),m?.([...p,...i])},Z=async i=>{i.forEach(async re=>{try{await A.users.addToGroup({id:e.id,groupId:re.id}),L(t("addedGroupMembership"),T.success)}catch(ie){O("addedGroupMembershipError",ie)}})},ee=()=>{g(!q)},te=()=>{e?.id?W(Ue(e)):_(Fe({realm:n.realm}))},ae=()=>e?.userProfileMetadata?.attributes&&!e?.userProfileMetadata?.attributes?.map(i=>i.readOnly).reduce((i,c)=>i&&c,!0);return u(Ce,{isHorizontal:!0,onSubmit:$(b),role:"query-users",fineGrainedAccess:e?.access?.manage,className:"pf-v5-u-mt-lg",children:[u(he,{...r,children:[q&&a(Re,{type:"selectMany",text:{title:"selectGroups",ok:"join"},canBrowse:D,onConfirm:i=>{e?.id?Z(i||[]):X(i||[]),g(!1)},onClose:()=>g(!1),filterGroups:p}),e?.id&&u(k,{children:[a(f,{label:t("id"),fieldId:"kc-id",isRequired:!0,children:a(R,{id:e.id,"aria-label":t("userID"),value:e.id,readOnly:!0})}),a(f,{label:t("createdAt"),fieldId:"kc-created-at",isRequired:!0,children:a(R,{value:E(new Date(e.createdTimestamp)),id:"kc-created-at",readOnly:!0})})]}),a(Ve,{name:"requiredActions",label:"requiredUserActions",help:"requiredUserActionsHelp"}),e?.federationLink&&H&&a(f,{label:t("federationLink"),labelIcon:a(v,{helpText:t("federationLinkHelp"),fieldLabelId:"federationLink"}),children:a(Te,{user:e})}),l?u(k,{children:[a(qe,{name:"emailVerified",label:t("emailVerified"),labelIcon:t("emailVerifiedHelp")}),a(Ae,{form:r,userProfileMetadata:l,hideReadOnly:!e,supportedLocales:n.supportedLocales||[],currentLocale:N,t:(i,c)=>t(i,c)})]}):u(k,{children:[!n.registrationEmailAsUsername&&a(y,{name:"username",label:t("username"),readOnly:!!e?.id&&!n.editUsernameAllowed&&n.editUsernameAllowed!==void 0,rules:{required:t("required")}}),a(y,{name:"email",label:t("email"),type:"email",rules:{pattern:{value:ye,message:t("emailInvalid")}}}),a(ge,{name:"emailVerified",label:t("emailVerified"),labelIcon:t("emailVerifiedHelp"),labelOn:t("yes"),labelOff:t("no")}),a(y,{name:"firstName",label:t("firstName")}),a(y,{name:"lastName",label:t("lastName")})]}),o&&a(f,{label:t("temporaryLocked"),fieldId:"temporaryLocked",labelIcon:a(v,{helpText:t("temporaryLockedHelp"),fieldLabelId:"temporaryLocked"}),children:a(ke,{"data-testid":"user-locked-switch",id:"temporaryLocked",onChange:(i,c)=>{K(),Y(c)},isChecked:C,isDisabled:!C,label:t("on"),labelOff:t("off")})}),!e?.id&&u(f,{label:t("groups"),fieldId:"kc-groups",labelIcon:a(v,{helpText:t("groupsHelp"),fieldLabelId:"groups"}),children:[a(ve,{name:"groups",defaultValue:[],control:B,render:()=>u(Ie,{children:[a(j,{children:a(Le,{categoryName:" ",children:p.map(i=>a(Oe,{onClick:()=>J(i.name),children:i.path},i.id))})}),a(j,{children:a(S,{id:"kc-join-groups-button",onClick:ee,variant:"secondary","data-testid":"join-groups-button",children:t("joinGroups")})})]})}),Q.requiredActions&&a(we,{message:t("required")})]})]}),a(xe,{name:"user-creation",saveText:e?.id?t("save"):t("create"),reset:te,resetText:e?.id?t("revert"):t("cancel"),isDisabled:ae(),isSubmit:!0})]})};export{Te as F,Ve as R,We as U,Ue as a,Be as f,$e as t};
//# sourceMappingURL=UserForm-Cy_IbmvP.js.map

import{jsx as e,jsxs as c,Fragment as re}from"react/jsx-runtime";import{c as M,L as se,az as ve,bK as we,da as Le,br as Ue,cy as _e,k as xe,cQ as Ve,db as ne,u as fe,a as H,b as Ge,f as ge,bT as Ke,b_ as Me,dc as He,b$ as Be,c0 as P,c1 as ie,c2 as je,c3 as T,aY as Ce,F as ke,v as Ae,x as V,r as Ie,a_ as _,b0 as f,c4 as ee,c5 as te,b2 as w,b3 as g,aG as ae,Q as b,A as Ee,h as G,bu as Re,s as Fe,M as We,q as $e,C as ze,dd as Ze,bm as Qe,P as Je,de as oe,df as le,p as Xe}from"./main-hZIJIVx9.js";import{useState as m,useMemo as qe}from"react";import{D as Oe}from"./DropdownPanel-Bj9SJGZl.js";import{R as Ye,u as et}from"./RoutableTabs-B1siEmtL.js";import{V as tt}from"./ViewHeader-DxK8RzXz.js";import{u as Se,F as Ne}from"./useFormatDate-wmPxp-7e.js";import{p as De}from"./pickBy-BzKOZUa6.js";import{C as at,L as rt}from"./CodeEditor-BZUGCa3z.js";import{D as K}from"./DatePicker-CyxP5U4J.js";import{T as st}from"./Trans-CPgnEO0T.js";import{a as ce,b as de}from"./Tabs-DXjNMDMz.js";import{W as nt}from"./warning-triangle-icon-BADc4O-Q.js";import{D as it,a as ue,b as pe,c as me}from"./DescriptionListTerm-otcoXpTE.js";import"react-dom";import"./PageHandler-B0KkvOoM.js";import"./DynamicComponents-v6e2RtHb.js";import"./ClientSelect-9QE6UUYG.js";import"./FileUpload-DI2GSZLL.js";import"./GroupPickerDialog-CppD_q_3.js";import"./DataListItemRow-B1CYYhSa.js";import"./KeySelect-BUhUx10e.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-DThNyrNa.js";import"./AddRoleMappingModal-C4wZesy5.js";import"./translationFormatter-QNso5xUZ.js";import"./useLocaleSort-Cjd-LyWL.js";import"./ConfirmDialog-BClP8m2C.js";import"./filter-icon-B5V3NoWK.js";import"./useParams-tGf6FJmU.js";import"./PageList-DUHf6xan.js";import"./copy-icon-Cy7M-mD5.js";const he=38,ot=({text:r,children:t})=>{const l=r||"",u=l.length>he,C=l.substring(0,he);return u?e(ve,{content:r,children:t(C+"â€¦")}):t(l)},lt=r=>r.operationType==="DELETE"?!1:r.resourceType==="USER"||r.resourceType==="GROUP_MEMBERSHIP"||r.resourceType==="GROUP"||r.resourceType==="CLIENT"||r.resourceType==="ORGANIZATION"||r.resourceType==="ORGANIZATION_MEMBERSHIP"||r.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||r.resourceType==="CLIENT_SCOPE"||r.resourceType==="AUTH_FLOW"||r.resourcePath?.startsWith("roles-by-id"),ct=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),dt=(r,t)=>{const l=ct.exec(t.resourcePath);if(!l)return console.warn("event didn't contain a valid link",t),"";const u=l[1];return t.resourceType==="CLIENT"||t.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?we({realm:r,clientId:u,tab:t.resourceType==="CLIENT"?"settings":"authorization"}):t.resourceType==="GROUP"?Le({realm:r,id:u}):t.resourceType==="CLIENT_SCOPE"?Ue({realm:r,id:u,tab:"settings"}):t.resourceType==="USER"||t.resourceType==="GROUP_MEMBERSHIP"?_e({realm:r,id:u,tab:"settings"}):t.resourceType==="AUTH_FLOW"?xe({realm:r,id:u,usedBy:"-"}):t.resourcePath?.startsWith("roles-by-id")?Ve({realm:r,id:u,tab:"details"}):t.resourceType==="ORGANIZATION"?ne({realm:r,id:u,tab:"settings"}):t.resourceType==="ORGANIZATION_MEMBERSHIP"?ne({realm:r,id:u,tab:"members"}):""},ut=({event:r})=>{const{realm:t}=M();return e(ot,{text:r.resourcePath,children:l=>lt(r)?e(se,{to:dt(t,r),children:l}):e("span",{children:l})})},pt=r=>e(ut,{event:r}),ye={resourceTypes:[],operationTypes:[],resourcePath:"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},Te=({titleKey:r,onClose:t,children:l})=>{const{t:u}=H();return e(We,{variant:$e.medium,title:u(r),isOpen:!0,onClose:t,children:l})},mt=()=>{const{adminClient:r}=fe(),{t}=H(),{realm:l}=M(),u=Ge(),C=Se(),B=u.enums?.resourceType,j=u.enums?.operationType,[E,W]=m(0),[$,L]=m(!1),[z,k]=m(!1),[Z,Q]=m(!1),[v,R]=m({}),[h,F]=m(),[y,U]=m(),J={resourceTypes:t("resourceTypes"),operationTypes:t("operationTypes"),resourcePath:t("resourcePath"),dateFrom:t("dateFrom"),dateTo:t("dateTo"),authClient:t("client"),authUser:t("userId"),authRealm:t("realm"),authIpAddress:t("ipAddress")},O=ge({mode:"onChange",defaultValues:ye}),{getValues:S,reset:N,formState:{isDirty:x},control:A}=O;function X(a,s){return r.realms.findAdminEvents({...v,realm:l,first:a,max:s})}function q(){L(!1),i()}function I(){N(),i()}function Y(a){const s={...S()};delete s[a],N({...ye,...s}),i()}function n(a,s){const o=S(),p=o[a],D=Array.isArray(p)?p.filter(Pe=>Pe!==s):p;N({...o,[a]:D}),i()}function i(){const a=De(S(),s=>s!==""||Array.isArray(s)&&s.length>0);R(a),W(E+1)}const d=qe(()=>y?.representation?Ke(JSON.parse(y.representation)):"",[y?.representation]);return c(re,{children:[h&&e(Te,{titleKey:"auth",onClose:()=>F(void 0),children:c(Me,{"aria-label":"authData","data-testid":"auth-dialog",variant:He.compact,children:[e(Be,{children:c(P,{children:[e(ie,{children:t("attribute")}),e(ie,{children:t("value")})]})}),c(je,{children:[c(P,{children:[e(T,{children:t("realm")}),e(T,{children:h.authDetails?.realmId})]}),c(P,{children:[e(T,{children:t("client")}),e(T,{children:h.authDetails?.clientId})]}),c(P,{children:[e(T,{children:t("user")}),e(T,{children:h.authDetails?.userId})]}),c(P,{children:[e(T,{children:t("ipAddress")}),e(T,{children:h.authDetails?.ipAddress})]})]})]})}),y&&e(Te,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>U(void 0),children:e(at,{isLineNumbersVisible:!0,isReadOnly:!0,code:d,language:rt.json,height:"8rem"})}),e(Ce,{loader:X,isPaginated:!0,ariaLabelKey:"adminEvents",toolbarItem:e(ke,{...O,children:c(Ae,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(V,{children:e(Oe,{buttonText:t("searchForAdminEvent"),setSearchDropdownOpen:L,searchDropdownOpen:$,marginRight:"2.5rem",width:"15vw",children:c(Ie,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[e(_,{label:t("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:e(f,{name:"resourceTypes",control:A,render:({field:a})=>e(ee,{className:"keycloak__events_search__type_select","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:te.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>k(s),selections:a.value,onSelect:s=>{const o=s.toString(),p=a.value.includes(o)?a.value.filter(D=>D!==o):[...a.value,o];a.onChange(p)},onClear:()=>{a.onChange([])},isOpen:z,"aria-labelledby":"resourceTypes",chipGroupComponent:e(w,{children:a.value.map(s=>e(g,{onClick:o=>{o.stopPropagation(),a.onChange(a.value.filter(p=>p!==s))},children:s},s))}),children:B?.map(s=>e(ae,{value:s,children:s},s))})})}),e(_,{label:t("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:e(f,{name:"operationTypes",control:A,render:({field:a})=>e(ee,{className:"keycloak__events_search__type_select","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:te.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>Q(s),selections:a.value,onSelect:s=>{const o=s.toString(),p=a.value.includes(o)?a.value.filter(D=>D!==o):[...a.value,o];a.onChange(p)},onClear:()=>{a.onChange([])},isOpen:Z,"aria-labelledby":"operationTypes",chipGroupComponent:e(w,{children:a.value.map(s=>e(g,{onClick:o=>{o.stopPropagation(),a.onChange(a.value.filter(p=>p!==s))},children:s},s))}),children:j?.map(s=>e(ae,{value:s,children:s},s.toString()))})})}),e(b,{name:"resourcePath",label:t("resourcePath")}),e(b,{name:"authRealm",label:t("realm")}),e(b,{name:"authClient",label:t("client")}),e(b,{name:"authUser",label:t("user")}),e(b,{name:"authIpAddress",label:t("ipAddress")}),e(_,{label:t("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(f,{name:"dateFrom",control:A,render:({field:a})=>e(K,{className:"pf-v5-u-w-100",value:a.value,onChange:(s,o)=>a.onChange(o),inputProps:{id:"kc-dateFrom"}})})}),e(_,{label:t("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(f,{name:"dateTo",control:A,render:({field:a})=>e(K,{className:"pf-v5-u-w-100",value:a.value,onChange:(s,o)=>a.onChange(o),inputProps:{id:"kc-dateTo"}})})}),c(Ee,{children:[e(G,{variant:"primary",onClick:q,"data-testid":"search-events-btn",isDisabled:!x,children:t("searchAdminEventsBtn")}),e(G,{variant:"secondary",onClick:I,isDisabled:!x,children:t("resetBtn")})]})]})})}),e(V,{children:Object.entries(v).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(v).map(a=>{const[s,o]=a;return e(w,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:J[s],isClosable:!0,onClick:()=>Y(s),children:typeof o=="string"?e(g,{isReadOnly:!0,children:o}):o.map(p=>e(g,{onClick:()=>n(s,p),children:p},p))},s)})})})]})}),actions:[{title:t("auth"),onRowClick:a=>F(a)},{title:t("representation"),onRowClick:a=>U(a)}],columns:[{name:"time",displayKey:"time",cellRenderer:a=>C(new Date(a.time),Ne)},{name:"resourcePath",displayKey:"resourcePath",cellRenderer:pt},{name:"resourceType",displayKey:"resourceType"},{name:"operationType",displayKey:"operationType",transforms:[Re(10)]},{name:"",displayKey:"user",cellRenderer:a=>a.authDetails?.userId||""}],emptyState:e(Fe,{message:t("emptyAdminEvents"),instructions:t("emptyAdminEventsInstructions")}),isSearching:Object.keys(v).length>0},E)]})},be={client:"",dateFrom:"",dateTo:"",user:"",type:[],ipAddress:""},ht=r=>r.error?e(ve,{content:r.error,children:c("span",{children:[e(le,{status:"warning",children:e(nt,{})}),r.type]})}):c("span",{children:[e(le,{status:"success",children:e(Xe,{})}),r.type]}),yt=r=>c(it,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[r.details&&Object.entries(r.details).map(([t,l])=>c(ue,{children:[e(pe,{children:t}),e(me,{children:l})]},t)),r.error&&c(ue,{children:[e(pe,{children:"error"}),e(me,{children:r.error})]},"error")]}),Tt=r=>{const{t}=H(),{realm:l}=M();return c(re,{children:[r.userId&&e(se,{to:_e({realm:l,id:r.userId,tab:"settings"}),children:r.userId},`link-${r.time}-${r.type}`),!r.userId&&t("noUserDetails")]})};function Qt(){const{adminClient:r}=fe(),{t}=H(),{realm:l}=M(),u=Se(),[C,B]=m(0),[j,E]=m(!1),[W,$]=m(!1),[L,z]=m(),[k,Z]=m({}),Q={client:t("client"),dateFrom:t("dateFrom"),dateTo:t("dateTo"),user:t("userId"),type:t("eventType"),ipAddress:t("ipAddress")},v=ge({mode:"onChange",defaultValues:be}),{getValues:R,reset:h,formState:{isDirty:F},control:y,handleSubmit:U}=v;ze(()=>r.realms.getConfigEvents({realm:l}),n=>z(n),[]);function J(n,i){return r.realms.findEvents({...k,realm:l,first:n,max:i})}const O=n=>et(oe({realm:l,tab:n})),S=O("user-events"),N=O("admin-events");function x(){E(!1),I()}function A(){h(),I()}function X(n){const i={...R()};delete i[n],h({...be,...i}),I()}function q(n,i){const d=R(),a=d[n],s=Array.isArray(a)?a.filter(o=>o!==i):a;h({...d,[n]:s}),I()}function I(){const n=De(R(),i=>i!==""||Array.isArray(i)&&i.length>0);Z(n),B(C+1)}const Y=()=>e(ke,{...v,children:c(Ae,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(V,{children:e(Oe,{buttonText:t("searchForUserEvent"),setSearchDropdownOpen:E,searchDropdownOpen:j,marginRight:"2.5rem",width:"15vw",children:c(Ie,{"data-testid":"searchForm",className:"keycloak__events_search__form",onSubmit:U(x),isHorizontal:!0,children:[e(b,{name:"user",label:t("userId"),"data-testid":"userId-searchField"}),e(_,{label:t("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:e(f,{name:"type",control:y,render:({field:n})=>e(ee,{className:"keycloak__events_search__type_select","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:te.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:i=>$(i),selections:n.value,onSelect:i=>{const d=i.toString(),a=n.value.includes(d)?n.value.filter(s=>s!==d):[...n.value,d];n.onChange(a)},onClear:()=>{n.onChange([])},isOpen:W,"aria-labelledby":"eventType",chipGroupComponent:e(w,{children:n.value.map(i=>e(g,{onClick:d=>{d.stopPropagation(),n.onChange(n.value.filter(a=>a!==i))},children:t(`eventTypes.${i}.name`)},i))}),children:L?.enabledEventTypes?.map(i=>e(ae,{value:i,children:t(`eventTypes.${i}.name`)},i))})})}),e(b,{name:"client",label:t("client"),"data-testid":"client-searchField"}),e(_,{label:t("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(f,{name:"dateFrom",control:y,render:({field:n})=>e(K,{className:"pf-v5-u-w-100",value:n.value,onChange:(i,d)=>n.onChange(d),inputProps:{id:"kc-dateFrom"}})})}),e(_,{label:t("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(f,{name:"dateTo",control:y,render:({field:n})=>e(K,{className:"pf-v5-u-w-100",value:n.value,onChange:(i,d)=>n.onChange(d),inputProps:{id:"kc-dateTo"}})})}),e(b,{name:"ipAddress",label:t("ipAddress"),"data-testid":"ipAddress-searchField"}),c(Ee,{children:[e(G,{"data-testid":"search-events-btn",variant:"primary",type:"submit",isDisabled:!F,children:t("searchUserEventsBtn")}),e(G,{variant:"secondary",onClick:A,isDisabled:!F,children:t("resetBtn")})]})]})})}),e(V,{children:Object.entries(k).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(k).map(n=>{const[i,d]=n;return e(w,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:Q[i],isClosable:!0,onClick:()=>X(i),children:typeof d=="string"?e(g,{isReadOnly:!0,children:d}):d.map(a=>e(g,{onClick:()=>q(i,a),children:t(`eventTypes.${a}.name`)},a))},i)})})})]})});return c(re,{children:[e(tt,{titleKey:"titleEvents",subKey:c(st,{i18nKey:"eventExplain",children:["If you want to configure user events, Admin events or Event listeners, please enter",e(se,{to:Ze({realm:l,tab:"events"}),children:t("eventConfig")}),"page realm settings to configure."]}),helpUrl:Qe.eventsUrl,divider:!1}),e(Je,{variant:"light",className:"pf-v5-u-p-0",children:c(Ye,{isBox:!0,defaultLocation:oe({realm:l,tab:"user-events"}),children:[e(ce,{title:e(de,{children:t("userEvents")}),...S,children:e("div",{className:"keycloak__events_table",children:e(Ce,{loader:J,detailColumns:[{name:"details",enabled:n=>n.details!==void 0,cellRenderer:yt}],isPaginated:!0,ariaLabelKey:"titleEvents",toolbarItem:Y(),columns:[{name:"time",displayKey:"time",cellRenderer:n=>u(new Date(n.time),Ne)},{name:"userId",displayKey:"user",cellRenderer:Tt},{name:"type",displayKey:"eventType",cellRenderer:ht},{name:"ipAddress",displayKey:"ipAddress",transforms:[Re(10)]},{name:"clientId",displayKey:"client"}],emptyState:e(Fe,{message:t("emptyUserEvents"),instructions:t("emptyUserEventsInstructions")}),isSearching:Object.keys(k).length>0},C)})}),e(ce,{title:e(de,{children:t("adminEvents")}),"data-testid":"admin-events-tab",...N,children:e(mt,{})})]})})]})}export{Qt as default};
//# sourceMappingURL=EventsSection-Bb3doiBB.js.map
